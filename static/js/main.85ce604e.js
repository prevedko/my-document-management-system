/*! For license information please see main.85ce604e.js.LICENSE.txt */
(()=>{"use strict";var e={672(e,t,n){var r=n(43);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var o={d:{f:s,r:function(){throw Error(i(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},a=Symbol.for("react.portal");var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=c.T,n=o.p;try{if(c.T=null,o.p=2,e)return e()}finally{c.T=t,o.p=n,o.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,o.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&o.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=u(n,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,s="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?o.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:s}):"script"===n&&o.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:s,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=u(t.as,t.crossOrigin);o.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&o.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=u(n,t.crossOrigin);o.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=u(t.as,t.crossOrigin);o.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else o.d.m(e)},t.requestFormReset=function(e){o.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return c.H.useFormState(e,t,n)},t.useFormStatus=function(){return c.H.useHostTransitionStatus()},t.version="19.2.4"},950(e,t,n){!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},799(e,t){var n=Symbol.for("react.transitional.element");function r(e,t,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),"key"in t)for(var s in r={},t)"key"!==s&&(r[s]=t[s]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:r}}Symbol.for("react.fragment"),t.jsx=r,t.jsxs=r},288(e,t){var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}function w(){}function _(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=v.prototype;var I=_.prototype=new w;I.constructor=_,m(I,v.prototype),I.isPureReactComponent=!0;var b=Array.isArray;function T(){}var E={H:null,A:null,T:null,S:null},S=Object.prototype.hasOwnProperty;function C(e,t,r){var i=r.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:r}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var k=/\/+/g;function N(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function R(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c,u,l=!1;if(null===e)l=!0;else switch(a){case"bigint":case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0;break;case d:return R((l=e._init)(e._payload),t,i,s,o)}}if(l)return o=o(e),l=""===s?"."+N(e,0):s,b(o)?(i="",null!=l&&(i=l.replace(k,"$&/")+"/"),R(o,t,i,"",function(e){return e})):null!=o&&(A(o)&&(c=o,u=i+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+l,o=C(c.type,u,c.props)),t.push(o)),1;l=0;var h,f=""===s?".":s+":";if(b(e))for(var g=0;g<e.length;g++)l+=R(s=e[g],t,i,a=f+N(s,g),o);else if("function"===typeof(g=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=p&&h[p]||h["@@iterator"])?h:null))for(e=g.call(e),g=0;!(s=e.next()).done;)l+=R(s=s.value,t,i,a=f+N(s,g++),o);else if("object"===a){if("function"===typeof e.then)return R(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(T,T):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,s,o);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return l}function D(e,t,n){if(null==e)return e;var r=[],i=0;return R(e,r,"","",function(e){return t.call(n,e,i++)}),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},O={map:D,forEach:function(e,t,n){D(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return D(e,function(){t++}),t},toArray:function(e){return D(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=f,t.Children=O,t.Component=v,t.Fragment=i,t.Profiler=o,t.PureComponent=_,t.StrictMode=s,t.Suspense=l,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=E,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return E.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),i=e.key;if(null!=t)for(s in void 0!==t.key&&(i=""+t.key),t)!S.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(r[s]=t[s]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var o=Array(s),a=0;a<s;a++)o[a]=arguments[a+2];r.children=o}return C(e.type,i,r)},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var r,i={},s=null;if(null!=t)for(r in void 0!==t.key&&(s=""+t.key),t)S.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===i[r]&&(i[r]=o[r]);return C(e,s,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=E.T,n={};E.T=n;try{var r=e(),i=E.S;null!==i&&i(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(T,x)}catch(s){x(s)}finally{null!==t&&null!==n.types&&(t.types=n.types),E.T=t}},t.unstable_useCacheRefresh=function(){return E.H.useCacheRefresh()},t.use=function(e){return E.H.use(e)},t.useActionState=function(e,t,n){return E.H.useActionState(e,t,n)},t.useCallback=function(e,t){return E.H.useCallback(e,t)},t.useContext=function(e){return E.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return E.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return E.H.useEffect(e,t)},t.useEffectEvent=function(e){return E.H.useEffectEvent(e)},t.useId=function(){return E.H.useId()},t.useImperativeHandle=function(e,t,n){return E.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return E.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return E.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return E.H.useMemo(e,t)},t.useOptimistic=function(e,t){return E.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return E.H.useReducer(e,t,n)},t.useRef=function(e){return E.H.useRef(e)},t.useState=function(e){return E.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return E.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return E.H.useTransition()},t.version="19.2.4"},43(e,t,n){e.exports=n(288)},579(e,t,n){e.exports=n(799)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};n.r(r),n.d(r,{FirebaseError:()=>M,SDK_VERSION:()=>mt,_DEFAULT_ENTRY_NAME:()=>$e,_addComponent:()=>rt,_addOrOverwriteComponent:()=>it,_apps:()=>et,_clearComponents:()=>ht,_components:()=>nt,_getProvider:()=>ot,_isFirebaseApp:()=>ct,_isFirebaseServerApp:()=>lt,_isFirebaseServerAppSettings:()=>ut,_registerComponent:()=>st,_removeServiceInstance:()=>at,_serverApps:()=>tt,deleteApp:()=>It,getApp:()=>wt,getApps:()=>_t,initializeApp:()=>yt,initializeServerApp:()=>vt,onLog:()=>Tt,registerVersion:()=>bt,setLogLevel:()=>Et});var i=n(43),s=n(950);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function c(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const h=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},d={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,u=t>>2,l=(3&t)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(h(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw new f;const c=t<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class f extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p=function(e){return function(e){const t=h(e);return d.encodeByteArray(t,!0)}(e).replace(/\./g,"")},g=function(e){try{return d.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function m(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&y(n)&&(e[n]=m(e[n],t[n]));return e}function y(e){return"__proto__"!==e}function v(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const w=()=>{try{return v().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/my-document-management-system",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&g(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},_=()=>{var e;return null===(e=w())||void 0===e?void 0:e.config};class I{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function b(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function T(e){return(await fetch(e,{credentials:"include"})).ok}const E={};let S=!1;function C(e,t){if("undefined"===typeof window||"undefined"===typeof document||!b(window.location.host)||E[e]===t||E[e]||S)return;function n(e){return"__firebase__banner__".concat(e)}E[e]=t;const r="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(E))E[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{S=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),o=document.getElementById(t)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),u=n("preprendIcon"),l=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(c,a);const n=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(l,u),t.append(l,o,c,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function A(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function k(){var e;const t=null===(e=w())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function N(){return"undefined"!==typeof WorkerGlobalScope&&"undefined"!==typeof self&&self instanceof WorkerGlobalScope}function R(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function D(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function P(){const e=A();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function x(){return!k()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function O(){return!k()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function L(){try{return"object"===typeof indexedDB}catch(e){return!1}}class M extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,M.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,F.prototype.create)}}class F{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(V,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new M(n,s,t)}}const V=/\{\$([^}]+)}/g;function U(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function j(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(q(n)&&q(s)){if(!j(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function q(e){return null!==e&&"object"===typeof e}function B(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function z(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function G(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function K(e,t){const n=new H(e,t);return n.subscribe.bind(n)}class H{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=W),void 0===r.error&&(r.error=W),void 0===r.complete&&(r.complete=W);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function W(){}function Q(e){return e&&e._delegate?e._delegate:e}class J{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Y="[DEFAULT]";class X{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new I;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Y})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===Y?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(s){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y;return this.component?this.component.multipleInstances?e:Y:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ${constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new X(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Z=[];var ee;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ee||(ee={}));const te={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},ne=ee.INFO,re={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},ie=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=re[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(e.name,":"),...s)};class se{constructor(e){this.name=e,this._logLevel=ne,this._logHandler=ie,this._userLogHandler=null,Z.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ee))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?te[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...t),this._logHandler(this,ee.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...t),this._logHandler(this,ee.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ee.INFO,...t),this._logHandler(this,ee.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ee.WARN,...t),this._logHandler(this,ee.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...t),this._logHandler(this,ee.ERROR,...t)}}let oe,ae;const ce=new WeakMap,ue=new WeakMap,le=new WeakMap,he=new WeakMap,de=new WeakMap;let fe={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ue.get(e);if("objectStoreNames"===t)return e.objectStoreNames||le.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return me(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function pe(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ae||(ae=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(ye(this),n),me(ce.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return me(e.apply(ye(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=e.call(ye(this),t,...r);return le.set(s,t.sort?t.sort():[t]),me(s)}}function ge(e){return"function"===typeof e?pe(e):(e instanceof IDBTransaction&&function(e){if(ue.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ue.set(e,t)}(e),t=e,(oe||(oe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,fe):e);var t}function me(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(me(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&ce.set(t,e)}).catch(()=>{}),de.set(t,e),t}(e);if(he.has(e))return he.get(e);const t=ge(e);return t!==e&&(he.set(e,t),de.set(t,e)),t}const ye=e=>de.get(e);const ve=["get","getKey","getAll","getAllKeys","count"],we=["put","add","delete","clear"],_e=new Map;function Ie(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(_e.get(t))return _e.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=we.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!ve.includes(n))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return r&&(s=s.index(a.shift())),(await Promise.all([s[n](...a),i&&t.done]))[0]};return _e.set(t,s),s}fe=(e=>l(l({},e),{},{get:(t,n,r)=>Ie(t,n)||e.get(t,n,r),has:(t,n)=>!!Ie(t,n)||e.has(t,n)}))(fe);class be{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const Te="@firebase/app",Ee="0.14.8",Se=new se("@firebase/app"),Ce="@firebase/app-compat",Ae="@firebase/analytics-compat",ke="@firebase/analytics",Ne="@firebase/app-check-compat",Re="@firebase/app-check",De="@firebase/auth",Pe="@firebase/auth-compat",xe="@firebase/database",Oe="@firebase/data-connect",Le="@firebase/database-compat",Me="@firebase/functions",Fe="@firebase/functions-compat",Ve="@firebase/installations",Ue="@firebase/installations-compat",je="@firebase/messaging",qe="@firebase/messaging-compat",Be="@firebase/performance",ze="@firebase/performance-compat",Ge="@firebase/remote-config",Ke="@firebase/remote-config-compat",He="@firebase/storage",We="@firebase/storage-compat",Qe="@firebase/firestore",Je="@firebase/ai",Ye="@firebase/firestore-compat",Xe="firebase",$e="[DEFAULT]",Ze={[Te]:"fire-core",[Ce]:"fire-core-compat",[ke]:"fire-analytics",[Ae]:"fire-analytics-compat",[Re]:"fire-app-check",[Ne]:"fire-app-check-compat",[De]:"fire-auth",[Pe]:"fire-auth-compat",[xe]:"fire-rtdb",[Oe]:"fire-data-connect",[Le]:"fire-rtdb-compat",[Me]:"fire-fn",[Fe]:"fire-fn-compat",[Ve]:"fire-iid",[Ue]:"fire-iid-compat",[je]:"fire-fcm",[qe]:"fire-fcm-compat",[Be]:"fire-perf",[ze]:"fire-perf-compat",[Ge]:"fire-rc",[Ke]:"fire-rc-compat",[He]:"fire-gcs",[We]:"fire-gcs-compat",[Qe]:"fire-fst",[Ye]:"fire-fst-compat",[Je]:"fire-vertex","fire-js":"fire-js",[Xe]:"fire-js-all"},et=new Map,tt=new Map,nt=new Map;function rt(e,t){try{e.container.addComponent(t)}catch(n){Se.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function it(e,t){e.container.addOrOverwriteComponent(t)}function st(e){const t=e.name;if(nt.has(t))return Se.debug("There were multiple attempts to register component ".concat(t,".")),!1;nt.set(t,e);for(const n of et.values())rt(n,e);for(const n of tt.values())rt(n,e);return!0}function ot(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function at(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$e;ot(e,t).clearInstance(n)}function ct(e){return void 0!==e.options}function ut(e){return!ct(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function lt(e){return null!==e&&void 0!==e&&void 0!==e.settings}function ht(){nt.clear()}const dt=new F("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ft{constructor(e,t,n){this._isDeleted=!1,this._options=l({},e),this._config=l({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new J("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw dt.create("app-deleted",{appName:this._name})}}function pt(e,t){const n=g(e.split(".")[1]);if(null===n)return void console.error("FirebaseServerApp ".concat(t," is invalid: second part could not be parsed."));if(void 0===JSON.parse(n).exp)return void console.error("FirebaseServerApp ".concat(t," is invalid: expiration claim could not be parsed"));1e3*JSON.parse(n).exp-(new Date).getTime()<=0&&console.error("FirebaseServerApp ".concat(t," is invalid: the token has expired."))}class gt extends ft{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};if(void 0!==e.apiKey)super(e,s,r);else{super(e.options,s,r)}this._serverConfig=l({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&pt(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&pt(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!==typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,bt(Te,Ee,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){It(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw dt.create("server-app-deleted")}}const mt="12.9.0";function yt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=l({name:$e,automaticDataCollectionEnabled:!0},t),i=r.name;if("string"!==typeof i||!i)throw dt.create("bad-app-name",{appName:String(i)});if(n||(n=_()),!n)throw dt.create("no-options");const s=et.get(i);if(s){if(j(n,s.options)&&j(r,s.config))return s;throw dt.create("duplicate-app",{appName:i})}const o=new $(i);for(const c of nt.values())o.addComponent(c);const a=new ft(n,r,o);return et.set(i,a),a}function vt(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(("undefined"!==typeof window||N())&&!N())throw dt.create("invalid-server-app-environment");let r=n||{};if(e&&(ct(e)?t=e.options:ut(e)?r=e:t=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),t||(t=_()),!t)throw dt.create("no-options");const i=l(l({},r),t);void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;if(void 0!==r.releaseOnDeref&&"undefined"===typeof FinalizationRegistry)throw dt.create("finalization-registry-not-supported",{});const s=""+(o=JSON.stringify(i),[...o].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0));var o;const a=tt.get(s);if(a)return a.incRefCount(r.releaseOnDeref),a;const c=new $(s);for(const l of nt.values())c.addComponent(l);const u=new gt(t,r,s,c);return tt.set(s,u),u}function wt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$e;const t=et.get(e);if(!t&&e===$e&&_())return yt();if(!t)throw dt.create("no-app",{appName:e});return t}function _t(){return Array.from(et.values())}async function It(e){let t=!1;const n=e.name;if(et.has(n))t=!0,et.delete(n);else if(tt.has(n)){e.decRefCount()<=0&&(tt.delete(n),t=!0)}t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function bt(e,t,n){var r;let i=null!==(r=Ze[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return s&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),s&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Se.warn(e.join(" "))}st(new J("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}function Tt(e,t){if(null!==e&&"function"!==typeof e)throw dt.create("invalid-log-argument");!function(e,t){for(const n of Z){let r=null;t&&t.level&&(r=te[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];const a=s.map(e=>{if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(e=>e).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:ee[n].toLowerCase(),message:a,args:s,type:t.name})}}}(e,t)}function Et(e){var t;t=e,Z.forEach(e=>{e.setLogLevel(t)})}const St="firebase-heartbeat-store";let Ct=null;function At(){return Ct||(Ct=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=me(o);return r&&o.addEventListener("upgradeneeded",e=>{r(me(o.result),e.oldVersion,e.newVersion,me(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(St)}catch(n){console.warn(n)}}}).catch(e=>{throw dt.create("idb-open",{originalErrorMessage:e.message})})),Ct}async function kt(e,t){try{const n=(await At()).transaction(St,"readwrite"),r=n.objectStore(St);await r.put(t,Nt(e)),await n.done}catch(n){if(n instanceof M)Se.warn(n.message);else{const e=dt.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});Se.warn(e.message)}}}function Nt(e){return"".concat(e.name,"!").concat(e.options.appId)}class Rt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Dt();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Se.warn(n)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Dt(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),xt(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),xt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=p(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Se.warn(t),""}}}function Dt(){return(new Date).toISOString().substring(0,10)}class Pt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!L()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await At()).transaction(St),n=await t.objectStore(St).get(Nt(e));return await t.done,n}catch(t){if(t instanceof M)Se.warn(t.message);else{const e=dt.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});Se.warn(e.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return kt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return kt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function xt(e){return p(JSON.stringify({version:2,heartbeats:e})).length}var Ot;Ot="",st(new J("platform-logger",e=>new be(e),"PRIVATE")),st(new J("heartbeat",e=>new Rt(e),"PRIVATE")),bt(Te,Ee,Ot),bt(Te,Ee,"esm2020"),bt("fire-js","");class Lt{constructor(e,t){this._delegate=e,this.firebase=t,rt(e,new J("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),It(this._delegate)))}_getService(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$e;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(t=r.getComponent())||void 0===t?void 0:t.instantiationMode)||r.initialize(),r.getImmediate({identifier:n})}_removeServiceInstance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$e;this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){rt(this._delegate,e)}_addOrOverwriteComponent(e){it(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Mt=new F("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});const Ft=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(r){const i=yt(r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});if(U(t,i.name))return t[i.name];const s=new e(i,n);return t[i.name]=s,s},app:i,registerVersion:bt,setLogLevel:Et,onLog:Tt,apps:null,SDK_VERSION:mt,INTERNAL:{registerComponent:function(t){const r=t.name,s=r.replace("-compat","");if(st(t)&&"PUBLIC"===t.type){const o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i();if("function"!==typeof e[s])throw Mt.create("invalid-app-argument",{appName:r});return e[s]()};void 0!==t.serviceProps&&m(o,t.serviceProps),n[s]=o,e.prototype[s]=function(){const e=this._getService.bind(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return e.apply(this,t.multipleInstances?i:[])}}return"PUBLIC"===t.type?n[s]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:r}};function i(e){if(!U(t,e=e||$e))throw Mt.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map(e=>t[e])}}),i.App=e,n}(Lt);return t.INTERNAL=l(l({},t.INTERNAL),{},{createFirebaseNamespace:e,extendNamespace:function(e){m(t,e)},createSubscribe:K,ErrorFactory:F,deepExtend:m}),t}(),Vt=new se("@firebase/app-compat");try{const e=v();if(void 0!==e.firebase){Vt.warn("\n      Warning: Firebase is already defined in the global scope. Please make sure\n      Firebase library is only loaded once.\n    ");const t=e.firebase.SDK_VERSION;t&&t.indexOf("LITE")>=0&&Vt.warn("\n        Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n        ")}}catch(XI){}const Ut=Ft;!function(e){bt("@firebase/app-compat","0.5.8",e)}();function jt(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}Ut.registerVersion("firebase","12.9.0","app-compat");const qt=["providerId"],Bt=["uid","auth","stsTokenManager"],zt=["providerId","signInMethod"],Gt="facebook.com",Kt="github.com",Ht="google.com",Wt="password",Qt="twitter.com",Jt="EMAIL_SIGNIN",Yt="PASSWORD_RESET",Xt="RECOVER_EMAIL",$t="REVERT_SECOND_FACTOR_ADDITION",Zt="VERIFY_AND_CHANGE_EMAIL",en="VERIFY_EMAIL";function tn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nn=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}},rn=tn,sn=new F("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),on=new se("@firebase/auth");function an(e){if(on.logLevel<=ee.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];on.error("Auth (".concat(mt,"): ").concat(e),...n)}}function cn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw fn(e,...n)}function un(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return fn(e,...n)}function ln(e,t,n){const r=l(l({},rn()),{},{[t]:n});return new F("auth","Firebase",r).create(t,{appName:e.name})}function hn(e){return ln(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dn(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&cn(e,"argument-error"),ln(e,"argument-error","Type of ".concat(t.constructor.name," does not match expected instance.")+"Did you pass a reference from a different Auth SDK?")}function fn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return sn.create(e,...n)}function pn(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw fn(t,...r)}}function gn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw an(t),new Error(t)}function mn(e,t){e||gn(t)}function yn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function vn(){return"http:"===wn()||"https:"===wn()}function wn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class _n{constructor(e,t){this.shortDelay=e,this.longDelay=t,mn(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())||D()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(vn()||R()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function In(e,t){mn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class bn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void gn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void gn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void gn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Tn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},En=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Sn=new _n(3e4,6e4);function Cn(e,t){return e.tenantId&&!t.tenantId?l(l({},t),{},{tenantId:e.tenantId}):t}async function An(e,t,n,r){return kn(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=B(l({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=l({method:t,headers:a},i);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&b(e.emulatorConfig.host)&&(c.credentials="include"),bn.fetch()(await Rn(e,e.config.apiHost,n,o),c)})}async function kn(e,t,n){e._canInitEmulator=!1;const r=l(l({},Tn),t);try{const t=new Pn(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw xn(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw xn(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw xn(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw xn(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw ln(e,a,o);cn(e,a)}}catch(i){if(i instanceof M)throw i;cn(e,"network-request-failed",{message:String(i)})}}async function Nn(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=await An(e,t,n,r,i);return"mfaPendingCredential"in s&&cn(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function Rn(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r),s=e,o=s.config.emulator?In(e.config,i):"".concat(e.config.apiScheme,"://").concat(i);if(En.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())){return s._getPersistence()._getFinalTarget(o).toString()}return o}function Dn(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Pn{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(un(this.auth,"network-request-failed")),Sn.get())})}}function xn(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=un(e,t,r);return i.customData._tokenResponse=n,i}function On(e){return void 0!==e&&void 0!==e.getResponse}function Ln(e){return void 0!==e&&void 0!==e.enterprise}class Mn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Dn(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Fn(e,t){return An(e,"GET","/v2/recaptchaConfig",Cn(e,t))}async function Vn(e,t){return An(e,"POST","/v1/accounts:lookup",t)}function Un(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function jn(e){return 1e3*Number(e)}function qn(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return an("JWT malformed, contained fewer than 3 sections"),null;try{const e=g(n);return e?JSON.parse(e):(an("Failed to decode base64 JWT payload"),null)}catch(i){return an("Caught error parsing JWT payload as JSON",null===i||void 0===i?void 0:i.toString()),null}}function Bn(e){const t=qn(e);return pn(t,"internal-error"),pn("undefined"!==typeof t.exp,"internal-error"),pn("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function zn(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof M&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Gn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{var t;this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class Kn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Un(this.lastLoginAt),this.creationTime=Un(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Hn(e){var t;const n=e.auth,r=await e.getIdToken(),i=await zn(e,Vn(n,{idToken:r}));pn(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=null!==(t=s.providerUserInfo)&&void 0!==t&&t.length?Wn(s.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter(e=>!u.some(t=>t.providerId===e.providerId)),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash)&&!(null!==a&&void 0!==a&&a.length),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Kn(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function Wn(e){return e.map(e=>{let{providerId:t}=e,n=jt(e,qt);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Qn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pn(e.idToken,"internal-error"),pn("undefined"!==typeof e.idToken,"internal-error"),pn("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Bn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){pn(0!==e.length,"internal-error");const t=Bn(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(pn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await kn(e,{},async()=>{const n=B({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await Rn(e,r,"/v1/token","key=".concat(i)),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&b(e.emulatorConfig.host)&&(a.credentials="include"),bn.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Qn;return n&&(pn("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(pn("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(pn("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qn,this.toJSON())}_performRefresh(){return gn("not implemented")}}function Jn(e,t){pn("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Yn{constructor(e){let{uid:t,auth:n,stsTokenManager:r}=e,i=jt(e,Bt);this.providerId="firebase",this.proactiveRefresh=new Gn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Kn(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await zn(this,this.stsTokenManager.getToken(this.auth,e));return pn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Q(e),r=await n.getIdToken(t),i=qn(r);pn(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"===typeof i.firebase?i.firebase:void 0,o=null===s||void 0===s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Un(jn(i.auth_time)),issuedAtTime:Un(jn(i.iat)),expirationTime:Un(jn(i.exp)),signInProvider:o||null,signInSecondFactor:(null===s||void 0===s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Q(e);await Hn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(pn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>l({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Yn(l(l({},this),{},{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){pn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Hn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(lt(this.auth.app))return Promise.reject(hn(this.auth));const e=await this.getIdToken();return await zn(this,async function(e,t){return An(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return l(l({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>l({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{},{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,f=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,g=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,y=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:_,isAnonymous:I,providerData:b,stsTokenManager:T}=t;pn(w&&T,e,"internal-error");const E=Qn.fromJSON(this.name,T);pn("string"===typeof w,e,"internal-error"),Jn(h,e.name),Jn(d,e.name),pn("boolean"===typeof _,e,"internal-error"),pn("boolean"===typeof I,e,"internal-error"),Jn(f,e.name),Jn(p,e.name),Jn(g,e.name),Jn(m,e.name),Jn(y,e.name),Jn(v,e.name);const S=new Yn({uid:w,auth:e,email:d,emailVerified:_,displayName:h,isAnonymous:I,photoURL:p,phoneNumber:f,tenantId:g,stsTokenManager:E,createdAt:y,lastLoginAt:v});return b&&Array.isArray(b)&&(S.providerData=b.map(e=>l({},e))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Qn;r.updateFromServerResponse(t);const i=new Yn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Hn(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];pn(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Wn(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null!==i&&void 0!==i&&i.length),o=new Qn;o.updateFromIdToken(n);const a=new Yn({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Kn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null!==i&&void 0!==i&&i.length)};return Object.assign(a,c),a}}const Xn=new Map;function $n(e){mn(e instanceof Function,"Expected a class definition");let t=Xn.get(e);return t?(mn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Xn.set(e,t),t)}class Zn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Zn.type="NONE";const er=Zn;function tr(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class nr{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=tr(this.userKey,r.apiKey,i),this.fullPersistenceKey=tr("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await Vn(this.auth,{idToken:e}).catch(()=>{});return t?Yn._fromGetAccountInfoResponse(this.auth,t,e):null}return Yn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new nr($n(er),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||$n(er);const s=tr(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(s);if(t){let n;if("string"===typeof t){const r=await Vn(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Yn._fromGetAccountInfoResponse(e,r,t)}else n=Yn._fromJSON(e,t);c!==i&&(o=n),i=c;break}}catch(XI){}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(t){}})),new nr(i,e,n)):new nr(i,e,n)}}function rr(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ar(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ir(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ur(t))return"Blackberry";if(lr(t))return"Webos";if(sr(t))return"Safari";if((t.includes("chrome/")||or(t))&&!t.includes("edge/"))return"Chrome";if(cr(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function ir(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/firefox\//i.test(e)}function sr(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function or(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/crios\//i.test(e)}function ar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/iemobile/i.test(e)}function cr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/android/i.test(e)}function ur(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/blackberry/i.test(e)}function lr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/webos/i.test(e)}function hr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function dr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return hr(e)||cr(e)||lr(e)||ur(e)||/windows phone/i.test(e)||ar(e)}function fr(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=rr(A());break;case"Worker":t="".concat(rr(A()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(mt,"/").concat(r)}class pr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class gr{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class mr{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vr(this),this.idTokenSubscription=new vr(this),this.beforeStateQueue=new pr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$n(t)),this._initializationPromise=this.queue(async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await nr.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null!==(r=this._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Vn(this,{idToken:e}),n=await Yn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(lt(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){var i,s;await this.getOrInitRedirectPersistenceManager();const t=null===(i=this.redirectUser)||void 0===i?void 0:i._redirectEventId,o=null===(s=n)||void 0===s?void 0:s._redirectEventId,a=await this.tryRedirectSignIn(e);t&&t!==o||null===a||void 0===a||!a.user||(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return pn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Hn(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(lt(this.app))return Promise.reject(hn(this));const t=e?Q(e):null;return t&&pn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&pn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return lt(this.app)?Promise.reject(hn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return lt(this.app)?Promise.reject(hn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($n(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return An(e,"GET","/v2/passwordPolicy",Cn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new gr(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new F("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return An(e,"POST","/v2/accounts:revokeToken",Cn(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$n(e)||this._popupRedirectResolver;pn(t,this,"argument-error"),this.redirectPersistenceManager=await nr.create(this,[$n(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(pn(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(lt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return null!==t&&void 0!==t&&t.error&&function(e){if(on.logLevel<=ee.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];on.warn("Auth (".concat(mt,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function yr(e){return Q(e)}class vr{constructor(e){this.auth=e,this.observer=null,this.addObserver=K(e=>this.observer=e)}get next(){return pn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let wr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _r(e){return wr.loadJS(e)}function Ir(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}const br=1e12;class Tr{constructor(e){this.auth=e,this.counter=br,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Cr(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||br;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||br;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||br;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Er{constructor(){this.enterprise=new Sr}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Sr{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Cr{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"===typeof e?document.getElementById(e):e;pn(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ar="NO_RECAPTCHA";class kr{constructor(e){this.type="recaptcha-enterprise",this.auth=yr(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;Ln(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Ar)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Er).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Fn(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Mn(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&Ln(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=wr.recaptchaEnterpriseScript;0!==t.length&&(t+=i),_r(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Nr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=new kr(e);let o;if(i)o=Ar;else try{o=await s.verify(n)}catch(c){o=await s.verify(n,!0)}const a=l({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Rr(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i){var s;if(null!==(s=e._getRecaptchaConfig())&&void 0!==s&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Nr(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await Nr(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}if("PHONE_PROVIDER"===i){var o;if(null!==(o=e._getRecaptchaConfig())&&void 0!==o&&o.isProviderEnabled("PHONE_PROVIDER")){const i=await Nr(e,t,n);return r(e,i).catch(async i=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&(i.code==="auth/".concat("missing-recaptcha-token")||i.code==="auth/".concat("invalid-app-credential"))){console.log("Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ".concat(n," flow."));const i=await Nr(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{const i=await Nr(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function Dr(e){const t=yr(e),n=await Fn(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Mn(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new kr(t).verify()}}function Pr(e,t,n){const r=yr(e);pn(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!(null===n||void 0===n||!n.disableWarnings),s=xr(t),{host:o,port:a}=function(e){const t=xr(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Or(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Or(t)}}}(t),c=null===a?"":":".concat(a),u={url:"".concat(s,"//").concat(o).concat(c,"/")},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return pn(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void pn(j(u,r.config.emulator)&&j(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=u,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,b(o)?(T("".concat(s,"//").concat(o).concat(c)),C("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function xr(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Or(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Lr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return gn("not implemented")}_getIdTokenResponse(e){return gn("not implemented")}_linkToIdToken(e,t){return gn("not implemented")}_getReauthenticationResolver(e){return gn("not implemented")}}async function Mr(e,t){return An(e,"POST","/v1/accounts:resetPassword",Cn(e,t))}async function Fr(e,t){return An(e,"POST","/v1/accounts:signUp",t)}async function Vr(e,t){return Nn(e,"POST","/v1/accounts:signInWithPassword",Cn(e,t))}async function Ur(e,t){return An(e,"POST","/v1/accounts:sendOobCode",Cn(e,t))}async function jr(e,t){return Ur(e,t)}async function qr(e,t){return Ur(e,t)}class Br extends Lr{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Br(e,t,"password")}static _fromEmailAndCode(e,t){return new Br(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(null!==t&&void 0!==t&&t.email&&null!==t&&void 0!==t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Rr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Vr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Nn(e,"POST","/v1/accounts:signInWithEmailLink",Cn(e,t))}(e,{email:this._email,oobCode:this._password});default:cn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Rr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Fr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Nn(e,"POST","/v1/accounts:signInWithEmailLink",Cn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:cn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function zr(e,t){return Nn(e,"POST","/v1/accounts:signInWithIdp",Cn(e,t))}class Gr extends Lr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Gr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):cn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=jt(t,zt);if(!n||!r)return null;const s=new Gr(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return zr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,zr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,zr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=B(t)}return e}}async function Kr(e,t){return An(e,"POST","/v1/accounts:sendVerificationCode",Cn(e,t))}const Hr={USER_NOT_FOUND:"user-not-found"};class Wr extends Lr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Wr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Wr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Nn(e,"POST","/v1/accounts:signInWithPhoneNumber",Cn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Nn(e,"POST","/v1/accounts:signInWithPhoneNumber",Cn(e,t));if(n.temporaryProof)throw xn(e,"account-exists-with-different-credential",n);return n}(e,l({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Nn(e,"POST","/v1/accounts:signInWithPhoneNumber",Cn(e,l(l({},t),{},{operation:"REAUTH"})),Hr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Wr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Qr{constructor(e){var t,n,r,i,s,o;const a=z(G(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);pn(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=z(G(e)).link,n=t?z(G(t)).deep_link_id:null,r=z(G(e)).deep_link_id;return(r?z(G(r)).link:null)||r||n||t||e}(e);try{return new Qr(t)}catch(n){return null}}}class Jr{constructor(){this.providerId=Jr.PROVIDER_ID}static credential(e,t){return Br._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Qr.parseLink(t);return pn(n,"argument-error"),Br._fromEmailAndCode(e,n.code,n.tenantId)}}Jr.PROVIDER_ID="password",Jr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Jr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Yr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Xr extends Yr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class $r extends Xr{static credentialFromJSON(e){const t="string"===typeof e?JSON.parse(e):e;return pn("providerId"in t&&"signInMethod"in t,"argument-error"),Gr._fromParams(t)}credential(e){return this._credential(l(l({},e),{},{nonce:e.rawNonce}))}_credential(e){return pn(e.idToken||e.accessToken,"argument-error"),Gr._fromParams(l(l({},e),{},{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return $r.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return $r.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:a}=t;if(!r&&!i&&!n&&!s)return null;if(!a)return null;try{return new $r(a)._credential({idToken:n,accessToken:r,nonce:o,pendingToken:s})}catch(c){return null}}}class Zr extends Xr{constructor(){super("facebook.com")}static credential(e){return Gr._fromParams({providerId:Zr.PROVIDER_ID,signInMethod:Zr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zr.credentialFromTaggedObject(e)}static credentialFromError(e){return Zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Zr.credential(t.oauthAccessToken)}catch(n){return null}}}Zr.FACEBOOK_SIGN_IN_METHOD="facebook.com",Zr.PROVIDER_ID="facebook.com";class ei extends Xr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Gr._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ei.credentialFromTaggedObject(e)}static credentialFromError(e){return ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return ei.credential(n,r)}catch(i){return null}}}ei.GOOGLE_SIGN_IN_METHOD="google.com",ei.PROVIDER_ID="google.com";class ti extends Xr{constructor(){super("github.com")}static credential(e){return Gr._fromParams({providerId:ti.PROVIDER_ID,signInMethod:ti.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ti.credentialFromTaggedObject(e)}static credentialFromError(e){return ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ti.credential(t.oauthAccessToken)}catch(n){return null}}}ti.GITHUB_SIGN_IN_METHOD="github.com",ti.PROVIDER_ID="github.com";class ni extends Lr{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return zr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,zr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,zr(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new ni(n,i):null}static _create(e,t){return new ni(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class ri extends Yr{constructor(e){pn(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return ri.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return ri.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=ni.fromJSON(e);return pn(t,"argument-error"),t}static samlCredentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{pendingToken:n,providerId:r}=t;if(!n||!r)return null;try{return ni._create(r,n)}catch(i){return null}}}class ii extends Xr{constructor(){super("twitter.com")}static credential(e,t){return Gr._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return ii.credential(n,r)}catch(i){return null}}}async function si(e,t){return Nn(e,"POST","/v1/accounts:signUp",Cn(e,t))}ii.TWITTER_SIGN_IN_METHOD="twitter.com",ii.PROVIDER_ID="twitter.com";class oi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Yn._fromIdTokenResponse(e,n,r),s=ai(n);return new oi({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=ai(n);return new oi({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ai(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ci extends M{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,ci.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new ci(e,t,n,r)}}function ui(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw ci._fromErrorAndOperation(e,n,t,r);throw n})}function li(e){return new Set(e.map(e=>{let{providerId:t}=e;return t}).filter(e=>!!e))}async function hi(e,t){const n=Q(e);await fi(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return An(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=li(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function di(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await zn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return oi._forOperation(e,"link",r)}async function fi(e,t,n){await Hn(t);const r=!1===e?"provider-already-linked":"no-such-provider";pn(li(t.providerData).has(n)===e,t.auth,r)}async function pi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(lt(r.app))return Promise.reject(hn(r));const i="reauthenticate";try{const s=await zn(e,ui(r,i,t,e),n);pn(s.idToken,r,"internal-error");const o=qn(s.idToken);pn(o,r,"internal-error");const{sub:a}=o;return pn(e.uid===a,r,"user-mismatch"),oi._forOperation(e,i,s)}catch(s){throw(null===s||void 0===s?void 0:s.code)==="auth/".concat("user-not-found")&&cn(r,"user-mismatch"),s}}async function gi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(lt(e.app))return Promise.reject(hn(e));const r="signIn",i=await ui(e,r,t),s=await oi._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function mi(e,t){return gi(yr(e),t)}async function yi(e,t){const n=Q(e);return await fi(!1,n,t.providerId),di(n,t)}async function vi(e,t){return pi(Q(e),t)}async function wi(e,t){if(lt(e.app))return Promise.reject(hn(e));const n=yr(e),r=await async function(e,t){return Nn(e,"POST","/v1/accounts:signInWithCustomToken",Cn(e,t))}(n,{token:t,returnSecureToken:!0}),i=await oi._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class _i{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Ii._fromServerResponse(e,t):"totpInfo"in t?bi._fromServerResponse(e,t):cn(e,"internal-error")}}class Ii extends _i{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Ii(t)}}class bi extends _i{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new bi(t)}}function Ti(e,t,n){var r;pn((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),pn("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),pn("undefined"===typeof n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(pn(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(pn(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Ei(e){const t=yr(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Si(e,t){await async function(e,t){return An(e,"POST","/v1/accounts:update",Cn(e,t))}(Q(e),{oobCode:t})}async function Ci(e,t){const n=Q(e),r=await Mr(n,{oobCode:t}),i=r.requestType;switch(pn(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":pn(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":pn(r.mfaInfo,n,"internal-error");default:pn(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=_i._fromServerResponse(yr(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Ai(e,t){const n={identifier:t,continueUri:vn()?yn():"http://localhost"},{signinMethods:r}=await async function(e,t){return An(e,"POST","/v1/accounts:createAuthUri",Cn(e,t))}(Q(e),n);return r||[]}async function ki(e,t){const n=Q(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Ti(n.auth,r,t);const{email:i}=await async function(e,t){return Ur(e,t)}(n.auth,r);i!==e.email&&await e.reload()}async function Ni(e,t,n){const r=Q(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Ti(r.auth,i,n);const{email:s}=await async function(e,t){return Ur(e,t)}(r.auth,i);s!==e.email&&await e.reload()}async function Ri(e,t){let{displayName:n,photoURL:r}=t;if(void 0===n&&void 0===r)return;const i=Q(e),s={idToken:await i.getIdToken(),displayName:n,photoUrl:r,returnSecureToken:!0},o=await zn(i,async function(e,t){return An(e,"POST","/v1/accounts:update",t)}(i.auth,s));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(e=>{let{providerId:t}=e;return"password"===t});a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}async function Di(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await zn(e,async function(e,t){return An(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(s,!0)}class Pi{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.isNewUser=e,this.providerId=t,this.profile=n}}class xi extends Pi{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Oi extends Pi{constructor(e,t){super(e,"facebook.com",t)}}class Li extends xi{constructor(e,t){super(e,"github.com",t,"string"===typeof(null===t||void 0===t?void 0:t.login)?null===t||void 0===t?void 0:t.login:null)}}class Mi extends Pi{constructor(e,t){super(e,"google.com",t)}}class Fi extends xi{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Vi(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;const{providerId:t}=e,n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!==e&&void 0!==e&&e.idToken){var i;const t=null===(i=qn(e.idToken))||void 0===i||null===(i=i.firebase)||void 0===i?void 0:i.sign_in_provider;if(t)return new Pi(r,"anonymous"!==t&&"custom"!==t?t:null)}if(!t)return null;switch(t){case"facebook.com":return new Oi(r,n);case"github.com":return new Li(r,n);case"google.com":return new Mi(r,n);case"twitter.com":return new Fi(r,n,e.screenName||null);case"custom":case"anonymous":return new Pi(r,null);default:return new Pi(r,t,n)}}(n)}class Ui{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new Ui("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ui("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){if(null!==e&&void 0!==e&&e.multiFactorSession){var t,n;if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Ui._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(n=e.multiFactorSession)&&void 0!==n&&n.idToken)return Ui._fromIdtoken(e.multiFactorSession.idToken)}return null}}class ji{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=yr(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>_i._fromServerResponse(n,e));pn(r.mfaPendingCredential,n,"internal-error");const s=Ui._fromMfaPendingCredential(r.mfaPendingCredential);return new ji(s,i,async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=l(l({},r),{},{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await oi._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return pn(t.user,n,"internal-error"),oi._forOperation(t.user,t.operationType,o);default:cn(n,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function qi(e,t){return An(e,"POST","/v2/accounts/mfaEnrollment:start",Cn(e,t))}class Bi{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>_i._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new Bi(e)}async getSession(){return Ui._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),i=await zn(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"===typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await zn(this.user,function(e,t){return An(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Cn(e,t))}(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(e=>{let{uid:n}=e;return n!==t}),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(r){throw r}}}const zi=new WeakMap;const Gi="__sak";class Ki{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gi,"1"),this.storage.removeItem(Gi),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Hi extends Ki{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=dr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);P()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Hi.type="LOCAL";const Wi=Hi;function Qi(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp("".concat(r,"=([^;]+)"));return null!==(t=null===(n=document.cookie.match(i))||void 0===n?void 0:n[1])&&void 0!==t?t:null}function Ji(e){const t="http:"===window.location.protocol;return"".concat(t?"__dev_":"__HOST-","FIREBASE_").concat(e.split(":")[3])}class Yi{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL("".concat(window.location.origin,"/__cookies__"));return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Ji(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return Qi(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=Ji(e);document.cookie="".concat(t,"=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High"),await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=Ji(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=Qi(n);const i=setInterval(()=>{const e=Qi(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(i))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Yi.type="COOKIE";class Xi extends Ki{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Xi.type="SESSION";const $i=Xi;class Zi{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Zi(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(null===s||void 0===s||!s.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map(async e=>e(t.origin,i)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function es(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Zi.receivers=[];class ts{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const c=es("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function ns(){return window}function rs(){return"undefined"!==typeof ns().WorkerGlobalScope&&"function"===typeof ns().importScripts}const is="firebaseLocalStorageDb",ss="firebaseLocalStorage",os="fbase_key";class as{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function cs(e,t){return e.transaction([ss],t?"readwrite":"readonly").objectStore(ss)}function us(){const e=indexedDB.open(is,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ss,{keyPath:os})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ss)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(is);return new as(e).toPromise()}(),t(await us()))})})}async function ls(e,t,n){const r=cs(e,!0).put({[os]:t,value:n});return new as(r).toPromise()}function hs(e,t){const n=cs(e,!0).delete(t);return new as(n).toPromise()}class ds{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await us()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rs()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Zi._getInstance(rs()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){var e;if(null===(e=navigator)||void 0===e||!e.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new ts(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=navigator)||void 0===e||null===(e=e.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await us();return await ls(e,Gi,"1"),await hs(e,Gi),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ls(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=cs(e,!1).get(t),r=await new as(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>hs(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=cs(e,!1).getAll();return new as(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ds.type="LOCAL";const fs=ds;function ps(e,t){return An(e,"POST","/v2/accounts/mfaSignIn:start",Cn(e,t))}const gs=Ir("rcb"),ms=new _n(3e4,6e4);class ys{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=ns().grecaptcha)||void 0===e||!e.render)}load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return pn(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&On(ns().grecaptcha)?Promise.resolve(ns().grecaptcha):new Promise((n,r)=>{const i=ns().setTimeout(()=>{r(un(e,"network-request-failed"))},ms.get());ns()[gs]=()=>{ns().clearTimeout(i),delete ns()[gs];const s=ns().grecaptcha;if(!s||!On(s))return void r(un(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)};_r("".concat(wr.recaptchaV2Script,"?").concat(B({onload:gs,render:"explicit",hl:t}))).catch(()=>{clearTimeout(i),r(un(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=ns().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class vs{async load(e){return new Tr(e)}clearedOneInstance(){}}const ws="recaptcha",_s={theme:"light",type:"image"};class Is{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l({},_s);this.parameters=n,this.type=ws,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=yr(e),this.isInvisible="invisible"===this.parameters.size,pn("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"===typeof t?document.getElementById(t):t;pn(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new vs:new ys,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){pn(!this.parameters.sitekey,this.auth,"argument-error"),pn(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),pn("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"===typeof e)e(t);else if("string"===typeof e){const n=ns()[e];"function"===typeof n&&n(t)}}}assertNotDestroyed(){pn(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){pn(vn()&&!rs(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await An(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);pn(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return pn(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class bs{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Wr._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Ts(e,t,n){if(!e._getRecaptchaConfig())try{await Dr(e)}catch(i){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){pn("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=Rr(e,r,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Ar){pn((null===n||void 0===n?void 0:n.type)===ws,e,"argument-error");return qi(e,await Es(e,t,n))}return qi(e,t)},"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{var r;pn("signin"===t.type,e,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;pn(s,e,"missing-multi-factor-info");const o={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=Rr(e,o,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Ar){pn((null===n||void 0===n?void 0:n.type)===ws,e,"argument-error");return ps(e,await Es(e,t,n))}return ps(e,t)},"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=Rr(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===Ar){pn((null===n||void 0===n?void 0:n.type)===ws,e,"argument-error");return Kr(e,await Es(e,t,n))}return Kr(e,t)},"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function Es(e,t,n){pn(n.type===ws,e,"argument-error");const r=await n.verify();pn("string"===typeof r,e,"argument-error");const i=l({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class Ss{constructor(e){this.providerId=Ss.PROVIDER_ID,this.auth=yr(e)}verifyPhoneNumber(e,t){return Ts(this.auth,e,Q(t))}static credential(e,t){return Wr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ss.credentialFromTaggedObject(t)}static credentialFromError(e){return Ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?Wr._fromTokenResponse(n,r):null}}function Cs(e,t){return t?$n(t):(pn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ss.PROVIDER_ID="phone",Ss.PHONE_SIGN_IN_METHOD="phone";class As extends Lr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return zr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return zr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ks(e){return gi(e.auth,new As(e),e.bypassAuthState)}function Ns(e){const{auth:t,user:n}=e;return pn(n,t,"internal-error"),pi(n,new As(e),e.bypassAuthState)}async function Rs(e){const{auth:t,user:n}=e;return pn(n,t,"internal-error"),di(n,new As(e),e.bypassAuthState)}class Ds{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ks;case"linkViaPopup":case"linkViaRedirect":return Rs;case"reauthViaPopup":case"reauthViaRedirect":return Ns;default:cn(this.auth,"internal-error")}}resolve(e){mn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){mn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ps=new _n(2e3,1e4);class xs extends Ds{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,xs.currentPopupAction&&xs.currentPopupAction.cancel(),xs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pn(e,this.auth,"internal-error"),e}async onExecution(){mn(1===this.filter.length,"Popup operations only handle one event");const e=es();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(un(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(un(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t;null!==(t=this.authWindow)&&void 0!==t&&null!==(t=t.window)&&void 0!==t&&t.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(un(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Ps.get())};e()}}xs.currentPopupAction=null;const Os=new Map;class Ls extends Ds{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Os.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Us(t),r=Vs(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Os.set(this.auth._key(),e)}return this.bypassAuthState||Os.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Ms(e,t){return Vs(e)._set(Us(t),"true")}function Fs(e,t){Os.set(e._key(),t)}function Vs(e){return $n(e._redirectPersistence)}function Us(e){return tr("pendingRedirect",e.config.apiKey,e.name)}function js(e,t,n){return async function(e,t,n){if(lt(e.app))return Promise.reject(hn(e));const r=yr(e);dn(e,t,Yr),await r._initializationPromise;const i=Cs(r,n);return await Ms(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function qs(e,t,n){return async function(e,t,n){const r=Q(e);if(dn(r.auth,t,Yr),lt(r.auth.app))return Promise.reject(hn(r.auth));await r.auth._initializationPromise;const i=Cs(r.auth,n);await Ms(i,r.auth);const s=await Gs(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function Bs(e,t,n){return async function(e,t,n){const r=Q(e);dn(r.auth,t,Yr),await r.auth._initializationPromise;const i=Cs(r.auth,n);await fi(!1,r,t.providerId),await Ms(i,r.auth);const s=await Gs(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function zs(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(lt(e.app))return Promise.reject(hn(e));const r=yr(e),i=Cs(r,t),s=new Ls(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Gs(e){const t=es("".concat(e.uid,":::"));return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Ks{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ws(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Ws(e)){var n;const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(un(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hs(e))}saveEventToCache(e){this.cachedEventUids.add(Hs(e)),this.lastProcessedEventTime=Date.now()}}function Hs(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ws(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}async function Qs(e){return An(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}const Js=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ys=/^https?/;function Xs(e){const t=yn(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Ys.test(n))return!1;if(Js.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const $s=new _n(3e4,6e4);function Zs(){const e=ns().___jsl;if(null!==e&&void 0!==e&&e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function eo(e){return new Promise((t,n)=>{var r,i;function s(){Zs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Zs(),n(un(e,"network-request-failed"))},timeout:$s.get()})}if(null!==(r=ns().gapi)&&void 0!==r&&null!==(r=r.iframes)&&void 0!==r&&r.Iframe)t(gapi.iframes.getContext());else{if(null===(i=ns().gapi)||void 0===i||!i.load){const t=Ir("iframefcb");return ns()[t]=()=>{gapi.load?s():n(un(e,"network-request-failed"))},_r("".concat(wr.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}s()}}).catch(e=>{throw to=null,e})}let to=null;const no=new _n(5e3,15e3),ro={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},io=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function so(e){const t=e.config;pn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?In(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:mt},i=io.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),"".concat(n,"?").concat(B(r).slice(1))}async function oo(e){const t=await function(e){return to=to||eo(e),to}(e),n=ns().gapi;return pn(n,e,"internal-error"),t.open({where:document.body,url:so(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ro,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=un(e,"network-request-failed"),s=ns().setTimeout(()=>{r(i)},no.get());function o(){ns().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}const ao={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class co{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function uo(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=l(l({},ao),{},{width:r.toString(),height:i.toString(),top:s,left:o}),u=A().toLowerCase();n&&(a=or(u)?"_blank":n),ir(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return hr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A())&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new co(null);const d=window.open(t||"",a,h);pn(d,e,"popup-blocked");try{d.focus()}catch(f){}return new co(d)}const lo="__/auth/handler",ho="emulator/auth/handler",fo=encodeURIComponent("fac");async function po(e,t,n,r,i,s){pn(e.config.authDomain,e,"auth-domain-config-required"),pn(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:mt,eventId:i};if(t instanceof Yr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Xr){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const l of Object.keys(a))void 0===a[l]&&delete a[l];const c=await e._getAppCheckToken(),u=c?"#".concat(fo,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(lo);return In(t,ho)}(e),"?").concat(B(a).slice(1)).concat(u)}const go="webStorageSupport";const mo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$i,this._completeRedirectFn=zs,this._overrideRedirectResult=Fs}async _openPopup(e,t,n,r){var i;mn(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return uo(e,await po(e,t,n,yn(),r),es())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){ns().location.href=e}(await po(e,t,n,yn(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(mn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await oo(e),n=new Ks(e);return t.register("authEvent",t=>{pn(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(go,{type:go},n=>{var r;const i=null===n||void 0===n||null===(r=n[0])||void 0===r?void 0:r[go];void 0!==i&&t(!!i),cn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Qs(e);for(const r of t)try{if(Xs(r))return}catch(n){}cn(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return dr()||sr()||hr()}};class yo{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return gn("unexpected MultiFactorSessionType")}}}class vo extends yo{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new vo(e)}_finalizeEnroll(e,t,n){return function(e,t){return An(e,"POST","/v2/accounts/mfaEnrollment:finalize",Cn(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return An(e,"POST","/v2/accounts/mfaSignIn:finalize",Cn(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class wo{constructor(){}static assertion(e){return vo._fromCredential(e)}}wo.FACTOR_ID="phone";var _o="@firebase/auth",Io="1.12.0";class bo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){pn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(e=>{var t;null===(t=w())||void 0===t||t["_".concat(e)]})("authIdTokenMaxAge");var To;function Eo(){return window}wr={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=un("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},To="Browser",st(new J("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;pn(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:To,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fr(To)},u=new mr(r,i,s,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map($n);null!==t&&void 0!==t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),st(new J("auth-internal",e=>(e=>new bo(e))(yr(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),bt(_o,Io,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(To)),bt(_o,Io,"esm2020");async function So(e,t,n){var r;const{BuildInfo:i}=Eo();mn(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(mn(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!==typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId),o={};return hr()?o.ibi=i.packageName:cr()?o.apn=i.packageName:cn(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,po(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}function Co(e){const{cordova:t}=Eo();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)})})}class Ao extends Ks{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInitialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}async function ko(e){const t=await Do()._get(Po(e));return t&&await Do()._remove(Po(e)),t}function No(e,t){const n=function(e){const t=xo(e),n=t.link?decodeURIComponent(t.link):void 0,r=xo(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return xo(i).link||i||r||n||e}(t);if(n.includes("/__/auth/callback")){var r;const t=xo(n),i=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,s=null===i||void 0===i||null===(r=i.code)||void 0===r||null===(r=r.split("auth/"))||void 0===r?void 0:r[1],o=s?un(s):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:n,postBody:null}}return null}function Ro(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(62*Math.random());e.push(t.charAt(n))}return e.join("")}function Do(){return $n(Wi)}function Po(e){return tr("authEvent",e.config.apiKey,e.name)}function xo(e){if(null===e||void 0===e||!e.includes("?"))return{};const[t,...n]=e.split("?");return z(n.join("?"))}const Oo=class{constructor(){this._redirectPersistence=$i,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=zs,this._overrideRedirectResult=Fs}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Ao(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){cn(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s;const o=Eo();pn("function"===typeof(null===o||void 0===o||null===(t=o.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),pn("undefined"!==typeof(null===o||void 0===o||null===(n=o.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),pn("function"===typeof(null===o||void 0===o||null===(r=o.cordova)||void 0===r||null===(r=r.plugins)||void 0===r||null===(r=r.browsertab)||void 0===r?void 0:r.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),pn("function"===typeof(null===o||void 0===o||null===(i=o.cordova)||void 0===i||null===(i=i.plugins)||void 0===i||null===(i=i.browsertab)||void 0===i?void 0:i.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),pn("function"===typeof(null===o||void 0===o||null===(s=o.cordova)||void 0===s||null===(s=s.InAppBrowser)||void 0===s?void 0:s.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Os.clear(),await this._originValidation(e);const s=function(e,t){return{type:t,eventId:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,urlResponse:null,sessionId:Ro(),postBody:null,tenantId:e.tenantId,error:un(e,"no-auth-event")}}(e,n,r);await function(e,t){return Do()._set(Po(e),t)}(e,s);const o=await So(e,s,t);return async function(e,t,n){const{cordova:r}=Eo();let i=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"===typeof t&&t(),"function"===typeof(null===n||void 0===n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout(()=>{o(un(e,"redirect-cancelled-by-user"))},2e3))}function l(){var e;"visible"===(null===(e=document)||void 0===e?void 0:e.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),cr()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}})}finally{i()}}(e,i,await Co(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Eo(),n={};hr()?n.iosBundleId=t.packageName:cr()?n.androidPackageName=t.packageName:cn(e,"operation-not-supported-in-this-environment"),await Qs(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=Eo(),s=setTimeout(async()=>{await ko(e),t.onEvent(Lo())},500),o=async n=>{clearTimeout(s);const r=await ko(e);let i=null;r&&null!==n&&void 0!==n&&n.url&&(i=No(r,n.url)),t.onEvent(i||Lo())};"undefined"!==typeof n&&"function"===typeof n.subscribe&&n.subscribe(null,o);const a=r,c="".concat(i.packageName.toLowerCase(),"://");Eo().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"===typeof a)try{a(e)}catch(t){console.error(t)}}}};function Lo(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:un("no-auth-event")}}function Mo(){var e;return(null===(e=self)||void 0===e||null===(e=e.location)||void 0===e?void 0:e.protocol)||null}function Fo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return!("file:"!==Mo()&&"ionic:"!==Mo()&&"capacitor:"!==Mo()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Vo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return function(){var e;return P()&&11===(null===(e=document)||void 0===e?void 0:e.documentMode)}()||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/Edge\/\d+/.test(e)}(e)}function Uo(){try{const e=self.localStorage,t=es();if(e)return e.setItem(t,"1"),e.removeItem(t),!Vo()||L()}catch(e){return jo()&&L()}return!1}function jo(){return"undefined"!==typeof n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function qo(){return("http:"===Mo()||"https:"===Mo()||R()||Fo())&&!(D()||k())&&Uo()&&!jo()}function Bo(){return Fo()&&"undefined"!==typeof document}const zo={LOCAL:"local",NONE:"none",SESSION:"session"},Go=pn,Ko="persistence";async function Ho(e){await e._initializationPromise;const t=Wo(),n=tr(Ko,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistenceType())}function Wo(){try{var e;return(null===(e="undefined"!==typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(t){return null}}const Qo=pn;class Jo{constructor(){this.browserResolver=$n(mo),this.cordovaResolver=$n(Oo),this.underlyingResolver=null,this._redirectPersistence=$i,this._completeRedirectFn=zs,this._overrideRedirectResult=Fs}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Bo()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Qo(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Bo()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Yo(e){return e.unwrap()}function Xo(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null===t||void 0===t?void 0:t.code)){t.resolver=new ta(e,function(e,t){var n;const r=Q(e),i=t;return pn(t.customData.operationType,r,"argument-error"),pn(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),ji._fromError(r,i)}(e,t))}else if(r){const e=$o(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function $o(e){const{_tokenResponse:t}=e instanceof M?e.customData:e;if(!t)return null;if(!(e instanceof M)&&"temporaryProof"in t&&"phoneNumber"in t)return Ss.credentialFromResult(e);const n=t.providerId;if(!n||n===Wt)return null;let r;switch(n){case Ht:r=ei;break;case Gt:r=Zr;break;case Kt:r=ti;break;case Qt:r=ii;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?ni._create(n,o):Gr._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new $r(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof M?r.credentialFromError(e):r.credentialFromResult(e)}function Zo(e,t){return t.catch(t=>{throw t instanceof M&&Xo(e,t),t}).then(e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,$o(r)),additionalUserInfo:Vi(e),user:na.getOrCreate(n)};var r})}async function ea(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Zo(e,n.confirm(t))}}class ta{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Zo(Yo(this.auth),this.resolver.resolveSignIn(e))}}class na{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=Q(e);return zi.has(t)||zi.set(t,Bi._fromUser(t)),zi.get(t)}(e)}static getOrCreate(e){return na.USER_MAP.has(e)||na.USER_MAP.set(e,new na(e)),na.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Zo(this.auth,yi(this._delegate,e))}async linkWithPhoneNumber(e,t){return ea(this.auth,async function(e,t,n){const r=Q(e);await fi(!1,r,"phone");const i=await Ts(r.auth,t,Q(n));return new bs(i,e=>yi(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Zo(this.auth,async function(e,t,n){const r=Q(e);dn(r.auth,t,Yr);const i=Cs(r.auth,n);return new xs(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Jo))}async linkWithRedirect(e){return await Ho(yr(this.auth)),Bs(this._delegate,e,Jo)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Zo(this.auth,vi(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return ea(this.auth,async function(e,t,n){const r=Q(e);if(lt(r.auth.app))return Promise.reject(hn(r.auth));const i=await Ts(r.auth,t,Q(n));return new bs(i,e=>vi(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Zo(this.auth,async function(e,t,n){const r=Q(e);if(lt(r.auth.app))return Promise.reject(un(r.auth,"operation-not-supported-in-this-environment"));dn(r.auth,t,Yr);const i=Cs(r.auth,n);return new xs(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Jo))}async reauthenticateWithRedirect(e){return await Ho(yr(this.auth)),qs(this._delegate,e,Jo)}sendEmailVerification(e){return ki(this._delegate,e)}async unlink(e){return await hi(this._delegate,e),this}updateEmail(e){return function(e,t){const n=Q(e);return lt(n.auth.app)?Promise.reject(hn(n.auth)):Di(n,t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Di(Q(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){const n=Q(e);if(lt(n.auth.app))return Promise.reject(hn(n.auth));await di(n,t)}(this._delegate,e)}updateProfile(e){return Ri(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Ni(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}na.USER_MAP=new WeakMap;const ra=pn;class ia{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;ra(n,"invalid-api-key",{appName:e.name}),ra(n,"invalid-api-key",{appName:e.name});const r="undefined"!==typeof window?Jo:void 0;this._delegate=t.initialize({options:{persistence:oa(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(nn),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?na.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Pr(this._delegate,e,t)}applyActionCode(e){return Si(this._delegate,e)}checkActionCode(e){return Ci(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Mr(Q(e),{oobCode:t,newPassword:n}).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Ei(e),t})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Zo(this._delegate,async function(e,t,n){if(lt(e.app))return Promise.reject(hn(e));const r=yr(e),i=Rr(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",si,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Ei(e),t}),o=await oi._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Ai(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=Qr.parseLink(t);return"EMAIL_SIGNIN"===(null===n||void 0===n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){ra(qo(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await yr(e)._initializationPromise,zs(e,t,!1)}(this._delegate,Jo);return e?Zo(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){yr(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=sa(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=sa(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=yr(e),i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};!function(e,t){pn(t.handleCodeInApp,r,"argument-error"),t&&Ti(r,e,t)}(i,n),await Rr(r,i,"getOobCode",qr,"EMAIL_PASSWORD_PROVIDER")}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=yr(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&Ti(r,i,n),await Rr(r,i,"getOobCode",jr,"EMAIL_PASSWORD_PROVIDER")}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Go(Object.values(zo).includes(t),e,"invalid-persistence-type"),D()?Go(t!==zo.SESSION,e,"unsupported-persistence-type"):k()?Go(t===zo.NONE,e,"unsupported-persistence-type"):jo()?Go(t===zo.NONE||t===zo.LOCAL&&L(),e,"unsupported-persistence-type"):Go(t===zo.NONE||Uo(),e,"unsupported-persistence-type")}(this._delegate,e),e){case zo.SESSION:t=$i;break;case zo.LOCAL:t=await $n(fs)._isAvailable()?fs:Wi;break;case zo.NONE:t=er;break;default:return cn("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Zo(this._delegate,async function(e){var t;if(lt(e.app))return Promise.reject(hn(e));const n=yr(e);if(await n._initializationPromise,null!==(t=n.currentUser)&&void 0!==t&&t.isAnonymous)return new oi({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await si(n,{returnSecureToken:!0}),i=await oi._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Zo(this._delegate,mi(this._delegate,e))}signInWithCustomToken(e){return Zo(this._delegate,wi(this._delegate,e))}signInWithEmailAndPassword(e,t){return Zo(this._delegate,function(e,t,n){return lt(e.app)?Promise.reject(hn(e)):mi(Q(e),Jr.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Ei(e),t})}(this._delegate,e,t))}signInWithEmailLink(e,t){return Zo(this._delegate,async function(e,t,n){if(lt(e.app))return Promise.reject(hn(e));const r=Q(e),i=Jr.credentialWithLink(t,n||yn());return pn(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),mi(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return ea(this._delegate,async function(e,t,n){if(lt(e.app))return Promise.reject(hn(e));const r=yr(e),i=await Ts(r,t,Q(n));return new bs(i,e=>mi(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return ra(qo(),this._delegate,"operation-not-supported-in-this-environment"),Zo(this._delegate,async function(e,t,n){if(lt(e.app))return Promise.reject(un(e,"operation-not-supported-in-this-environment"));const r=yr(e);dn(e,t,Yr);const i=Cs(r,n);return new xs(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Jo))}async signInWithRedirect(e){return ra(qo(),this._delegate,"operation-not-supported-in-this-environment"),await Ho(this._delegate),js(this._delegate,e,Jo)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await Ci(Q(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function sa(e,t,n){let r=e;"function"!==typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&na.getOrCreate(e)),error:t,complete:n}}function oa(e,t){const n=function(e,t){const n=Wo();if(!n)return[];const r=tr(Ko,e,t);switch(n.getItem(r)){case zo.NONE:return[er];case zo.LOCAL:return[fs,$i];case zo.SESSION:return[$i];default:return[]}}(e,t);if("undefined"===typeof self||n.includes(fs)||n.push(fs),"undefined"!==typeof window)for(const r of[Wi,$i])n.includes(r)||n.push(r);return n.includes(er)||n.push(er),n}ia.Persistence=zo;class aa{static credential(e,t){return Ss.credential(e,t)}constructor(){this.providerId="phone",this._delegate=new Ss(Yo(Ut.auth()))}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}aa.PHONE_SIGN_IN_METHOD=Ss.PHONE_SIGN_IN_METHOD,aa.PROVIDER_ID=Ss.PROVIDER_ID;const ca=pn;class ua{constructor(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ut.app();ca(null===(n=r.options)||void 0===n?void 0:n.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new Is(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var la;(la=Ut).INTERNAL.registerComponent(new J("auth-compat",e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new ia(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Jt,PASSWORD_RESET:Yt,RECOVER_EMAIL:Xt,REVERT_SECOND_FACTOR_ADDITION:$t,VERIFY_AND_CHANGE_EMAIL:Zt,VERIFY_EMAIL:en}},EmailAuthProvider:Jr,FacebookAuthProvider:Zr,GithubAuthProvider:ti,GoogleAuthProvider:ei,OAuthProvider:$r,SAMLAuthProvider:ri,PhoneAuthProvider:aa,PhoneMultiFactorGenerator:wo,RecaptchaVerifier:ua,TwitterAuthProvider:ii,Auth:ia,AuthCredential:Lr,Error:M}).setInstantiationMode("LAZY").setMultipleInstances(!1)),la.registerVersion("@firebase/auth-compat","0.6.2");var ha,da,fa="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},pa={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const r=Array(16);if("string"===typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s,o=e.g[3];s=t+(o^n&(i^o))+r[0]+3614090360&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[1]+3905402710&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[2]+606105819&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[3]+3250441966&4294967295,s=t+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[4]+4118548399&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[5]+1200080426&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[6]+2821735955&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[7]+4249261313&4294967295,s=t+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[8]+1770035416&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[9]+2336552879&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[10]+4294925233&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[11]+2304563134&4294967295,s=t+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[12]+1804603682&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[13]+4254626195&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[14]+2792965006&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[15]+1236535329&4294967295,s=t+(i^o&((n=i+(s<<22&4294967295|s>>>10))^i))+r[1]+4129170786&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[6]+3225465664&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[11]+643717713&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[0]+3921069994&4294967295,s=t+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[5]+3593408605&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[10]+38016083&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[15]+3634488961&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[4]+3889429448&4294967295,s=t+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[9]+568446438&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[14]+3275163606&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[3]+4107603335&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[8]+1163531501&4294967295,s=t+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[13]+2850285829&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[2]+4243563512&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[7]+1735328473&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[12]+2368359562&4294967295,s=t+((n=i+(s<<20&4294967295|s>>>12))^i^o)+r[5]+4294588738&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[8]+2272392833&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[11]+1839030562&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[14]+4259657740&4294967295,s=t+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[1]+2763975236&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[4]+1272893353&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[7]+4139469664&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[10]+3200236656&4294967295,s=t+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[13]+681279174&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[0]+3936430074&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[3]+3572445317&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[6]+76029189&4294967295,s=t+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[9]+3654602809&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[12]+3873151461&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[15]+530742520&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[2]+3299628645&4294967295,s=t+(i^((n=i+(s<<23&4294967295|s>>>9))|~o))+r[0]+4096336452&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[7]+1126891415&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[14]+2878612391&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[5]+4237533241&4294967295,s=t+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[12]+1700485571&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[3]+2399980690&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[10]+4293915773&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[1]+2240044497&4294967295,s=t+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[8]+1873313359&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[15]+4264355552&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[6]+2734768916&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[13]+1309151649&4294967295,s=t+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[4]+4149444226&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[11]+3174756917&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[2]+718787259&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+o&4294967295}function r(e,t){this.h=t;const n=[];let r=!0;for(let i=e.length-1;i>=0;i--){const s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,i=this.C;let s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"===typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var i={};function s(e){return-128<=e&&e<128?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],e<0?-1:0)}):new r([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(e<0)return d(o(-e));const t=[];let n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new r(t,0)}var a=s(0),c=s(1),u=s(16777216);function l(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(l(t))throw Error("division by zero");if(l(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(e.g.length>30){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;r.l(e)<=0;)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var u=s.add(r);u.l(e)<=0&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return t=f(e,i.j(t)),new g(i,t)}for(i=a;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),u=(s=o(n)).j(t);h(u)||u.l(e)>0;)u=(s=o(n-=r)).j(t);l(s)&&(s=c),i=i.add(s),e=f(e,u)}return new g(i,e)}function y(e){const t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(n,e.h)}function v(e,t){const n=t>>5;t%=32;const i=e.g.length-n,s=[];for(let r=0;r<i;r++)s[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);const t=o(Math.pow(e,6));var n=this;let r="";for(;;){const i=m(n,t).g;let s=(((n=f(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(l(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let i=0;for(let r=0;r<=t;r++){let t=i+(65535&this.i(r))+(65535&e.i(r)),s=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);i=s>>>16,t&=65535,s&=65535,n[r]=s<<16|t}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(this.l(u)<0&&e.l(u)<0)return o(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){const r=this.i(i)>>>16,s=65535&this.i(i),o=e.i(t)>>>16,a=65535&e.i(t);n[2*i+2*t]+=s*a,p(n,2*i+2*t),n[2*i+2*t+1]+=r*a,p(n,2*i+2*t+1),n[2*i+2*t+1]+=s*o,p(n,2*i+2*t+1),n[2*i+2*t+2]+=r*o,p(n,2*i+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},e.B=function(e){return m(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new r(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new r(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,da=pa.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=o(Math.pow(n,8));let i=a;for(let a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+s),n);s<8?(s=o(Math.pow(n,s)),i=i.j(s).add(o(e))):(i=i.j(r),i=i.add(o(e)))}return i},ha=pa.Integer=r}).apply("undefined"!==typeof fa?fa:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var ga,ma,ya,va,wa,_a,Ia,ba,Ta="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Ea={};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ta&&Ta];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var i=i||{},s=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function l(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var h="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function p(e){s.setTimeout(()=>{throw e},0)}function g(){var e=_;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var m=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,w=!1,_=new class{constructor(){this.h=this.g=null}add(e,t){const n=m.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},I=()=>{const e=Promise.resolve(void 0);v=()=>{e.then(b)}};function b(){for(var e;e=g();){try{e.h.call(e.g)}catch(n){p(n)}var t=m;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}w=!1}function T(){this.u=this.u,this.C=this.C}function E(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},E.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(n){}return e}();function C(e){return/^[\s\xa0]*$/.test(e)}function A(e,t){E.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}l(A,E),A.prototype.init=function(e,t){const n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var k="closure_listenable_"+(1e6*Math.random()|0),N=0;function R(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++N,this.da=this.fa=!1}function D(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function x(e){const t={};for(const n in e)t[n]=e[n];return t}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<O.length;t++)n=O[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function M(e){this.src=e,this.g={},this.h=0}function F(e,t){const n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(D(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function V(e,t,n,r){for(let i=0;i<e.length;++i){const s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}M.prototype.add=function(e,t,n,r,i){const s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);const o=V(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new R(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var U="closure_lm_"+(1e6*Math.random()|0),j={};function q(e,t,n,r,i){if(r&&r.once)return z(e,t,n,r,i);if(Array.isArray(t)){for(let s=0;s<t.length;s++)q(e,t[s],n,r,i);return null}return n=Y(n),e&&e[k]?e.J(t,n,o(r)?!!r.capture:!!r,i):B(e,t,n,!1,r,i)}function B(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");const a=o(i)?!!i.capture:!!i;let c=Q(e);if(c||(e[U]=c=new M(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=W;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)S||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(H(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function z(e,t,n,r,i){if(Array.isArray(t)){for(let s=0;s<t.length;s++)z(e,t[s],n,r,i);return null}return n=Y(n),e&&e[k]?e.K(t,n,o(r)?!!r.capture:!!r,i):B(e,t,n,!0,r,i)}function G(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)G(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=Y(n),e&&e[k]?(e=e.i,(s=String(t).toString())in e.g&&((n=V(t=e.g[s],n,r,i))>-1&&(D(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[s],e.h--)))):e&&(e=Q(e))&&(t=e.g[t.toString()],e=-1,t&&(e=V(t,n,r,i)),(n=e>-1?t[e]:null)&&K(n))}function K(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[k])F(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(H(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Q(t))?(F(n,e),0==n.h&&(n.src=null,t[U]=null)):D(e)}}}function H(e){return e in j?j[e]:j[e]="on"+e}function W(e,t){if(e.da)e=!0;else{t=new A(t,this);const n=e.listener,r=e.ha||e.src;e.fa&&K(e),e=n.call(r,t)}return e}function Q(e){return(e=e[U])instanceof M?e:null}var J="__closure_events_fn_"+(1e9*Math.random()>>>0);function Y(e){return"function"===typeof e?e:(e[J]||(e[J]=function(t){return e.handleEvent(t)}),e[J])}function X(){T.call(this),this.i=new M(this),this.M=this,this.G=null}function $(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new E(t,e);else if(t instanceof E)t.target=t.target||e;else{var i=t;L(t=new E(r,e),i)}let s,o;if(i=!0,n)for(o=n.length-1;o>=0;o--)s=t.g=n[o],i=Z(s,r,!0,t)&&i;if(s=t.g=e,i=Z(s,r,!0,t)&&i,i=Z(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.g=n[o],i=Z(s,r,!1,t)&&i}function Z(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){const o=t[s];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&F(e.i,o),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}function ee(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:s.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,ee(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}l(X,T),X.prototype[k]=!0,X.prototype.removeEventListener=function(e,t,n,r){G(this,e,t,n,r)},X.prototype.N=function(){if(X.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)D(n[e]);delete e.g[t],e.h--}}this.G=null},X.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},X.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class te extends T{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ee(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ne(e){T.call(this),this.h=e,this.g={}}l(ne,T);var re=[];function ie(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&K(e)},e),e.g={}}ne.prototype.N=function(){ne.Z.N.call(this),ie(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var se=s.JSON.stringify,oe=s.JSON.parse,ae=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function ce(){}function ue(){}var le={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function he(){E.call(this,"d")}function de(){E.call(this,"c")}l(he,E),l(de,E);var fe={},pe=null;function ge(){return pe=pe||new X}function me(e){E.call(this,fe.Ia,e)}function ye(e){const t=ge();$(t,new me(t))}function ve(e,t){E.call(this,fe.STAT_EVENT,e),this.stat=t}function we(e){const t=ge();$(t,new ve(t,e))}function _e(e,t){E.call(this,fe.Ja,e),this.size=t}function Ie(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function be(){this.g=!0}function Te(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const s=JSON.parse(t);if(s)for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}return se(s)}catch(s){return t}}(e,n)+(r?" "+r:"")})}fe.Ia="serverreachability",l(me,E),fe.STAT_EVENT="statevent",l(ve,E),fe.Ja="timingevent",l(_e,E),be.prototype.ua=function(){this.g=!1},be.prototype.info=function(){};var Ee,Se={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ce={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ae(){}function ke(e){return encodeURIComponent(String(e))}function Ne(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Re(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}l(Ae,ce),Ae.prototype.g=function(){return new XMLHttpRequest},Ee=new Ae;var Pe={},xe={};function Oe(e,t,n){e.M=1,e.A=st(et(t)),e.u=n,e.R=!0,Le(e,null)}function Le(e,t){e.F=Date.now(),Ve(e),e.B=et(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),wt(n.i,"t",r),e.C=0,n=e.j.L,e.h=new De,e.g=on(e.j,n?t:null,!e.u),e.P>0&&(e.O=new te(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var i="readystatechange";Array.isArray(i)||(i&&(re[0]=i.toString()),i=re);for(let s=0;s<i.length;s++){const e=q(n,i[s],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?x(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ye(),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s){var o="",a=s.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+c+"&":o+(e+"=redacted&")}}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Me(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Fe(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?xe:(n=Number(t.substring(n,r)),isNaN(n)?Pe:(r+=1)+n>t.length?xe:(t=t.slice(r,r+n),e.C=r+n,t))}function Ve(e){e.T=Date.now()+e.H,Ue(e,e.H)}function Ue(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=Ie(c(e.aa,e),t)}function je(e){e.D&&(s.clearTimeout(e.D),e.D=null)}function qe(e){0==e.j.I||e.K||en(e.j,e)}function Be(e){je(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ie(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ze(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Qe(n.h,e)))if(!e.L&&Qe(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(l){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;Zt(n),zt(n)}Yt(n),we(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=Ie(c(n.Va,n),6e3));We(n.h)<=1&&n.ta&&(n.ta=void 0)}else nn(n,11)}else if((e.L||n.g==e)&&Zt(n),!C(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let c=i[t];const l=c[0];if(!(l<=n.K))if(n.K=l,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const i=c[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));const l=c[5];null!=l&&"number"===typeof l&&l>0&&(r=1.5*l,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Je(s,s.h),s.h=null))}if(r.G){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,it(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((r=n).na=sn(r,r.L?r.ba:null,r.W),o.L){Ye(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(je(a),Ve(a)),r.g=o}else Jt(r);n.i.length>0&&Kt(n)}else"stop"!=c[0]&&"close"!=c[0]||nn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?nn(n,7):Bt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}ye()}catch(l){}}Re.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Vt(e)?t.j():this.Y(e)},Re.prototype.Y=function(e){try{if(e==this.g)e:{const c=Vt(this.g),u=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Ut(this.g)))){this.K||4!=c||7==u||ye(),je(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Me(e))return e.g.la();const t=Ut(e.g);if(""===t)return"";let n="";const r=t.length,i=4==Vt(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return Be(e),qe(e),"";e.h.i=new s.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i=this.g;if((r=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(r)){var o=r;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,we(12),Be(this),qe(this);break e}Te(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ze(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Fe(this,n),t==xe){4==c&&(this.m=4,we(14),e=!1),Te(this.i,this.l,null,"[Incomplete Response]");break}if(t==Pe){this.m=4,we(15),Te(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Te(this.i,this.l,t,null),ze(this,t)}if(Me(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,we(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xt(a),a.P=!0,we(11))}}else Te(this.i,this.l,n,"[Invalid Chunked Response]"),Be(this),qe(this)}else Te(this.i,this.l,n,null),ze(this,n);4==c&&Be(this),this.o&&!this.K&&(4==c?en(this.j,this):(this.o=!1,Ve(this)))}else(function(e){const t={};e=(e.g&&Vt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(C(e[r]))continue;var n=Ne(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,we(12)):(this.m=0,we(13)),Be(this),qe(this)}}}catch(Fc){}},Re.prototype.cancel=function(){this.K=!0,Be(this)},Re.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ye(),we(17)),Be(this),this.m=2,qe(this)):Ue(this,this.T-e)};var Ge=class{constructor(e,t){this.g=e,this.map=t}};function Ke(e){this.l=e||10,s.PerformanceNavigationTiming?e=(e=s.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function He(e){return!!e.h||!!e.g&&e.g.size>=e.j}function We(e){return e.h?1:e.g?e.g.size:0}function Qe(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Je(e,t){e.g?e.g.add(t):e.h=t}function Ye(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Xe(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}Ke.prototype.cancel=function(){if(this.i=Xe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var $e=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ze(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ze?(this.l=e.l,tt(this,e.j),this.o=e.o,this.g=e.g,nt(this,e.u),this.h=e.h,rt(this,_t(e.i)),this.m=e.m):e&&(t=String(e).match($e))?(this.l=!1,tt(this,t[1]||"",!0),this.o=ot(t[2]||""),this.g=ot(t[3]||"",!0),nt(this,t[4]),this.h=ot(t[5]||"",!0),rt(this,t[6]||"",!0),this.m=ot(t[7]||"")):(this.l=!1,this.i=new pt(null,this.l))}function et(e){return new Ze(e)}function tt(e,t,n){e.j=n?ot(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function rt(e,t,n){t instanceof pt?(e.i=t,function(e,t){t&&!e.j&&(gt(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(mt(this,t),wt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=at(t,dt)),e.i=new pt(t,e.l))}function it(e,t,n){e.i.set(t,n)}function st(e){return it(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ot(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function at(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,ct),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ct(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ze.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(at(t,ut,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(at(t,ut,!0),"@"),e.push(ke(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(at(n,"/"==n.charAt(0)?ht:lt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",at(n,ft)),e.join("")},Ze.prototype.resolve=function(e){const t=et(this);let n=!!e.j;n?tt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)nt(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");const e=[];for(let t=0;t<i.length;){const n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?rt(t,_t(e.i)):n=!!e.m,n&&(t.m=e.m),t};var ut=/[#\/\?@]/g,lt=/[#\?:]/g,ht=/[#\?]/g,dt=/[#\?@]/g,ft=/#/g;function pt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function gt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const r=e[n].indexOf("=");let i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function mt(e,t){gt(e),t=It(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function yt(e,t){return gt(e),t=It(e,t),e.g.has(t)}function vt(e,t){gt(e);let n=[];if("string"===typeof t)yt(e,t)&&(n=n.concat(e.g.get(It(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function wt(e,t,n){mt(e,t),n.length>0&&(e.i=null,e.g.set(It(e,t),d(n)),e.h+=n.length)}function _t(e){const t=new pt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function It(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function bt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function Tt(){this.g=new ae}function Et(e){this.i=e.Sb||null,this.h=e.ab||!1}function St(e,t){X.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Ct(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function At(e){e.readyState=4,e.l=null,e.j=null,e.B=null,kt(e)}function kt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Nt(e){let t="";return P(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Rt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Nt(n),"string"===typeof e?null!=n&&ke(n):it(e,t,n))}function Dt(e){X.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=pt.prototype).add=function(e,t){gt(this),this.i=null,e=It(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){gt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.set=function(e,t){return gt(this),this.i=null,yt(this,e=It(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=vt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];const i=ke(n);n=vt(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+ke(n[t])),e.push(r)}}return this.i=e.join("&")},l(Et,ce),Et.prototype.g=function(){return new St(this.i,this.h)},l(St,X),(e=St.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,kt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||s).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,At(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,kt(this)),this.g&&(this.readyState=3,kt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ct(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?At(this):kt(this),3==this.readyState&&Ct(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,At(this))},e.Na=function(e){this.g&&(this.response=e,At(this))},e.ga=function(){this.g&&At(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(St.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),l(Dt,X);var Pt=/^https?$/i,xt=["POST","PUT"];function Ot(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Lt(e),Ft(e)}function Lt(e){e.A||(e.A=!0,$(e,"complete"),$(e,"error"))}function Mt(e){if(e.h&&"undefined"!=typeof i)if(e.v&&4==Vt(e))setTimeout(e.Ca.bind(e),0);else if($(e,"readystatechange"),4==Vt(e)){e.h=!1;try{const i=e.ca();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===i){let t=String(e.D).match($e)[1]||null;!t&&s.self&&s.self.location&&(t=s.self.location.protocol.slice(0,-1)),r=!Pt.test(t?t.toLowerCase():"")}n=r}if(n)$(e,"complete"),$(e,"success");else{e.o=6;try{var o=Vt(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Lt(e)}}finally{Ft(e)}}}function Ft(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||$(e,"ready");try{r.onreadystatechange=null}catch(n){}}}function Vt(e){return e.g?e.g.readyState:0}function Ut(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function jt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function qt(e){this.za=0,this.i=[],this.j=new be,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=jt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=jt("baseRetryDelayMs",5e3,e),this.Za=jt("retryDelaySeedMs",1e4,e),this.Ta=jt("forwardChannelMaxRetries",2,e),this.va=jt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new Ke(e&&e.concurrentRequestLimit),this.Ba=new Tt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Bt(e){if(Gt(e),3==e.I){var t=e.V++,n=et(e.J);if(it(n,"SID",e.M),it(n,"RID",t),it(n,"TYPE","terminate"),Wt(e,n),(t=new Re(e,e.j,t)).M=2,t.A=st(et(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&s.Image&&((new Image).src=t.A,n=!0),n||(t.g=on(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Ve(t)}rn(e)}function zt(e){e.g&&(Xt(e),e.g.cancel(),e.g=null)}function Gt(e){zt(e),e.v&&(s.clearTimeout(e.v),e.v=null),Zt(e),e.h.cancel(),e.m&&("number"===typeof e.m&&s.clearTimeout(e.m),e.m=null)}function Kt(e){if(!He(e.h)&&!e.m){e.m=!0;var t=e.Ea;v||I(),w||(v(),w=!0),_.add(t,e),e.D=0}}function Ht(e,t){var n;n=t?t.l:e.V++;const r=et(e.J);it(r,"SID",e.M),it(r,"RID",n),it(r,"AID",e.K),Wt(e,r),e.u&&e.o&&Rt(r,e.u,e.o),n=new Re(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Qt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Je(e.h,n),Oe(n,r,t)}function Wt(e,t){e.H&&P(e.H,function(e,n){it(t,n,e)}),e.l&&P({},function(e,n){it(t,n,e)})}function Qt(e,t,n){n=Math.min(e.i.length,n);const r=e.l?c(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let u=0;u<n;u++){var s=i[u].g;const n=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),c=!1;else try{s="req"+s+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let r=n;o(n)&&(r=se(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(rc){throw e.push(s+"type="+encodeURIComponent("_badmap")),rc}}catch(rc){r&&r(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function Jt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;v||I(),w||(v(),w=!0),_.add(t,e),e.A=0}}function Yt(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=Ie(c(e.Da,e),tn(e,e.A)),e.A++,!0)}function Xt(e){null!=e.B&&(s.clearTimeout(e.B),e.B=null)}function $t(e){e.g=new Re(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=et(e.na);it(t,"RID","rpc"),it(t,"SID",e.M),it(t,"AID",e.K),it(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&it(t,"TO",e.ia),it(t,"TYPE","xmlhttp"),Wt(e,t),e.u&&e.o&&Rt(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=st(et(t)),n.u=null,n.R=!0,Le(n,e)}function Zt(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function en(e,t){var n=null;if(e.g==t){Zt(e),Xt(e),e.g=null;var r=2}else{if(!Qe(e.h,t))return;n=t.G,Ye(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;$(r=ge(),new _e(r,n)),Kt(e)}else Jt(e);else if(3==(i=t.m)||0==i&&t.X>0||!(1==r&&function(e,t){return!(We(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=Ie(c(e.Ea,e,t),tn(e,e.D)),e.D++,!0))}(e,t)||2==r&&Yt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),i){case 1:nn(e,5);break;case 4:nn(e,10);break;case 3:nn(e,6);break;default:nn(e,2)}}function tn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function nn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),r=e.Ua;const t=!r;r=new Ze(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||tt(r,"https"),st(r),t?function(e,t){const n=new be;if(s.Image){const r=new Image;r.onload=u(bt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(bt,n,"TestLoadImage: error",!1,t,r),r.onabort=u(bt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(bt,n,"TestLoadImage: timeout",!1,t,r),s.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new be;const n=new AbortController,r=setTimeout(()=>{n.abort(),bt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?bt(0,0,!0,t):bt(0,0,!1,t)}).catch(()=>{clearTimeout(r),bt(0,0,!1,t)})}(r.toString(),n)}else we(2);e.I=0,e.l&&e.l.pa(t),rn(e),Gt(e)}function rn(e){if(e.I=0,e.ja=[],e.l){const t=Xe(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function sn(e,t,n){var r=n instanceof Ze?et(n):new Ze(n);if(""!=r.g)t&&(r.g=t+"."+r.g),nt(r,r.u);else{var i=s.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;const e=new Ze(null);r&&tt(e,r),t&&(e.g=t),i&&nt(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&it(r,n,t),it(r,"VER",e.ka),Wt(e,r),r}function on(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Dt(new Et({ab:n})):new Dt(e.ma)).Fa(e.L),t}function an(){}function cn(){}function un(e,t){X.call(this),this.g=new qt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!C(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new dn(this)}function ln(e){he.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function hn(){de.call(this),this.status=1}function dn(e){this.g=e}(e=Dt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ee.g(),this.g.onreadystatechange=h(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ot(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=s.FormData&&e instanceof s.FormData,!(Array.prototype.indexOf.call(xt,t,void 0)>=0)||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of n)this.g.setRequestHeader(s,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){Ot(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,$(this,"complete"),$(this,"abort"),Ft(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ft(this,!0)),Dt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Mt(this):this.Xa())},e.Xa=function(){Mt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Vt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),oe(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=qt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,r){we(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=sn(this,null,this.W),Kt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Re(this,this.j,e);let s=this.o;if(this.U&&(s?(s=x(s),L(s,this.U)):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Qt(this,i,t),it(n=et(this.J),"RID",e),it(n,"CVER",22),this.G&&it(n,"X-HTTP-Session-Id",this.G),Wt(this,n),s&&(this.R?t="headers="+ke(Nt(s))+"&"+t:this.u&&Rt(n,this.u,s)),Je(this.h,i),this.Ra&&it(n,"TYPE","init"),this.S?(it(n,"$req",t),it(n,"SID","null"),i.U=!0,Oe(i,n,null)):Oe(i,n,t),this.I=2}}else 3==this.I&&(e?Ht(this,e):0==this.i.length||He(this.h)||Ht(this))},e.Da=function(){if(this.v=null,$t(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=Ie(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,we(10),zt(this),$t(this))},e.Va=function(){null!=this.C&&(this.C=null,zt(this),Yt(this),we(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=an.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},cn.prototype.g=function(e,t){return new un(e,t)},l(un,X),un.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},un.prototype.close=function(){Bt(this.g)},un.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=se(e),e=n);t.i.push(new Ge(t.Ya++,e)),3==t.I&&Kt(t)},un.prototype.N=function(){this.g.l=null,delete this.j,Bt(this.g),delete this.g,un.Z.N.call(this)},l(ln,he),l(hn,de),l(dn,an),dn.prototype.ra=function(){$(this.g,"a")},dn.prototype.qa=function(e){$(this.g,new ln(e))},dn.prototype.pa=function(e){$(this.g,new hn)},dn.prototype.oa=function(){$(this.g,"b")},cn.prototype.createWebChannel=cn.prototype.g,un.prototype.send=un.prototype.o,un.prototype.open=un.prototype.m,un.prototype.close=un.prototype.close,ba=Ea.createWebChannelTransport=function(){return new cn},Ia=Ea.getStatEventTarget=function(){return ge()},_a=Ea.Event=fe,wa=Ea.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Se.NO_ERROR=0,Se.TIMEOUT=8,Se.HTTP_ERROR=6,va=Ea.ErrorCode=Se,Ce.COMPLETE="complete",ya=Ea.EventType=Ce,ue.EventType=le,le.OPEN="a",le.CLOSE="b",le.ERROR="c",le.MESSAGE="d",X.prototype.listen=X.prototype.J,ma=Ea.WebChannel=ue,Ea.FetchXmlHttpFactory=Et,Dt.prototype.listenOnce=Dt.prototype.K,Dt.prototype.getLastError=Dt.prototype.Ha,Dt.prototype.getLastErrorCode=Dt.prototype.ya,Dt.prototype.getStatus=Dt.prototype.ca,Dt.prototype.getResponseJson=Dt.prototype.La,Dt.prototype.getResponseText=Dt.prototype.la,Dt.prototype.send=Dt.prototype.ea,Dt.prototype.setWithCredentials=Dt.prototype.Fa,ga=Ea.XhrIo=Dt}).apply("undefined"!==typeof Ta?Ta:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});class Sa{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Sa.UNAUTHENTICATED=new Sa(null),Sa.GOOGLE_CREDENTIALS=new Sa("google-credentials-uid"),Sa.FIRST_PARTY=new Sa("first-party-uid"),Sa.MOCK_USER=new Sa("mock-user");let Ca="12.9.0";const Aa=new se("@firebase/firestore");function ka(){return Aa.logLevel}function Na(e){if(Aa.logLevel<=ee.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Pa);Aa.debug("Firestore (".concat(Ca,"): ").concat(e),...i)}}function Ra(e){if(Aa.logLevel<=ee.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Pa);Aa.error("Firestore (".concat(Ca,"): ").concat(e),...i)}}function Da(e){if(Aa.logLevel<=ee.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Pa);Aa.warn("Firestore (".concat(Ca,"): ").concat(e),...i)}}function Pa(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function xa(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,Oa(e,r,n)}function Oa(e,t,n){let r="FIRESTORE (".concat(Ca,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw Ra(r),new Error(r)}function La(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||Oa(t,i,r)}function Ma(e,t){return e}const Fa={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Va extends M{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class Ua{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ja{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class qa{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Sa.UNAUTHENTICATED))}shutdown(){}}class Ba{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class za{constructor(e){this.t=e,this.currentUser=Sa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){La(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ua;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ua,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{Na("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Na("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ua)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Na("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(La("string"==typeof t.accessToken,31837,{l:t}),new ja(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return La(null===e||"string"==typeof e,2055,{h:e}),new Sa(e)}}class Ga{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Sa.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Ka{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Ga(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Sa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ha{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Wa{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,lt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){La(void 0===this.o,3512);const n=e=>{null!=e.error&&Na("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.m;return this.m=e.token,Na("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{Na("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):Na("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ha(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(La("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Ha(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Qa(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class Ja{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Qa(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Ya(e,t){return e<t?-1:e>t?1:0}function Xa(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),i=t.charAt(r);if(n!==i)return ec(n)===ec(i)?Ya(n,i):ec(n)?1:-1}return Ya(e.length,t.length)}const $a=55296,Za=57343;function ec(e){const t=e.charCodeAt(0);return t>=$a&&t<=Za}function tc(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function nc(e){return e+"\0"}const rc="__name__";class ic{constructor(e,t,n){void 0===t?t=0:t>e.length&&xa(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&xa(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ic.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ic?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=ic.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Ya(e.length,t.length)}static compareSegments(e,t){const n=ic.isNumericId(e),r=ic.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ic.extractNumericId(e).compare(ic.extractNumericId(t)):Xa(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ha.fromString(e.substring(4,e.length-2))}}class sc extends ic{construct(e,t,n){return new sc(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new Va(Fa.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new sc(e)}static emptyPath(){return new sc([])}}const oc=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ac extends ic{construct(e,t,n){return new ac(e,t,n)}static isValidIdentifier(e){return oc.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ac.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rc}static keyField(){return new ac([rc])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Va(Fa.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Va(Fa.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Va(Fa.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Va(Fa.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ac(t)}static emptyPath(){return new ac([])}}class cc{constructor(e){this.path=e}static fromPath(e){return new cc(sc.fromString(e))}static fromName(e){return new cc(sc.fromString(e).popFirst(5))}static empty(){return new cc(sc.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===sc.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return sc.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new cc(new sc(e.slice()))}}function uc(e,t,n){if(!n)throw new Va(Fa.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function lc(e,t,n,r){if(!0===t&&!0===r)throw new Va(Fa.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function hc(e){if(!cc.isDocumentKey(e))throw new Va(Fa.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function dc(e){if(cc.isDocumentKey(e))throw new Va(Fa.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function fc(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function pc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":xa(12329,{type:typeof e})}function gc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Va(Fa.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=pc(e);throw new Va(Fa.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function mc(e,t){if(t<=0)throw new Va(Fa.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}function yc(e,t){const n={typeString:e};return t&&(n.value=t),n}function vc(e,t){if(!fc(e))throw new Va(Fa.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n="JSON missing required field: '".concat(r,"'");break}const o=e[r];if(i&&typeof o!==i){n="JSON field '".concat(r,"' must be a ").concat(i,".");break}if(void 0!==s&&o!==s.value){n="Expected '".concat(r,"' field to equal '").concat(s.value,"'");break}}if(n)throw new Va(Fa.INVALID_ARGUMENT,n);return!0}const wc=-62135596800,_c=1e6;class Ic{static now(){return Ic.fromMillis(Date.now())}static fromDate(e){return Ic.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*_c);return new Ic(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Va(Fa.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Va(Fa.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<wc)throw new Va(Fa.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Va(Fa.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_c}_compareTo(e){return this.seconds===e.seconds?Ya(this.nanoseconds,e.nanoseconds):Ya(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ic._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(vc(e,Ic._jsonSchema))return new Ic(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-wc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ic._jsonSchemaVersion="firestore/timestamp/1.0",Ic._jsonSchema={type:yc("string",Ic._jsonSchemaVersion),seconds:yc("number"),nanoseconds:yc("number")};class bc{static fromTimestamp(e){return new bc(e)}static min(){return new bc(new Ic(0,0))}static max(){return new bc(new Ic(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Tc=-1;class Ec{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Sc(e){return e.fields.find(e=>2===e.kind)}function Cc(e){return e.fields.filter(e=>2!==e.kind)}Ec.UNKNOWN_ID=-1;class Ac{constructor(e,t){this.fieldPath=e,this.kind=t}}class kc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new kc(0,Dc.min())}}function Nc(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=bc.fromTimestamp(1e9===r?new Ic(n+1,0):new Ic(n,r));return new Dc(i,cc.empty(),t)}function Rc(e){return new Dc(e.readTime,e.key,Tc)}class Dc{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Dc(bc.min(),cc.empty(),Tc)}static max(){return new Dc(bc.max(),cc.empty(),Tc)}}function Pc(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=cc.comparator(e.documentKey,t.documentKey),0!==n?n:Ya(e.largestBatchId,t.largestBatchId))}const xc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Oc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Lc(e){if(e.code!==Fa.FAILED_PRECONDITION||e.message!==xc)throw e;Na("LocalStore","Unexpectedly lost primary lease")}class Mc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xa(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Mc((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Mc?t:Mc.resolve(t)}catch(e){return Mc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Mc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Mc.reject(t)}static resolve(e){return new Mc((t,n)=>{t(e)})}static reject(e){return new Mc((t,n)=>{n(e)})}static waitFor(e){return new Mc((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Mc.resolve(!1);for(const n of e)t=t.next(e=>e?Mc.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Mc((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next(e=>{s[c]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new Mc((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}const Fc="SimpleDb";class Vc{static open(e,t,n,r){try{return new Vc(t,e.transaction(r,n))}catch(e){throw new Bc(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Ua,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Bc(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const n=Wc(t.target.error);this.S.reject(new Bc(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Na(Fc,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Gc(t)}}class Uc{static delete(e){return Na(Fc,"Removing database:",e),Kc(v().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!L())return!1;if(Uc.F())return!0;const e=A(),t=Uc.M(e),n=0<t&&t<10,r=jc(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static F(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===Uc.M(A())&&Ra("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Na(Fc,"Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Bc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Va(Fa.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Va(Fa.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Bc(e,r))},r.onupgradeneeded=e=>{Na(Fc,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{Na(Fc,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.L(e);const t=Vc.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),Mc.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(Na(Fc,"Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function jc(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class qc{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return Kc(this.U.delete())}}class Bc extends Va{constructor(e,t){super(Fa.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(t)),this.name="IndexedDbTransactionError"}}function zc(e){return"IndexedDbTransactionError"===e.name}class Gc{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Na(Fc,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(Na(Fc,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Kc(n)}add(e){return Na(Fc,"ADD",this.store.name,e,e),Kc(this.store.add(e))}get(e){return Kc(this.store.get(e)).next(t=>(void 0===t&&(t=null),Na(Fc,"GET",this.store.name,e,t),t))}delete(e){return Na(Fc,"DELETE",this.store.name,e),Kc(this.store.delete(e))}count(){return Na(Fc,"COUNT",this.store.name),Kc(this.store.count())}H(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Mc((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{const e=this.cursor(n),t=[];return this.J(e,(e,n)=>{t.push(n)}).next(()=>t)}}Z(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Mc((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}X(e,t){Na(Fc,"DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.J(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.J(r,t)}te(e){const t=this.cursor({});return new Mc((n,r)=>{t.onerror=e=>{const t=Wc(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}J(e,t){const n=[];return new Mc((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new qc(i),o=t(i.primaryKey,i.value,s);if(o instanceof Mc){const e=o.catch(e=>(s.done(),Mc.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>Mc.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Kc(e){return new Mc((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Wc(e.target.error);n(t)}})}let Hc=!1;function Wc(e){const t=Uc.M(A());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Va("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(t,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Hc||(Hc=!0,setTimeout(()=>{throw e},0)),e}}return e}const Qc="IndexBackfiller";class Jc{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){Na(Qc,"Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const e=await this.ne.ie();Na(Qc,"Documents written: ".concat(e))}catch(e){zc(e)?Na(Qc,"Ignoring IndexedDB error during index backfill: ",e):await Lc(e)}await this.re(6e4)})}}class Yc{constructor(e,t){this.localStore=e,this.persistence=t}async ie(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const n=new Set;let r=t,i=!0;return Mc.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return Na(Qc,"Processing collection: ".concat(t)),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(r,n)).next(n=>(Na(Qc,"Updating offset: ".concat(n)),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{const r=Rc(t);Pc(r,n)>0&&(n=r)}),new Dc(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Xc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Xc.ce=-1;const $c=-1;function Zc(e){return null==e}function eu(e){return 0===e&&1/e==-1/0}function tu(e){return"number"==typeof e&&Number.isInteger(e)&&!eu(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const nu="\x01";function ru(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=su(t)),t=iu(e.get(n),t);return su(t)}function iu(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case nu:n+="\x01\x11";break;default:n+=t}}return n}function su(e){return e+nu+"\x01"}function ou(e){const t=e.length;if(La(t>=2,64408,{path:e}),2===t)return La(e.charAt(0)===nu&&"\x01"===e.charAt(1),56145,{path:e}),sc.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf(nu,s);switch((t<0||t>n)&&xa(50515,{path:e}),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:xa(61167,{path:e})}s=t+2}return new sc(r)}const au="remoteDocuments",cu="owner",uu="owner",lu="mutationQueues",hu="mutations",du="batchId",fu="userMutationsIndex",pu=["userId","batchId"];function gu(e,t){return[e,ru(t)]}function mu(e,t,n){return[e,ru(t),n]}const yu={},vu="documentMutations",wu="remoteDocumentsV14",_u=["prefixPath","collectionGroup","readTime","documentId"],Iu="documentKeyIndex",bu=["prefixPath","collectionGroup","documentId"],Tu="collectionGroupIndex",Eu=["collectionGroup","readTime","prefixPath","documentId"],Su="remoteDocumentGlobal",Cu="remoteDocumentGlobalKey",Au="targets",ku="queryTargetsIndex",Nu=["canonicalId","targetId"],Ru="targetDocuments",Du=["targetId","path"],Pu="documentTargetsIndex",xu=["path","targetId"],Ou="targetGlobalKey",Lu="targetGlobal",Mu="collectionParents",Fu=["collectionId","parent"],Vu="clientMetadata",Uu="bundles",ju="namedQueries",qu="indexConfiguration",Bu="collectionGroupIndex",zu="indexState",Gu=["indexId","uid"],Ku="sequenceNumberIndex",Hu=["uid","sequenceNumber"],Wu="indexEntries",Qu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ju="documentKeyIndex",Yu=["indexId","uid","orderedDocumentKey"],Xu="documentOverlays",$u=["userId","collectionPath","documentId"],Zu="collectionPathOverlayIndex",el=["userId","collectionPath","largestBatchId"],tl="collectionGroupOverlayIndex",nl=["userId","collectionGroup","largestBatchId"],rl="globals",il=[lu,hu,vu,au,Au,cu,Lu,Ru,Vu,Su,Mu,Uu,ju],sl=[...il,Xu],ol=[lu,hu,vu,wu,Au,cu,Lu,Ru,Vu,Su,Mu,Uu,ju,Xu],al=ol,cl=[...al,qu,zu,Wu],ul=cl,ll=[...cl,rl],hl=ll;class dl extends Oc{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function fl(e,t){const n=Ma(e);return Uc.O(n.le,t)}function pl(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function gl(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ml(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class yl{constructor(e,t){this.comparator=e,this.root=t||wl.EMPTY}insert(e,t){return new yl(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wl.BLACK,null,null))}remove(e){return new yl(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vl(this.root,e,this.comparator,!1)}getReverseIterator(){return new vl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vl(this.root,e,this.comparator,!0)}}class vl{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wl{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:wl.RED,this.left=null!=r?r:wl.EMPTY,this.right=null!=i?i:wl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new wl(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return wl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return wl.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw xa(43730,{key:this.key,value:this.value});if(this.right.isRed())throw xa(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw xa(27949);return e+(this.isRed()?0:1)}}wl.EMPTY=null,wl.RED=!0,wl.BLACK=!1,wl.EMPTY=new class{constructor(){this.size=0}get key(){throw xa(57766)}get value(){throw xa(16141)}get color(){throw xa(16727)}get left(){throw xa(29726)}get right(){throw xa(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new wl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class _l{constructor(e){this.comparator=e,this.data=new yl(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Il(this.data.getIterator())}getIteratorFrom(e){return new Il(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof _l))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new _l(this.comparator);return t.data=e,t}}class Il{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function bl(e){return e.hasNext()?e.getNext():void 0}class Tl{constructor(e){this.fields=e,e.sort(ac.comparator)}static empty(){return new Tl([])}unionWith(e){let t=new _l(ac.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Tl(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tc(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class El extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Sl{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new El("Invalid base64 string: "+e):e}}(e);return new Sl(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Sl(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ya(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Sl.EMPTY_BYTE_STRING=new Sl("");const Cl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Al(e){if(La(!!e,39018),"string"==typeof e){let t=0;const n=Cl.exec(e);if(La(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:kl(e.seconds),nanos:kl(e.nanos)}}function kl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Nl(e){return"string"==typeof e?Sl.fromBase64String(e):Sl.fromUint8Array(e)}const Rl="server_timestamp",Dl="__type__",Pl="__previous_value__",xl="__local_write_time__";function Ol(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Dl])||void 0===t?void 0:t.stringValue)===Rl}function Ll(e){const t=e.mapValue.fields[Pl];return Ol(t)?Ll(t):t}function Ml(e){const t=Al(e.mapValue.fields[xl].timestampValue);return new Ic(t.seconds,t.nanos)}class Fl{constructor(e,t,n,r,i,s,o,a,c,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u,this.apiKey=l}}const Vl="(default)";class Ul{constructor(e,t){this.projectId=e,this.database=t||Vl}static empty(){return new Ul("","")}get isDefaultDatabase(){return this.database===Vl}isEqual(e){return e instanceof Ul&&e.projectId===this.projectId&&e.database===this.database}}const jl="__type__",ql="__max__",Bl={mapValue:{fields:{__type__:{stringValue:ql}}}},zl="__vector__",Gl="value",Kl={nullValue:"NULL_VALUE"};function Hl(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ol(e)?4:uh(e)?9007199254740991:ah(e)?10:11:xa(28295,{value:e})}function Wl(e,t){if(e===t)return!0;const n=Hl(e);if(n!==Hl(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ml(e).isEqual(Ml(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Al(e.timestampValue),r=Al(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Nl(e.bytesValue).isEqual(Nl(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return kl(e.geoPointValue.latitude)===kl(t.geoPointValue.latitude)&&kl(e.geoPointValue.longitude)===kl(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return kl(e.integerValue)===kl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=kl(e.doubleValue),r=kl(t.doubleValue);return n===r?eu(n)===eu(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return tc(e.arrayValue.values||[],t.arrayValue.values||[],Wl);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(pl(n)!==pl(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Wl(n[i],r[i])))return!1;return!0}(e,t);default:return xa(52216,{left:e})}}function Ql(e,t){return void 0!==(e.values||[]).find(e=>Wl(e,t))}function Jl(e,t){if(e===t)return 0;const n=Hl(e),r=Hl(t);if(n!==r)return Ya(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ya(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=kl(e.integerValue||e.doubleValue),r=kl(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Yl(e.timestampValue,t.timestampValue);case 4:return Yl(Ml(e),Ml(t));case 5:return Xa(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Nl(e),r=Nl(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=Ya(n[i],r[i]);if(0!==e)return e}return Ya(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ya(kl(e.latitude),kl(t.latitude));return 0!==n?n:Ya(kl(e.longitude),kl(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Xl(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},c=null===(n=o[Gl])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Gl])||void 0===r?void 0:r.arrayValue,l=Ya((null===c||void 0===c||null===(i=c.values)||void 0===i?void 0:i.length)||0,(null===u||void 0===u||null===(s=u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:Xl(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Bl.mapValue&&t===Bl.mapValue)return 0;if(e===Bl.mapValue)return 1;if(t===Bl.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=Xa(r[o],s[o]);if(0!==e)return e;const t=Jl(n[r[o]],i[s[o]]);if(0!==t)return t}return Ya(r.length,s.length)}(e.mapValue,t.mapValue);default:throw xa(23264,{he:n})}}function Yl(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ya(e,t);const n=Al(e),r=Al(t),i=Ya(n.seconds,r.seconds);return 0!==i?i:Ya(n.nanos,r.nanos)}function Xl(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Jl(n[i],r[i]);if(e)return e}return Ya(n.length,r.length)}function $l(e){return Zl(e)}function Zl(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Al(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Nl(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return cc.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Zl(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(Zl(e.fields[i]));return n+"}"}(e.mapValue):xa(61005,{value:e})}function eh(e){switch(Hl(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Ll(e);return t?16+eh(t):16;case 5:return 2*e.stringValue.length;case 6:return Nl(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+eh(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return gl(e.fields,(e,n)=>{t+=e.length+eh(n)}),t}(e.mapValue);default:throw xa(13486,{value:e})}}function th(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function nh(e){return!!e&&"integerValue"in e}function rh(e){return!!e&&"arrayValue"in e}function ih(e){return!!e&&"nullValue"in e}function sh(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function oh(e){return!!e&&"mapValue"in e}function ah(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[jl])||void 0===t?void 0:t.stringValue)===zl}function ch(e){if(e.geoPointValue)return{geoPointValue:l({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:l({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return gl(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ch(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ch(e.arrayValue.values[n]);return t}return l({},e)}function uh(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ql}const lh={mapValue:{fields:{[jl]:{stringValue:zl},[Gl]:{arrayValue:{}}}}};function hh(e){return"nullValue"in e?Kl:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?th(Ul.empty(),cc.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?ah(e)?lh:{mapValue:{}}:xa(35942,{value:e})}function dh(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?th(Ul.empty(),cc.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?lh:"mapValue"in e?ah(e)?{mapValue:{}}:Bl:xa(61959,{value:e})}function fh(e,t){const n=Jl(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function ph(e,t){const n=Jl(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class gh{constructor(e){this.value=e}static empty(){return new gh({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!oh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ch(t)}setAll(e){let t=ac.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ch(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());oh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];oh(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){gl(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new gh(ch(this.value))}}function mh(e){const t=[];return gl(e.fields,(e,n)=>{const r=new ac([e]);if(oh(n)){const e=mh(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new Tl(t)}class yh{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new yh(e,0,bc.min(),bc.min(),bc.min(),gh.empty(),0)}static newFoundDocument(e,t,n,r){return new yh(e,1,t,bc.min(),n,r,0)}static newNoDocument(e,t){return new yh(e,2,t,bc.min(),bc.min(),gh.empty(),0)}static newUnknownDocument(e,t){return new yh(e,3,t,bc.min(),bc.min(),gh.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(bc.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gh.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gh.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=bc.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof yh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class vh{constructor(e,t){this.position=e,this.inclusive=t}}function wh(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?cc.comparator(cc.fromName(o.referenceValue),n.key):Jl(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function _h(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Wl(e.position[n],t.position[n]))return!1;return!0}class Ih{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function bh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Th{}class Eh extends Th{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Oh(e,t,n):"array-contains"===t?new Vh(e,n):"in"===t?new Uh(e,n):"not-in"===t?new jh(e,n):"array-contains-any"===t?new qh(e,n):new Eh(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Lh(e,n):new Mh(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Jl(t,this.value)):null!==t&&Hl(this.value)===Hl(t)&&this.matchesComparison(Jl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return xa(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Sh extends Th{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Sh(e,t)}matches(e){return Ch(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ch(e){return"and"===e.op}function Ah(e){return"or"===e.op}function kh(e){return Nh(e)&&Ch(e)}function Nh(e){for(const t of e.filters)if(t instanceof Sh)return!1;return!0}function Rh(e){if(e instanceof Eh)return e.field.canonicalString()+e.op.toString()+$l(e.value);if(kh(e))return e.filters.map(e=>Rh(e)).join(",");{const t=e.filters.map(e=>Rh(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Dh(e,t){return e instanceof Eh?function(e,t){return t instanceof Eh&&e.op===t.op&&e.field.isEqual(t.field)&&Wl(e.value,t.value)}(e,t):e instanceof Sh?function(e,t){return t instanceof Sh&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Dh(n,t.filters[r]),!0)}(e,t):void xa(19439)}function Ph(e,t){const n=e.filters.concat(t);return Sh.create(n,e.op)}function xh(e){return e instanceof Eh?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat($l(e.value))}(e):e instanceof Sh?function(e){return e.op.toString()+" {"+e.getFilters().map(xh).join(" ,")+"}"}(e):"Filter"}class Oh extends Eh{constructor(e,t,n){super(e,t,n),this.key=cc.fromName(n.referenceValue)}matches(e){const t=cc.comparator(e.key,this.key);return this.matchesComparison(t)}}class Lh extends Eh{constructor(e,t){super(e,"in",t),this.keys=Fh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Mh extends Eh{constructor(e,t){super(e,"not-in",t),this.keys=Fh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Fh(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>cc.fromName(e.referenceValue))}class Vh extends Eh{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return rh(t)&&Ql(t.arrayValue,this.value)}}class Uh extends Eh{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ql(this.value.arrayValue,t)}}class jh extends Eh{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ql(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Ql(this.value.arrayValue,t)}}class qh extends Eh{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!rh(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Ql(this.value.arrayValue,e))}}class Bh{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function zh(e){return new Bh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Gh(e){const t=Ma(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Rh(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Zc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>$l(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>$l(e)).join(",")),t.Te=e}return t.Te}function Kh(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!bh(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Dh(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!_h(e.startAt,t.startAt)&&_h(e.endAt,t.endAt)}function Hh(e){return cc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Wh(e,t){return e.filters.filter(e=>e instanceof Eh&&e.field.isEqual(t))}function Qh(e,t,n){let r=Kl,i=!0;for(const s of Wh(e,t)){let e=Kl,t=!0;switch(s.op){case"<":case"<=":e=hh(s.value);break;case"==":case"in":case">=":e=s.value;break;case">":e=s.value,t=!1;break;case"!=":case"not-in":e=Kl}fh({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];fh({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Jh(e,t,n){let r=Bl,i=!0;for(const s of Wh(e,t)){let e=Bl,t=!0;switch(s.op){case">=":case">":e=dh(s.value),t=!1;break;case"==":case"in":case"<=":e=s.value;break;case"<":e=s.value,t=!1;break;case"!=":case"not-in":e=Bl}ph({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];ph({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Yh{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Xh(e,t,n,r,i,s,o,a){return new Yh(e,t,n,r,i,s,o,a)}function $h(e){return new Yh(e)}function Zh(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ed(e){return null!==e.collectionGroup}function td(e){const t=Ma(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new _l(ac.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Ih(r,n))}),e.has(ac.keyField().canonicalString())||t.Ie.push(new Ih(ac.keyField(),n))}return t.Ie}function nd(e){const t=Ma(e);return t.Ee||(t.Ee=rd(t,td(e))),t.Ee}function rd(e,t){if("F"===e.limitType)return zh(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Ih(e.field,t)});const n=e.endAt?new vh(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new vh(e.startAt.position,e.startAt.inclusive):null;return zh(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function id(e,t){const n=e.filters.concat([t]);return new Yh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function sd(e,t,n){return new Yh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function od(e,t){return Kh(nd(e),nd(t))&&e.limitType===t.limitType}function ad(e){return"".concat(Gh(nd(e)),"|lt:").concat(e.limitType)}function cd(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>xh(e)).join(", "),"]")),Zc(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>$l(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>$l(e)).join(",")),"Target(".concat(t,")")}(nd(e)),"; limitType=").concat(e.limitType,")")}function ud(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):cc.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of td(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=wh(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,td(e),t))&&!(e.endAt&&!function(e,t,n){const r=wh(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,td(e),t))}(e,t)}function ld(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function hd(e){return(t,n)=>{let r=!1;for(const i of td(e)){const e=dd(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function dd(e,t,n){const r=e.field.isKeyField()?cc.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Jl(r,i):xa(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return xa(19790,{direction:e.dir})}}class fd{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){gl(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return ml(this.inner)}size(){return this.innerSize}}const pd=new yl(cc.comparator);function gd(){return pd}const md=new yl(cc.comparator);function yd(){let e=md;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function vd(e){let t=md;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function wd(){return Id()}function _d(){return Id()}function Id(){return new fd(e=>e.toString(),(e,t)=>e.isEqual(t))}const bd=new yl(cc.comparator),Td=new _l(cc.comparator);function Ed(){let e=Td;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const Sd=new _l(Ya);function Cd(){return Sd}function Ad(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eu(t)?"-0":t}}function kd(e){return{integerValue:""+e}}function Nd(e,t){return tu(t)?kd(t):Ad(e,t)}class Rd{constructor(){this._=void 0}}function Dd(e,t,n){return e instanceof Od?function(e,t){const n={fields:{[Dl]:{stringValue:Rl},[xl]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ol(t)&&(t=Ll(t)),t&&(n.fields[Pl]=t),{mapValue:n}}(n,t):e instanceof Ld?Md(e,t):e instanceof Fd?Vd(e,t):function(e,t){const n=xd(e,t),r=jd(n)+jd(e.Ae);return nh(n)&&nh(e.Ae)?kd(r):Ad(e.serializer,r)}(e,t)}function Pd(e,t,n){return e instanceof Ld?Md(e,t):e instanceof Fd?Vd(e,t):n}function xd(e,t){return e instanceof Ud?function(e){return nh(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Od extends Rd{}class Ld extends Rd{constructor(e){super(),this.elements=e}}function Md(e,t){const n=qd(t);for(const r of e.elements)n.some(e=>Wl(e,r))||n.push(r);return{arrayValue:{values:n}}}class Fd extends Rd{constructor(e){super(),this.elements=e}}function Vd(e,t){let n=qd(t);for(const r of e.elements)n=n.filter(e=>!Wl(e,r));return{arrayValue:{values:n}}}class Ud extends Rd{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function jd(e){return kl(e.integerValue||e.doubleValue)}function qd(e){return rh(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Bd{constructor(e,t){this.field=e,this.transform=t}}class zd{constructor(e,t){this.version=e,this.transformResults=t}}class Gd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gd}static exists(e){return new Gd(void 0,e)}static updateTime(e){return new Gd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Kd(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Hd{}function Wd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new rf(e.key,Gd.none()):new $d(e.key,e.data,Gd.none());{const n=e.data,r=gh.empty();let i=new _l(ac.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Zd(e.key,r,new Tl(i.toArray()),Gd.none())}}function Qd(e,t,n){e instanceof $d?function(e,t,n){const r=e.value.clone(),i=tf(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Zd?function(e,t,n){if(!Kd(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=tf(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ef(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Jd(e,t,n,r){return e instanceof $d?function(e,t,n,r){if(!Kd(e.precondition,t))return n;const i=e.value.clone(),s=nf(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Zd?function(e,t,n,r){if(!Kd(e.precondition,t))return n;const i=nf(e.fieldTransforms,r,t),s=t.data;return s.setAll(ef(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return Kd(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Yd(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=xd(r.transform,e||null);null!=i&&(null===n&&(n=gh.empty()),n.set(r.field,i))}return n||null}function Xd(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&tc(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ld&&t instanceof Ld||e instanceof Fd&&t instanceof Fd?tc(e.elements,t.elements,Wl):e instanceof Ud&&t instanceof Ud?Wl(e.Ae,t.Ae):e instanceof Od&&t instanceof Od}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class $d extends Hd{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Zd extends Hd{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ef(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function tf(e,t,n){const r=new Map;La(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Pd(o,a,n[i]))}return r}function nf(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Dd(e,s,t))}return r}class rf extends Hd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sf extends Hd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class of{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Qd(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Jd(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Jd(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=_d();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Wd(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(bc.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ed())}isEqual(e){return this.batchId===e.batchId&&tc(this.mutations,e.mutations,(e,t)=>Xd(e,t))&&tc(this.baseMutations,e.baseMutations,(e,t)=>Xd(e,t))}}class af{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){La(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=bd;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new af(e,t,n,r)}}class cf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class uf{constructor(e,t){this.count=e,this.unchangedNames=t}}var lf,hf;function df(e){switch(e){case Fa.OK:return xa(64938);case Fa.CANCELLED:case Fa.UNKNOWN:case Fa.DEADLINE_EXCEEDED:case Fa.RESOURCE_EXHAUSTED:case Fa.INTERNAL:case Fa.UNAVAILABLE:case Fa.UNAUTHENTICATED:return!1;case Fa.INVALID_ARGUMENT:case Fa.NOT_FOUND:case Fa.ALREADY_EXISTS:case Fa.PERMISSION_DENIED:case Fa.FAILED_PRECONDITION:case Fa.ABORTED:case Fa.OUT_OF_RANGE:case Fa.UNIMPLEMENTED:case Fa.DATA_LOSS:return!0;default:return xa(15467,{code:e})}}function ff(e){if(void 0===e)return Ra("GRPC error has no .code"),Fa.UNKNOWN;switch(e){case lf.OK:return Fa.OK;case lf.CANCELLED:return Fa.CANCELLED;case lf.UNKNOWN:return Fa.UNKNOWN;case lf.DEADLINE_EXCEEDED:return Fa.DEADLINE_EXCEEDED;case lf.RESOURCE_EXHAUSTED:return Fa.RESOURCE_EXHAUSTED;case lf.INTERNAL:return Fa.INTERNAL;case lf.UNAVAILABLE:return Fa.UNAVAILABLE;case lf.UNAUTHENTICATED:return Fa.UNAUTHENTICATED;case lf.INVALID_ARGUMENT:return Fa.INVALID_ARGUMENT;case lf.NOT_FOUND:return Fa.NOT_FOUND;case lf.ALREADY_EXISTS:return Fa.ALREADY_EXISTS;case lf.PERMISSION_DENIED:return Fa.PERMISSION_DENIED;case lf.FAILED_PRECONDITION:return Fa.FAILED_PRECONDITION;case lf.ABORTED:return Fa.ABORTED;case lf.OUT_OF_RANGE:return Fa.OUT_OF_RANGE;case lf.UNIMPLEMENTED:return Fa.UNIMPLEMENTED;case lf.DATA_LOSS:return Fa.DATA_LOSS;default:return xa(39323,{code:e})}}(hf=lf||(lf={}))[hf.OK=0]="OK",hf[hf.CANCELLED=1]="CANCELLED",hf[hf.UNKNOWN=2]="UNKNOWN",hf[hf.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",hf[hf.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",hf[hf.NOT_FOUND=5]="NOT_FOUND",hf[hf.ALREADY_EXISTS=6]="ALREADY_EXISTS",hf[hf.PERMISSION_DENIED=7]="PERMISSION_DENIED",hf[hf.UNAUTHENTICATED=16]="UNAUTHENTICATED",hf[hf.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",hf[hf.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",hf[hf.ABORTED=10]="ABORTED",hf[hf.OUT_OF_RANGE=11]="OUT_OF_RANGE",hf[hf.UNIMPLEMENTED=12]="UNIMPLEMENTED",hf[hf.INTERNAL=13]="INTERNAL",hf[hf.UNAVAILABLE=14]="UNAVAILABLE",hf[hf.DATA_LOSS=15]="DATA_LOSS";let pf=null;function gf(){return new TextEncoder}const mf=new ha([4294967295,4294967295],0);function yf(e){const t=gf().encode(e),n=new da;return n.update(t),new Uint8Array(n.digest())}function vf(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new ha([n,r],0),new ha([i,s],0)]}class wf{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new _f("Invalid padding: ".concat(t));if(n<0)throw new _f("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new _f("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new _f("Invalid padding when bitmap length is 0: ".concat(t));this.ge=8*e.length-t,this.pe=ha.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(ha.fromNumber(n)));return 1===r.compare(mf)&&(r=new ha([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=yf(e),[n,r]=vf(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);if(!this.we(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new wf(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.ge)return;const t=yf(e),[n,r]=vf(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);this.be(e)}}be(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class _f extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class If{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,bf.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new If(bc.min(),r,new yl(Ya),gd(),Ed())}}class bf{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new bf(n,t,Ed(),Ed(),Ed())}}class Tf{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}}class Ef{constructor(e,t){this.targetId=e,this.Ce=t}}class Sf{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sl.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Cf{constructor(){this.ve=0,this.Fe=Nf(),this.Me=Sl.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ed(),t=Ed(),n=Ed();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:xa(38017,{changeType:i})}}),new bf(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=Nf()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,La(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Af{constructor(e){this.Ge=e,this.ze=new Map,this.je=gd(),this.He=kf(),this.Je=kf(),this.Ze=new yl(Ya)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:xa(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(Hh(s))if(0===n){const e=new cc(s.path);this.et(t,e,yh.newNoDocument(e,bc.min()))}else La(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){var i;const n=this.ut(e),s=n?this.ct(n,e,r):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}null===(i=pf)||void 0===i||i.lt(function(e,t,n,r,i){var s,o,a,c,u;const l={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(l.bloomFilter={applied:0===i,hashCount:null!==(s=null===h||void 0===h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===h||void 0===h||null===(a=h.bits)||void 0===a||null===(a=a.bitmap)||void 0===a?void 0:a.length)&&void 0!==o?o:0,padding:null!==(c=null===h||void 0===h||null===(u=h.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:e=>{var t;return null!==(t=null===r||void 0===r?void 0:r.mightContain(e))&&void 0!==t&&t}}),l}(r,e.Ce,this.Ge.ht(),n,s))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Nl(n).toUint8Array()}catch(e){if(e instanceof El)return Da("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new wf(s,r,i)}catch(e){return Da(e instanceof _f?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.Ge.ht(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const i=this.ot(r);if(i){if(n.current&&Hh(i.target)){const t=new cc(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,yh.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.Ke())}});let n=Ed();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new If(e,t,this.Ze,this.je,n);return this.je=gd(),this.He=kf(),this.Je=kf(),this.Ze=new yl(Ya),r}Ye(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Cf,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new _l(Ya),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new _l(Ya),this.He=this.He.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||Na("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Cf),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function kf(){return new yl(cc.comparator)}function Nf(){return new yl(cc.comparator)}const Rf={asc:"ASCENDING",desc:"DESCENDING"},Df={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Pf={and:"AND",or:"OR"};class xf{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Of(e,t){return e.useProto3Json||Zc(t)?t:{value:t}}function Lf(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Mf(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Ff(e,t){return Lf(e,t.toTimestamp())}function Vf(e){return La(!!e,49232),bc.fromTimestamp(function(e){const t=Al(e);return new Ic(t.seconds,t.nanos)}(e))}function Uf(e,t){return jf(e,t).canonicalString()}function jf(e,t){const n=function(e){return new sc(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function qf(e){const t=sc.fromString(e);return La(up(t),10190,{key:t.toString()}),t}function Bf(e,t){return Uf(e.databaseId,t.path)}function zf(e,t){const n=qf(t);if(n.get(1)!==e.databaseId.projectId)throw new Va(Fa.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Va(Fa.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new cc(Wf(n))}function Gf(e,t){return Uf(e.databaseId,t)}function Kf(e){const t=qf(e);return 4===t.length?sc.emptyPath():Wf(t)}function Hf(e){return new sc(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Wf(e){return La(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Qf(e,t,n){return{name:Bf(e,t),fields:n.value.mapValue.fields}}function Jf(e,t,n){const r=zf(e,t.name),i=Vf(t.updateTime),s=t.createTime?Vf(t.createTime):bc.min(),o=new gh({mapValue:{fields:t.fields}}),a=yh.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Yf(e,t){let n;if(t instanceof $d)n={update:Qf(e,t.key,t.value)};else if(t instanceof rf)n={delete:Bf(e,t.key)};else if(t instanceof Zd)n={update:Qf(e,t.key,t.data),updateMask:cp(t.fieldMask)};else{if(!(t instanceof sf))return xa(16599,{dt:t.type});n={verify:Bf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Od)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ld)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Fd)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ud)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw xa(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ff(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:xa(27497)}(e,t.precondition)),n}function Xf(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Gd.updateTime(Vf(e.updateTime)):void 0!==e.exists?Gd.exists(e.exists):Gd.none()}(t.currentDocument):Gd.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;if("setToServerValue"in t)La("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new Od;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Ld(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Fd(e)}else"increment"in t?n=new Ud(e,t.increment):xa(16584,{proto:t});const r=ac.fromServerFormat(t.fieldPath);return new Bd(r,n)}(e,t)):[];if(t.update){t.update.name;const i=zf(e,t.update.name),s=new gh({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Tl(t.map(e=>ac.fromServerFormat(e)))}(t.updateMask);return new Zd(i,s,e,n,r)}return new $d(i,s,n,r)}if(t.delete){const r=zf(e,t.delete);return new rf(r,n)}if(t.verify){const r=zf(e,t.verify);return new sf(r,n)}return xa(1463,{proto:t})}function $f(e,t){return{documents:[Gf(e,t.path)]}}function Zf(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Gf(e,i);const s=function(e){if(0!==e.length)return ap(Sh.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:sp(e.field),direction:np(e.dir)}}(e))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Of(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i}}function ep(e){let t=Kf(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){La(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=tp(e);return t instanceof Sh&&kh(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new Ih(op(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Zc(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new vh(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new vh(n,t)}(n.endAt)),Xh(t,i,o,s,a,"F",c,u)}function tp(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=op(e.unaryFilter.field);return Eh.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=op(e.unaryFilter.field);return Eh.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=op(e.unaryFilter.field);return Eh.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=op(e.unaryFilter.field);return Eh.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return xa(61313);default:return xa(60726)}}(e):void 0!==e.fieldFilter?function(e){return Eh.create(op(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return xa(58110);default:return xa(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Sh.create(e.compositeFilter.filters.map(e=>tp(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return xa(1026)}}(e.compositeFilter.op))}(e):xa(30097,{filter:e})}function np(e){return Rf[e]}function rp(e){return Df[e]}function ip(e){return Pf[e]}function sp(e){return{fieldPath:e.canonicalString()}}function op(e){return ac.fromServerFormat(e.fieldPath)}function ap(e){return e instanceof Eh?function(e){if("=="===e.op){if(sh(e.value))return{unaryFilter:{field:sp(e.field),op:"IS_NAN"}};if(ih(e.value))return{unaryFilter:{field:sp(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(sh(e.value))return{unaryFilter:{field:sp(e.field),op:"IS_NOT_NAN"}};if(ih(e.value))return{unaryFilter:{field:sp(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sp(e.field),op:rp(e.op),value:e.value}}}(e):e instanceof Sh?function(e){const t=e.getFilters().map(e=>ap(e));return 1===t.length?t[0]:{compositeFilter:{op:ip(e.op),filters:t}}}(e):xa(54877,{filter:e})}function cp(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function up(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function lp(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class hp{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bc.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:bc.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Sl.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new hp(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new hp(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new hp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new hp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dp{constructor(e){this.yt=e}}function fp(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:pp(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Bf(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Lf(e,t.version.toTimestamp()),createTime:Lf(e,t.createTime.toTimestamp())}}(e.yt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:gp(t.version)};else{if(!t.isUnknownDocument())return xa(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:gp(t.version)}}return r}function pp(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function gp(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function mp(e){const t=new Ic(e.seconds,e.nanoseconds);return bc.fromTimestamp(t)}function yp(e,t){const n=(t.baseMutations||[]).map(t=>Xf(e.yt,t));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];if(s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform){const n=t.mutations[s+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}const r=t.mutations.map(t=>Xf(e.yt,t)),i=Ic.fromMillis(t.localWriteTimeMs);return new of(t.batchId,i,n,r)}function vp(e){const t=mp(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?mp(e.lastLimboFreeSnapshotVersion):bc.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){const t=e.documents.length;return La(1===t,1966,{count:t}),nd($h(Kf(e.documents[0])))}(e.query):function(e){return nd(ep(e))}(e.query),new hp(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Sl.fromBase64String(e.resumeToken))}function wp(e,t){const n=gp(t.snapshotVersion),r=gp(t.lastLimboFreeSnapshotVersion);let i;i=Hh(t.target)?$f(e.yt,t.target):Zf(e.yt,t.target).ft;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Gh(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function _p(e){const t=ep({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sd(t,t.limit,"L"):t}function Ip(e,t){return new cf(t.largestBatchId,Xf(e.yt,t.overlayMutation))}function bp(e,t){const n=t.path.lastSegment();return[e,ru(t.path.popLast()),n]}function Tp(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:gp(r.readTime),documentKey:ru(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ep{getBundleMetadata(e,t){return Sp(e).get(t).next(e=>{if(e)return function(e){return{id:e.bundleId,createTime:mp(e.createTime),version:e.version}}(e)})}saveBundleMetadata(e,t){return Sp(e).put(function(e){return{bundleId:e.id,createTime:gp(Vf(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return Cp(e).get(t).next(e=>{if(e)return function(e){return{name:e.name,query:_p(e.bundledQuery),readTime:mp(e.readTime)}}(e)})}saveNamedQuery(e,t){return Cp(e).put(function(e){return{name:e.name,readTime:gp(Vf(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Sp(e){return fl(e,Uu)}function Cp(e){return fl(e,ju)}class Ap{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new Ap(e,n)}getOverlay(e,t){return kp(e).get(bp(this.userId,t)).next(e=>e?Ip(this.serializer,e):null)}getOverlays(e,t){const n=wd();return Mc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){const r=[];return n.forEach((n,i)=>{const s=new cf(t,i);r.push(this.bt(e,s))}),Mc.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(e=>r.add(ru(e.getCollectionPath())));const i=[];return r.forEach(t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(kp(e).X(Zu,r))}),Mc.waitFor(i)}getOverlaysForCollection(e,t,n){const r=wd(),i=ru(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return kp(e).H(Zu,s).next(e=>{for(const t of e){const e=Ip(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const i=wd();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return kp(e).ee({index:tl,range:o},(e,t,n)=>{const o=Ip(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()}).next(()=>i)}bt(e,t){return kp(e).put(function(e,t,n){const[r,i,s]=bp(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Yf(e.yt,n.mutation)}}(this.serializer,this.userId,t))}}function kp(e){return fl(e,Xu)}class Np{St(e){return fl(e,rl)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{const t=null===e||void 0===e?void 0:e.value;return t?Sl.fromUint8Array(t):Sl.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Rp{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(kl(e.integerValue));else if("doubleValue"in e){const n=kl(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),eu(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=Al(n)),t.xt("".concat(n.seconds||"")),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Nl(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?uh(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ah(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):xa(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){var n;const r=e.fields||{};this.Ft(t,53);const i=Gl,s=(null===(n=r[i].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(t,15),t.Mt(kl(s)),this.Ot(i,t),this.Ct(r[i],t)}qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),cc.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Rp.Wt=new Rp;const Dp=255;function Pp(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function xp(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Pp(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class Op{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ht(n.value),n=t.next();this.Jt()}Zt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{const e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{const e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){const t=this.en(e),n=xp(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),n=xp(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(Dp),this.sn(255)}_n(){this.an(Dp),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Gt(e){const t=255&e;0===t?(this.sn(0),this.sn(255)):t===Dp?(this.sn(Dp),this.sn(0)):this.sn(t)}Ht(e){const t=255&e;0===t?(this.an(0),this.an(255)):t===Dp?(this.an(Dp),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Lp{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class Mp{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Fp{constructor(){this.cn=new Op,this.ascending=new Lp(this.cn),this.descending=new Mp(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class Vp{constructor(e,t,n,r){this.hn=e,this.Pn=t,this.Tn=n,this.In=r}En(){const e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.In,0),t!==e?n.set([0],this.In.length):++n[n.length-1],new Vp(this.hn,this.Pn,this.Tn,n)}Rn(e,t,n){return{indexId:this.hn,uid:e,arrayValue:qp(this.Tn),directionalValue:qp(this.In),orderedDocumentKey:qp(t),documentKey:n.path.toArray()}}An(e,t,n){const r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function Up(e,t){let n=e.hn-t.hn;return 0!==n?n:(n=jp(e.Tn,t.Tn),0!==n?n:(n=jp(e.In,t.In),0!==n?n:cc.comparator(e.Pn,t.Pn)))}function jp(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function qp(e){return O()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function Bp(e){return"string"!=typeof e?e:function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class zp{constructor(e){this.Vn=new _l((e,t)=>ac.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[];for(const t of e.filters){const e=t;e.isInequality()?this.Vn=this.Vn.add(e):this.mn.push(e)}}get fn(){return this.Vn.size>1}gn(e){if(La(e.collectionGroup===this.collectionId,49279),this.fn)return!1;const t=Sc(e);if(void 0!==t&&!this.pn(t))return!1;const n=Cc(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.pn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){const e=this.Vn.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new _l(ac.comparator);const t=[];for(const n of this.mn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Ac(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Ac(n.field,0))}for(const n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Ac(n.field,"asc"===n.dir?0:1)));return new Ec(Ec.UNKNOWN_ID,this.collectionId,t,kc.empty())}pn(e){for(const t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Gp(e){if(La(e instanceof Eh||e instanceof Sh,20012),e instanceof Eh){if(e instanceof Uh){var t;const n=(null===(t=e.value.arrayValue)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.map(t=>Eh.create(e.field,"==",t)))||[];return Sh.create(n,"or")}return e}const n=e.filters.map(e=>Gp(e));return Sh.create(n,e.op)}function Kp(e){if(0===e.getFilters().length)return[];const t=Jp(Gp(e));return La(Qp(t),7391),Hp(t)||Wp(t)?[t]:t.getFilters()}function Hp(e){return e instanceof Eh}function Wp(e){return e instanceof Sh&&kh(e)}function Qp(e){return Hp(e)||Wp(e)||function(e){if(e instanceof Sh&&Ah(e)){for(const t of e.getFilters())if(!Hp(t)&&!Wp(t))return!1;return!0}return!1}(e)}function Jp(e){if(La(e instanceof Eh||e instanceof Sh,34018),e instanceof Eh)return e;if(1===e.filters.length)return Jp(e.filters[0]);const t=e.filters.map(e=>Jp(e));let n=Sh.create(t,e.op);return n=$p(n),Qp(n)?n:(La(n instanceof Sh,64498),La(Ch(n),40251),La(n.filters.length>1,57927),n.filters.reduce((e,t)=>Yp(e,t)))}function Yp(e,t){let n;return La(e instanceof Eh||e instanceof Sh,38388),La(t instanceof Eh||t instanceof Sh,25473),n=e instanceof Eh?t instanceof Eh?function(e,t){return Sh.create([e,t],"and")}(e,t):Xp(e,t):t instanceof Eh?Xp(t,e):function(e,t){if(La(e.filters.length>0&&t.filters.length>0,48005),Ch(e)&&Ch(t))return Ph(e,t.getFilters());const n=Ah(e)?e:t,r=Ah(e)?t:e,i=n.filters.map(e=>Yp(e,r));return Sh.create(i,"or")}(e,t),$p(n)}function Xp(e,t){if(Ch(t))return Ph(t,e.getFilters());{const n=t.filters.map(t=>Yp(e,t));return Sh.create(n,"or")}}function $p(e){if(La(e instanceof Eh||e instanceof Sh,11850),e instanceof Eh)return e;const t=e.getFilters();if(1===t.length)return $p(t[0]);if(Nh(e))return e;const n=t.map(e=>$p(e)),r=[];return n.forEach(t=>{t instanceof Eh?r.push(t):t instanceof Sh&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:Sh.create(r,e.op)}class Zp{constructor(){this.Sn=new eg}addToCollectionParentIndex(e,t){return this.Sn.add(t),Mc.resolve()}getCollectionParents(e,t){return Mc.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return Mc.resolve()}deleteFieldIndex(e,t){return Mc.resolve()}deleteAllFieldIndexes(e){return Mc.resolve()}createTargetIndexes(e,t){return Mc.resolve()}getDocumentsMatchingTarget(e,t){return Mc.resolve(null)}getIndexType(e,t){return Mc.resolve(0)}getFieldIndexes(e,t){return Mc.resolve([])}getNextCollectionGroupToUpdate(e){return Mc.resolve(null)}getMinOffset(e,t){return Mc.resolve(Dc.min())}getMinOffsetFromCollectionGroup(e,t){return Mc.resolve(Dc.min())}updateCollectionGroup(e,t,n){return Mc.resolve()}updateIndexEntries(e,t){return Mc.resolve()}}class eg{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new _l(sc.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new _l(sc.comparator)).toArray()}}const tg="IndexedDbIndexManager",ng=new Uint8Array(0);class rg{constructor(e,t){this.databaseId=t,this.Dn=new eg,this.Cn=new fd(e=>Gh(e),(e,t)=>Kh(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});const i={collectionId:n,parent:ru(r)};return ig(e).put(i)}return Mc.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[nc(t),""],!1,!0);return ig(e).H(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(ou(r.parent))}return n})}addFieldIndex(e,t){const n=og(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=ag(e);return i.next(e=>{n.put(Tp(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=og(e),r=ag(e),i=sg(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=og(e),n=sg(e),r=ag(e);return t.X().next(()=>n.X()).next(()=>r.X())}createTargetIndexes(e,t){return Mc.forEach(this.vn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){const n=new zp(t).bn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){const n=sg(e);let r=!0;const i=new Map;return Mc.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=Ed();const r=[];return Mc.forEach(i,(i,s)=>{Na(tg,"Using index ".concat(function(e){return"id=".concat(e.indexId,"|cg=").concat(e.collectionGroup,"|f=").concat(e.fields.map(e=>"".concat(e.fieldPath,":").concat(e.kind)).join(","))}(i)," to execute ").concat(Gh(t)));const o=function(e,t){const n=Sc(t);if(void 0===n)return null;for(const r of Wh(e,n.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(s,i),a=function(e,t){const n=new Map;for(const r of Cc(t))for(const t of Wh(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of Cc(t)){const t=0===i.kind?Qh(e,i.fieldPath,e.startAt):Jh(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new vh(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of Cc(t)){const t=0===i.kind?Jh(e,i.fieldPath,e.endAt):Qh(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new vh(n,r)}(s,i),l=this.Mn(i,s,c),h=this.Mn(i,s,u),d=this.xn(i,s,a),f=this.On(i.indexId,o,l,c.inclusive,h,u.inclusive,d);return Mc.forEach(f,i=>n.Z(i,t.limit).next(t=>{t.forEach(t=>{const n=cc.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return Mc.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:Kp(Sh.create(e.filters,"and")).map(t=>zh(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}On(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.Nn(t[l/c]):ng,h=this.Bn(e,a,n[l%c],r),d=this.Ln(e,a,i[l%c],s),f=o.map(t=>this.Bn(e,a,t,!0));u.push(...this.createRange(h,d,f))}return u}Bn(e,t,n,r){const i=new Vp(e,cc.empty(),t,n);return r?i:i.En()}Ln(e,t,n,r){const i=new Vp(e,cc.empty(),t,n);return r?i.En():i}Fn(e,t){const n=new zp(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(const r of e)n.gn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2;const r=this.vn(t);return Mc.forEach(r,t=>this.Fn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new _l(ac.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n)}kn(e,t){const n=new Fp;for(const r of Cc(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.ln(r.kind);Rp.Wt.Dt(e,i)}return n.un()}Nn(e){const t=new Fp;return Rp.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){const n=new Fp;return Rp.Wt.Dt(th(this.databaseId,t),n.ln(function(e){const t=Cc(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.un()}xn(e,t,n){if(null===n)return[];let r=[];r.push(new Fp);let i=0;for(const s of Cc(e)){const e=n[i++];for(const n of r)if(this.qn(t,s.fieldPath)&&rh(e))r=this.Un(r,s,e);else{const t=n.ln(s.kind);Rp.Wt.Dt(e,t)}}return this.$n(r)}Mn(e,t,n){return this.xn(e,t,n.position)}$n(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Un(e,t,n){const r=[...e],i=[];for(const s of n.arrayValue.values||[])for(const e of r){const n=new Fp;n.seed(e.un()),Rp.Wt.Dt(s,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof Eh&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=og(e),r=ag(e);return(t?n.H(Bu,IDBKeyRange.bound(t,t)):n.H()).next(e=>{const t=[];return Mc.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){const n=t?new kc(t.sequenceNumber,new Dc(mp(t.readTime),new cc(ou(t.documentKey)),t.largestBatchId)):kc.empty(),r=e.fields.map(e=>{let[t,n]=e;return new Ac(ac.fromServerFormat(t),n)});return new Ec(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Ya(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=og(e),i=ag(e);return this.Wn(e).next(e=>r.H(Bu,IDBKeyRange.bound(t,t)).next(t=>Mc.forEach(t,t=>i.put(Tp(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){const n=new Map;return Mc.forEach(t,(t,r)=>{const i=n.get(t.collectionGroup);return(i?Mc.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),Mc.forEach(i,n=>this.Qn(e,t,n).next(t=>{const i=this.Gn(r,n);return t.isEqual(i)?Mc.resolve():this.zn(e,r,n,t,i)}))))})}jn(e,t,n,r){return sg(e).put(r.Rn(this.uid,this.Kn(n,t.key),t.key))}Hn(e,t,n,r){return sg(e).delete(r.An(this.uid,this.Kn(n,t.key),t.key))}Qn(e,t,n){const r=sg(e);let i=new _l(Up);return r.ee({index:Ju,range:IDBKeyRange.only([n.indexId,this.uid,qp(this.Kn(n,t))])},(e,r)=>{i=i.add(new Vp(n.indexId,t,Bp(r.arrayValue),Bp(r.directionalValue)))}).next(()=>i)}Gn(e,t){let n=new _l(Up);const r=this.kn(t,e);if(null==r)return n;const i=Sc(t);if(null!=i){const s=e.data.field(i.fieldPath);if(rh(s))for(const i of s.arrayValue.values||[])n=n.add(new Vp(t.indexId,e.key,this.Nn(i),r))}else n=n.add(new Vp(t.indexId,e.key,ng,r));return n}zn(e,t,n,r,i){Na(tg,"Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=bl(s),c=bl(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=bl(o)):t?(i(a),a=bl(s)):(a=bl(s),c=bl(o))}}(r,i,Up,r=>{s.push(this.jn(e,t,n,r))},r=>{s.push(this.Hn(e,t,n,r))}),Mc.waitFor(s)}Wn(e){let t=1;return ag(e).ee({index:Ku,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>Up(e,t)).filter((e,t,n)=>!t||0!==Up(e,n[t-1]));const r=[];r.push(e);for(const s of n){const n=Up(s,e),i=Up(s,t);if(0===n)r[0]=e.En();else if(n>0&&i<0)r.push(s),r.push(s.En());else if(i>0)break}r.push(t);const i=[];for(let s=0;s<r.length;s+=2){if(this.Jn(r[s],r[s+1]))return[];const e=r[s].An(this.uid,ng,cc.empty()),t=r[s+1].An(this.uid,ng,cc.empty());i.push(IDBKeyRange.bound(e,t))}return i}Jn(e,t){return Up(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(cg)}getMinOffset(e,t){return Mc.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||xa(44426))).next(cg)}}function ig(e){return fl(e,Mu)}function sg(e){return fl(e,Wu)}function og(e){return fl(e,qu)}function ag(e){return fl(e,zu)}function cg(e){La(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;Pc(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Dc(t.readTime,t.documentKey,n)}const ug={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lg=41943040;class hg{static withCacheSize(e){return new hg(e,hg.DEFAULT_COLLECTION_PERCENTILE,hg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function dg(e,t,n){const r=e.store(hu),i=e.store(vu),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.ee({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{La(1===a,47070,{batchId:n.batchId})}));const u=[];for(const l of n.mutations){const e=mu(t,l.key.path,n.batchId);s.push(i.delete(e)),u.push(l.key)}return Mc.waitFor(s).next(()=>u)}function fg(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw xa(14731);t=e.noDocument}return JSON.stringify(t).length}hg.DEFAULT_COLLECTION_PERCENTILE=10,hg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hg.DEFAULT=new hg(lg,hg.DEFAULT_COLLECTION_PERCENTILE,hg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hg.DISABLED=new hg(-1,0,0);class pg{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static wt(e,t,n,r){La(""!==e.uid,64387);const i=e.isAuthenticated()?e.uid:"";return new pg(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mg(e).ee({index:fu,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=yg(e),s=mg(e);return s.add({}).next(o=>{La("number"==typeof o,49019);const a=new of(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map(t=>Yf(e.yt,t)),i=n.mutations.map(t=>Yf(e.yt,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new _l((e,t)=>Ya(e.canonicalString(),t.canonicalString()));for(const e of r){const t=mu(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,yu))}return l.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[o]=a.keys()}),Mc.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return mg(e).get(t).next(e=>e?(La(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),yp(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?Mc.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return mg(e).ee({index:fu,range:r},(e,t,r)=>{t.userId===this.userId&&(La(t.batchId>=n,47524,{Yn:n}),i=yp(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=$c;return mg(e).ee({index:fu,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,$c],[this.userId,Number.POSITIVE_INFINITY]);return mg(e).H(fu,t).next(e=>e.map(e=>yp(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=gu(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return yg(e).ee({range:r},(n,r,s)=>{const[o,a,c]=n,u=ou(a);if(o===this.userId&&t.path.isEqual(u))return mg(e).get(c).next(e=>{if(!e)throw xa(61480,{er:n,batchId:c});La(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:c}),i.push(yp(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new _l(Ya);const r=[];return t.forEach(t=>{const i=gu(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=yg(e).ee({range:s},(e,r,i)=>{const[s,o,a]=e,c=ou(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()});r.push(o)}),Mc.waitFor(r).next(()=>this.tr(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=gu(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new _l(Ya);return yg(e).ee({range:s},(e,t,i)=>{const[s,a,c]=e,u=ou(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()}).next(()=>this.tr(e,o))}tr(e,t){const n=[],r=[];return t.forEach(t=>{r.push(mg(e).get(t).next(e=>{if(null===e)throw xa(35274,{batchId:t});La(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(yp(this.serializer,e))}))}),Mc.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return dg(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),Mc.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return Mc.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return yg(e).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=ou(e[1]);r.push(t)}else n.done()}).next(()=>{La(0===r.length,56720,{rr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return gg(e,this.userId,t)}ir(e){return vg(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:$c,lastStreamToken:""})}}function gg(e,t,n){const r=gu(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return yg(e).ee({range:s,Y:!0},(e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function mg(e){return fl(e,hu)}function yg(e){return fl(e,vu)}function vg(e){return fl(e,lu)}class wg{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new wg(0)}static ar(){return new wg(-1)}}class _g{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{const n=new wg(t.highestTargetId);return t.highestTargetId=n.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>bc.fromTimestamp(new Ic(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.ur(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.cr(e,r)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(n=>(n.targetCount+=1,this.hr(t,n),this.cr(e,n))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ig(e).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(La(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,n){let r=0;const i=[];return Ig(e).ee((s,o)=>{const a=vp(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>Mc.waitFor(i)).next(()=>r)}forEachTarget(e,t){return Ig(e).ee((e,n)=>{const r=vp(n);t(r)})}ur(e){return bg(e).get(Ou).next(e=>(La(null!==e,2888),e))}cr(e,t){return bg(e).put(Ou,t)}lr(e,t){return Ig(e).put(wp(this.serializer,t))}hr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){const n=Gh(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Ig(e).ee({range:r,index:ku},(e,n,r)=>{const s=vp(n);Kh(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=Tg(e);return t.forEach(t=>{const s=ru(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),Mc.waitFor(r)}removeMatchingKeys(e,t,n){const r=Tg(e);return Mc.forEach(t,t=>{const i=ru(t.path);return Mc.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=Tg(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Tg(e);let i=Ed();return r.ee({range:n,Y:!0},(e,t,n)=>{const r=ou(e[1]),s=new cc(r);i=i.add(s)}).next(()=>i)}containsKey(e,t){const n=ru(t.path),r=IDBKeyRange.bound([n],[nc(n)],!1,!0);let i=0;return Tg(e).ee({index:Pu,Y:!0,range:r},(e,t,n)=>{let[r,s]=e;0!==r&&(i++,n.done())}).next(()=>i>0)}At(e,t){return Ig(e).get(t).next(e=>e?vp(e):null)}}function Ig(e){return fl(e,Au)}function bg(e){return fl(e,Lu)}function Tg(e){return fl(e,Ru)}const Eg="LruGarbageCollector",Sg=1048576;function Cg(e,t){let[n,r]=e,[i,s]=t;const o=Ya(n,i);return 0===o?Ya(r,s):o}class Ag{constructor(e){this.Pr=e,this.buffer=new _l(Cg),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Cg(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class kg{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){Na(Eg,"Garbage collection scheduled in ".concat(e,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){zc(e)?Na(Eg,"Ignoring IndexedDB error during garbage collection: ",e):await Lc(e)}await this.Ar(3e5)})}}class Ng{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Mc.resolve(Xc.ce);const n=new Ag(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Na("LruGarbageCollector","Garbage collection skipped; disabled"),Mc.resolve(ug)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Na("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),ug):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Na("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),ka()<=ee.DEBUG&&Na("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(s-u,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-s)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(a-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(c-a)+"ms\n"+"Total Duration: ".concat(c-u,"ms")),Mc.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function Rg(e,t){return new Ng(e,t)}class Dg{constructor(e,t){this.db=e,this.garbageCollector=Rg(this,t)}dr(e){const t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,n)=>t(n))}addReference(e,t,n){return Pg(e,n)}removeReference(e,t,n){return Pg(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Pg(e,t)}wr(e,t){return function(e,t){let n=!1;return vg(e).te(r=>gg(e,r,t).next(e=>(e&&(n=!0),Mc.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.yr(e,(s,o)=>{if(o<=t){const t=this.wr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,bc.min()),Tg(e).delete(function(e){return[0,ru(e.path)]}(s))))});r.push(t)}}).next(()=>Mc.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Pg(e,t)}yr(e,t){const n=Tg(e);let r,i=Xc.ce;return n.ee({index:Pu},(e,n)=>{let[s,o]=e,{path:a,sequenceNumber:c}=n;0===s?(i!==Xc.ce&&t(new cc(ou(r)),i),i=c,r=a):i=Xc.ce}).next(()=>{i!==Xc.ce&&t(new cc(ou(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Pg(e,t){return Tg(e).put(function(e,t){return{targetId:0,path:ru(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class xg{constructor(){this.changes=new fd(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Mc.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Og{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Vg(e).put(n)}removeEntry(e,t,n){return Vg(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],pp(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=yh.newInvalidDocument(t);return Vg(e).ee({index:Iu,range:IDBKeyRange.only(Ug(t))},(e,r)=>{n=this.Sr(t,r)}).next(()=>n)}Dr(e,t){let n={size:0,document:yh.newInvalidDocument(t)};return Vg(e).ee({index:Iu,range:IDBKeyRange.only(Ug(t))},(e,r)=>{n={document:this.Sr(t,r),size:fg(r)}}).next(()=>n)}getEntries(e,t){let n=gd();return this.Cr(e,t,(e,t)=>{const r=this.Sr(e,t);n=n.insert(e,r)}).next(()=>n)}vr(e,t){let n=gd(),r=new yl(cc.comparator);return this.Cr(e,t,(e,t)=>{const i=this.Sr(e,t);n=n.insert(e,i),r=r.insert(e,fg(t))}).next(()=>({documents:n,Fr:r}))}Cr(e,t,n){if(t.isEmpty())return Mc.resolve();let r=new _l(qg);t.forEach(e=>r=r.add(e));const i=IDBKeyRange.bound(Ug(r.first()),Ug(r.last())),s=r.getIterator();let o=s.getNext();return Vg(e).ee({index:Iu,range:i},(e,t,r)=>{const i=cc.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&qg(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.j(Ug(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),pp(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vg(e).H(IDBKeyRange.bound(o,a,!0)).next(e=>{null===i||void 0===i||i.incrementDocumentReadCount(e.length);let n=gd();for(const i of e){const e=this.Sr(cc.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(ud(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=gd();const s=jg(t,n),o=jg(t,Dc.max());return Vg(e).ee({index:Tu,range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{const s=this.Sr(cc.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new Mg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Fg(e).get(Cu).next(e=>(La(!!e,20021),e))}br(e,t){return Fg(e).put(Cu,t)}Sr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Jf(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=cc.fromSegments(t.noDocument.path),r=mp(t.noDocument.readTime);n=yh.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return xa(56709);{const e=cc.fromSegments(t.unknownDocument.path),r=mp(t.unknownDocument.version);n=yh.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Ic(e[0],e[1]);return bc.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(bc.min()))return e}return yh.newInvalidDocument(e)}}function Lg(e){return new Og(e)}class Mg extends xg{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new fd(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new _l((e,t)=>Ya(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const o=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=fp(this.Mr.serializer,s);r=r.add(i.path.popLast());const c=fg(a);n+=c-o.size,t.push(this.Mr.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=fp(this.Mr.serializer,s.convertToNoDocument(bc.min()));t.push(this.Mr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Mr.updateMetadata(e,n)),Mc.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(e=>{let{documents:t,Fr:n}=e;return n.forEach((e,n)=>{this.Or.set(e,{size:n,readTime:t.get(e).readTime})}),t})}}function Fg(e){return fl(e,Su)}function Vg(e){return fl(e,wu)}function Ug(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function jg(e,t){const n=t.documentKey.path.toArray();return[e,pp(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function qg(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=Ya(n[s],r[s]),i)return i;return i=Ya(n.length,r.length),i||(i=Ya(n[n.length-2],r[r.length-2]),i||Ya(n[n.length-1],r[r.length-1]))}class Bg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class zg{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Jd(n.mutation,e,Tl.empty(),Ic.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Ed()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ed();const r=wd();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=yd();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=wd();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ed()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=gd();const s=Id(),o=Id();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Zd)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Jd(o.mutation,t,o.mutation.getFieldMask(),Ic.now())):s.set(t.key,Tl.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Bg(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=Id();let r=new yl((e,t)=>e-t),i=Ed();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Tl.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Ed()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=_d();c.forEach(e=>{if(!i.has(e)){const r=Wd(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Mc.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return cc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ed(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Mc.resolve(wd());let o=Tc,a=i;return s.next(t=>Mc.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Mc.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,Ed())).next(e=>({batchId:o,changes:vd(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new cc(t)).next(e=>{let t=yd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=yd();return this.indexManager.getCollectionParents(e,i).next(o=>Mc.forEach(o,o=>{const a=function(e,t){return new Yh(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,yh.newInvalidDocument(r)))});let n=yd();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&Jd(s.mutation,r,Tl.empty(),Ic.now()),ud(t,r)&&(n=n.insert(e,r))}),n})}}class Gg{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return Mc.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Vf(e.createTime)}}(t)),Mc.resolve()}getNamedQuery(e,t){return Mc.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(e){return{name:e.name,query:_p(e.bundledQuery),readTime:Vf(e.readTime)}}(t)),Mc.resolve()}}class Kg{constructor(){this.overlays=new yl(cc.comparator),this.Lr=new Map}getOverlay(e,t){return Mc.resolve(this.overlays.get(t))}getOverlays(e,t){const n=wd();return Mc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),Mc.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Lr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(n)),Mc.resolve()}getOverlaysForCollection(e,t,n){const r=wd(),i=t.length+1,s=new cc(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Mc.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new yl((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=wd(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=wd(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return Mc.resolve(o)}bt(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new cf(t,n));let i=this.Lr.get(t);void 0===i&&(i=Ed(),this.Lr.set(t,i)),this.Lr.set(t,i.add(n.key))}}class Hg{constructor(){this.sessionToken=Sl.EMPTY_BYTE_STRING}getSessionToken(e){return Mc.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Mc.resolve()}}class Wg{constructor(){this.kr=new _l(Qg.Kr),this.qr=new _l(Qg.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const n=new Qg(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new Qg(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){const t=new cc(new sc([])),n=new Qg(t,e),r=new Qg(t,e+1),i=[];return this.qr.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new cc(new sc([])),n=new Qg(t,e),r=new Qg(t,e+1);let i=Ed();return this.qr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new Qg(e,0),n=this.kr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Qg{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return cc.comparator(e.key,t.key)||Ya(e.Hr,t.Hr)}static Ur(e,t){return Ya(e.Hr,t.Hr)||cc.comparator(e.key,t.key)}}class Jg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new _l(Qg.Kr)}checkEmpty(e){return Mc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new of(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.Jr=this.Jr.add(new Qg(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Mc.resolve(s)}lookupMutationBatch(e,t){return Mc.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Xr(n),i=r<0?0:r;return Mc.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Mc.resolve(0===this.mutationQueue.length?$c:this.Yn-1)}getAllMutationBatches(e){return Mc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Qg(t,0),r=new Qg(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([n,r],e=>{const t=this.Zr(e.Hr);i.push(t)}),Mc.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new _l(Ya);return t.forEach(e=>{const t=new Qg(e,0),r=new Qg(e,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),Mc.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;cc.isDocumentKey(i)||(i=i.child(""));const s=new Qg(new cc(i),0);let o=new _l(Ya);return this.Jr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Hr)),!0)},s),Mc.resolve(this.Yr(o))}Yr(e){const t=[];return e.forEach(e=>{const n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){La(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Jr;return Mc.forEach(t.mutations,r=>{const i=new Qg(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){const n=new Qg(t,0),r=this.Jr.firstAfterOrEqual(n);return Mc.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Mc.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Yg{constructor(e){this.ti=e,this.docs=new yl(cc.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Mc.resolve(n?n.document.mutableCopy():yh.newInvalidDocument(t))}getEntries(e,t){let n=gd();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():yh.newInvalidDocument(e))}),Mc.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=gd();const s=t.path,o=new cc(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Pc(Rc(o),n)<=0||(r.has(o.key)||ud(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Mc.resolve(i)}getAllFromCollectionGroup(e,t,n,r){xa(9500)}ni(e,t){return Mc.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Xg(this)}getSize(e){return Mc.resolve(this.size)}}class Xg extends xg{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)}),Mc.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class $g{constructor(e){this.persistence=e,this.ri=new fd(e=>Gh(e),Kh),this.lastRemoteSnapshotVersion=bc.min(),this.highestTargetId=0,this.ii=0,this.si=new Wg,this.targetCount=0,this.oi=wg._r()}forEachTarget(e,t){return this.ri.forEach((e,n)=>t(n)),Mc.resolve()}getLastRemoteSnapshotVersion(e){return Mc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Mc.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),Mc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),Mc.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new wg(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,Mc.resolve()}updateTargetData(e,t){return this.lr(t),Mc.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,Mc.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.ri.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Mc.waitFor(i).next(()=>r)}getTargetCount(e){return Mc.resolve(this.targetCount)}getTargetData(e,t){const n=this.ri.get(t)||null;return Mc.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),Mc.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Mc.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),Mc.resolve()}getMatchingKeysForTargetId(e,t){const n=this.si.jr(t);return Mc.resolve(n)}containsKey(e,t){return Mc.resolve(this.si.containsKey(t))}}class Zg{constructor(e,t){this._i={},this.overlays={},this.ai=new Xc(0),this.ui=!1,this.ui=!0,this.ci=new Hg,this.referenceDelegate=e(this),this.li=new $g(this),this.indexManager=new Zp,this.remoteDocumentCache=function(e){return new Yg(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new dp(t),this.Pi=new Gg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Kg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new Jg(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){Na("MemoryPersistence","Starting transaction:",e);const r=new em(this.ai.next());return this.referenceDelegate.Ti(),n(r).next(e=>this.referenceDelegate.Ii(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return Mc.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class em extends Oc{constructor(e){super(),this.currentSequenceNumber=e}}class tm{constructor(e){this.persistence=e,this.Ri=new Wg,this.Ai=null}static Vi(e){return new tm(e)}get di(){if(this.Ai)return this.Ai;throw xa(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),Mc.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),Mc.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),Mc.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Mc.forEach(this.di,n=>{const r=cc.fromPath(n);return this.mi(e,r).next(e=>{e||t.removeEntry(r,bc.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return Mc.or([()=>Mc.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class nm{constructor(e,t){this.persistence=e,this.fi=new fd(e=>ru(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=Rg(this,t)}static Vi(e,t){return new nm(e,t)}Ti(){}Ii(e){return Mc.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return Mc.forEach(this.fi,(n,r)=>this.wr(e,n,r).next(e=>e?Mc.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ni(e,r=>this.wr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,bc.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),Mc.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),Mc.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),Mc.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),Mc.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=eh(e.data.value)),t}wr(e,t,n){return Mc.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.fi.get(t);return Mc.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class rm{constructor(e){this.serializer=e}k(e,t,n,r){const i=new Vc("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(cu)}(e),function(e){e.createObjectStore(lu,{keyPath:"userId"});e.createObjectStore(hu,{keyPath:du,autoIncrement:!0}).createIndex(fu,pu,{unique:!0}),e.createObjectStore(vu)}(e),im(e),function(e){e.createObjectStore(au)}(e));let s=Mc.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Ru),e.deleteObjectStore(Au),e.deleteObjectStore(Lu)}(e),im(e)),s=s.next(()=>function(e){const t=e.store(Lu),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:bc.min().toTimestamp(),targetCount:0};return t.put(Ou,n)}(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>function(e,t){return t.store(hu).H().next(n=>{e.deleteObjectStore(hu),e.createObjectStore(hu,{keyPath:du,autoIncrement:!0}).createIndex(fu,pu,{unique:!0});const r=t.store(hu),i=n.map(e=>r.put(e));return Mc.waitFor(i)})}(e,i))),s=s.next(()=>{!function(e){e.createObjectStore(Vu,{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.gi(i))),n<6&&r>=6&&(s=s.next(()=>(function(e){e.createObjectStore(Su)}(e),this.pi(i)))),n<7&&r>=7&&(s=s.next(()=>this.yi(i))),n<8&&r>=8&&(s=s.next(()=>this.wi(e,i))),n<9&&r>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(s=s.next(()=>this.bi(i))),n<11&&r>=11&&(s=s.next(()=>{!function(e){e.createObjectStore(Uu,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(ju,{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){const t=e.createObjectStore(Xu,{keyPath:$u});t.createIndex(Zu,el,{unique:!1}),t.createIndex(tl,nl,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>function(e){const t=e.createObjectStore(wu,{keyPath:_u});t.createIndex(Iu,bu),t.createIndex(Tu,Eu)}(e)).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(au))),n<14&&r>=14&&(s=s.next(()=>this.Di(e,i))),n<15&&r>=15&&(s=s.next(()=>function(e){e.createObjectStore(qu,{keyPath:"indexId",autoIncrement:!0}).createIndex(Bu,"collectionGroup",{unique:!1});e.createObjectStore(zu,{keyPath:Gu}).createIndex(Ku,Hu,{unique:!1});e.createObjectStore(Wu,{keyPath:Qu}).createIndex(Ju,Yu,{unique:!1})}(e))),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(zu).clear()}).next(()=>{t.objectStore(Wu).clear()})),n<17&&r>=17&&(s=s.next(()=>{!function(e){e.createObjectStore(rl,{keyPath:"name"})}(e)})),n<18&&r>=18&&O()&&(s=s.next(()=>{t.objectStore(zu).clear()}).next(()=>{t.objectStore(Wu).clear()})),s}pi(e){let t=0;return e.store(au).ee((e,n)=>{t+=fg(n)}).next(()=>{const n={byteSize:t};return e.store(Su).put(Cu,n)})}gi(e){const t=e.store(lu),n=e.store(hu);return t.H().next(t=>Mc.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,$c],[t.userId,t.lastAcknowledgedBatchId]);return n.H(fu,r).next(n=>Mc.forEach(n,n=>{La(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});const r=yp(this.serializer,n);return dg(e,t.userId,r).next(()=>{})}))}))}yi(e){const t=e.store(Ru),n=e.store(au);return e.store(Lu).get(Ou).next(e=>{const r=[];return n.ee((n,i)=>{const s=new sc(n),o=function(e){return[0,ru(e)]}(s);r.push(t.get(o).next(n=>n?Mc.resolve():(n=>t.put({targetId:0,path:ru(n),sequenceNumber:e.highestListenSequenceNumber}))(s)))}).next(()=>Mc.waitFor(r))})}wi(e,t){e.createObjectStore(Mu,{keyPath:Fu});const n=t.store(Mu),r=new eg,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:ru(r)})}};return t.store(au).ee({Y:!0},(e,t)=>{const n=new sc(e);return i(n.popLast())}).next(()=>t.store(vu).ee({Y:!0},(e,t)=>{let[n,r,s]=e;const o=ou(r);return i(o.popLast())}))}bi(e){const t=e.store(Au);return t.ee((e,n)=>{const r=vp(n),i=wp(this.serializer,r);return t.put(i)})}Si(e,t){const n=t.store(au),r=[];return n.ee((e,n)=>{const i=t.store(wu),s=function(e){return e.document?new cc(sc.fromString(e.document.name).popFirst(5)):e.noDocument?cc.fromSegments(e.noDocument.path):e.unknownDocument?cc.fromSegments(e.unknownDocument.path):xa(36783)}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))}).next(()=>Mc.waitFor(r))}Di(e,t){const n=t.store(hu),r=Lg(this.serializer),i=new Zg(tm.Vi,this.serializer.yt);return n.H().next(e=>{const n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:Ed();yp(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),Mc.forEach(n,(e,n)=>{const s=new Sa(n),o=Ap.wt(this.serializer,s),a=i.getIndexManager(s),c=pg.wt(s,this.serializer,a,i.referenceDelegate);return new zg(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new dl(t,Xc.ce),e).next()})})}}function im(e){e.createObjectStore(Ru,{keyPath:Du}).createIndex(Pu,xu,{unique:!0}),e.createObjectStore(Au,{keyPath:"targetId"}).createIndex(ku,Nu,{unique:!0}),e.createObjectStore(Lu)}const sm="IndexedDbPersistence",om=18e5,am=5e3,cm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",um="main";class lm{constructor(e,t,n,r,i,s,o,a,c,u){let l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:18;if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ci=i,this.window=s,this.document=o,this.Fi=c,this.Mi=u,this.xi=l,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=Number.NEGATIVE_INFINITY,this.ki=e=>Promise.resolve(),!lm.v())throw new Va(Fa.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Dg(this,r),this.Ki=t+um,this.serializer=new dp(a),this.qi=new Uc(this.Ki,this.xi,new rm(this.serializer)),this.ci=new Np,this.li=new _g(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Lg(this.serializer),this.Pi=new Ep,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&Ra(sm,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Va(Fa.FAILED_PRECONDITION,cm);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new Xc(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>dm(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(zc(e))return Na(sm,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Na(sm,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return hm(e).get(uu).next(e=>Mc.resolve(this.Xi(e)))}Yi(e){return dm(e).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,om)){this.Li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=fl(e,Vu);return t.H().next(e=>{const n=this.ns(e,om),r=e.filter(e=>-1===n.indexOf(e));return Mc.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ui)for(const t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?Mc.resolve(!0):hm(e).get(uu).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,am)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new Va(Fa.FAILED_PRECONDITION,cm);return!1}}return!(!this.networkEnabled||!this.inForeground)||dm(e).H().next(e=>void 0===this.ns(e,am).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&Na(sm,"Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[cu,Vu],e=>{const t=new dl(e,Xc.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>dm(e).H().next(e=>this.ns(e,om).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return pg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rg(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Ap.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,n){Na(sm,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 18===e?hl:17===e?ll:16===e?ul:15===e?cl:14===e?al:13===e?ol:12===e?sl:11===e?il:void xa(60245)}(this.xi);let s;return this.qi.runTransaction(e,r,i,r=>(s=new dl(r,this.ai?this.ai.next():Xc.ce),"readwrite-primary"===t?this.ji(s).next(e=>!!e||this.Hi(s)).next(t=>{if(!t)throw Ra("Failed to obtain primary lease for action '".concat(e,"'.")),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new Va(Fa.FAILED_PRECONDITION,xc);return n(s)}).next(e=>this.Zi(s).next(()=>e)):this.Ps(s).next(()=>n(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Ps(e){return hm(e).get(uu).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,am)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Va(Fa.FAILED_PRECONDITION,cm)})}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return hm(e).put(uu,t)}static v(){return Uc.v()}Ji(e){const t=hm(e);return t.get(uu).next(e=>this.Xi(e)?(Na(sm,"Releasing primary lease."),t.delete(uu)):Mc.resolve())}ts(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Ra("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Oi=()=>{this._s();const e=/(?:Version|Mobile)\/1[456]/;x()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{var t;const n=null!==(null===(t=this.Ui)||void 0===t?void 0:t.getItem(this.rs(e)));return Na(sm,"Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Ra(sm,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){Ra("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}function hm(e){return fl(e,cu)}function dm(e){return fl(e,Vu)}function fm(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class pm{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(e,t){let n=Ed(),r=Ed();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new pm(e,t.fromCache,n,r)}}class gm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class mm{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=x()?8:jc(A())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new gm;return this.ys(e,t,n).next(r=>{if(i.result=r,this.As)return this.ws(e,t,n,r.size)})}).next(()=>i.result)}ws(e,t,n,r){return n.documentReadCount<this.Vs?(ka()<=ee.DEBUG&&Na("QueryEngine","SDK will not create cache indexes for query:",cd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),Mc.resolve()):(ka()<=ee.DEBUG&&Na("QueryEngine","Query:",cd(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(ka()<=ee.DEBUG&&Na("QueryEngine","The SDK decides to create cache indexes for query:",cd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nd(t))):Mc.resolve())}gs(e,t){if(Zh(t))return Mc.resolve(null);let n=nd(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=sd(t,null,"F"),n=nd(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=Ed(...r);return this.fs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.bs(t,r);return this.Ss(t,s,i,n.readTime)?this.gs(e,sd(t,null,"F")):this.Ds(e,s,t,n)}))})))}ps(e,t,n,r){return Zh(t)||r.isEqual(bc.min())?Mc.resolve(null):this.fs.getDocuments(e,n).next(i=>{const s=this.bs(t,i);return this.Ss(t,s,n,r)?Mc.resolve(null):(ka()<=ee.DEBUG&&Na("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),cd(t)),this.Ds(e,s,t,Nc(r,Tc)).next(e=>e))})}bs(e,t){let n=new _l(hd(e));return t.forEach((t,r)=>{ud(e,r)&&(n=n.add(r))}),n}Ss(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ys(e,t,n){return ka()<=ee.DEBUG&&Na("QueryEngine","Using full collection scan to execute query:",cd(t)),this.fs.getDocumentsMatchingQuery(e,t,Dc.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const ym="LocalStore";class vm{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new yl(Ya),this.Fs=new fd(e=>Gh(e),Kh),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zg(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function wm(e,t,n,r){return new vm(e,t,n,r)}async function _m(e,t){const n=Ma(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Os(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=Ed();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function Im(e){const t=Ma(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.li.getLastRemoteSnapshotVersion(e))}function bm(e,t,n){let r=Ed(),i=Ed();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=gd();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(bc.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Na(ym,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{Bs:r,Ls:i}})}function Tm(e,t){const n=Ma(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=$c),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Em(e,t){const n=Ma(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.li.getTargetData(e,t).next(i=>i?(r=i,Mc.resolve(r)):n.li.allocateTargetId(e).next(i=>(r=new hp(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.li.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.vs.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.vs=n.vs.insert(e.targetId,e),n.Fs.set(t,e.targetId)),e})}async function Sm(e,t,n){const r=Ma(e),i=r.vs.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!zc(e))throw e;Na(ym,"Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.vs=r.vs.remove(t),r.Fs.delete(i.target)}function Cm(e,t,n){const r=Ma(e);let i=bc.min(),s=Ed();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=Ma(e),i=r.Fs.get(n);return void 0!==i?Mc.resolve(r.vs.get(i)):r.li.getTargetData(t,n)}(r,e,nd(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Cs.getDocumentsMatchingQuery(e,t,n?i:bc.min(),n?s:Ed())).next(e=>(Nm(r,ld(t),e),{documents:e,ks:s})))}function Am(e,t){const n=Ma(e),r=Ma(n.li),i=n.vs.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function km(e,t){const n=Ma(e),r=n.Ms.get(t)||bc.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.xs.getAllFromCollectionGroup(e,t,Nc(r,Tc),Number.MAX_SAFE_INTEGER)).then(e=>(Nm(n,t,e),e))}function Nm(e,t,n){let r=e.Ms.get(t)||bc.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ms.set(t,r)}async function Rm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ed();const r=await Em(e,nd(_p(t.bundledQuery))),i=Ma(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{const s=Vf(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Pi.saveNamedQuery(e,t);const o=r.withResumeToken(Sl.EMPTY_BYTE_STRING,s);return i.vs=i.vs.insert(o.targetId,o),i.li.updateTargetData(e,o).next(()=>i.li.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.li.addMatchingKeys(e,n,r.targetId)).next(()=>i.Pi.saveNamedQuery(e,t))})}const Dm="firestore_clients";function Pm(e,t){return"".concat(Dm,"_").concat(e,"_").concat(t)}const xm="firestore_mutations";function Om(e,t,n){let r="".concat(xm,"_").concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}const Lm="firestore_targets";function Mm(e,t){return"".concat(Lm,"_").concat(e,"_").concat(t)}const Fm="SharedClientState";class Vm{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Va(r.error.code,r.error.message))),s?new Vm(e,t,r.state,i):(Ra(Fm,"Failed to parse mutation state for ID '".concat(t,"': ").concat(n)),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Um{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Va(n.error.code,n.error.message))),i?new Um(e,n.state,r):(Ra(Fm,"Failed to parse target state for ID '".concat(e,"': ").concat(t)),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class jm{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Cd();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=tu(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new jm(e,i):(Ra(Fm,"Failed to parse client data for instance '".concat(e,"': ").concat(t)),null)}}class qm{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new qm(t.clientId,t.onlineState):(Ra(Fm,"Failed to parse online state: ".concat(e)),null)}}class Bm{constructor(){this.activeTargetIds=Cd()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zm{constructor(e,t,n,r,i){this.window=e,this.Ci=t,this.persistenceKey=n,this.zs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new yl(Ya),this.started=!1,this.Zs=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=Pm(this.persistenceKey,this.zs),this.Ys=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.Js=this.Js.insert(this.zs,new Bm),this.eo=new RegExp("^".concat(Dm,"_").concat(s,"_([^_]*)$")),this.no=new RegExp("^".concat(xm,"_").concat(s,"_(\\d+)(?:_(.*))?$")),this.ro=new RegExp("^".concat(Lm,"_").concat(s,"_(\\d+)$")),this.io=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.so=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.hs();for(const n of e){if(n===this.zs)continue;const e=this.getItem(Pm(this.persistenceKey,n));if(e){const t=jm.$s(n,e);t&&(this.Js=this.Js.insert(t.clientId,t))}}this.oo();const t=this.storage.getItem(this.io);if(t){const e=this._o(t);e&&this.ao(e)}for(const n of this.Zs)this.Hs(n);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,n){this.co(e,t,n),this.lo(e)}addLocalQueryTarget(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(Mm(this.persistenceKey,e));if(t){const r=Um.$s(e,t);r&&(n=r.state)}}return t&&this.ho.Qs(e),this.oo(),n}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Mm(this.persistenceKey,e))}updateQueryState(e,t,n){this.Po(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.lo(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Na(Fm,"READ",e,t),t}setItem(e,t){Na(Fm,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Na(Fm,"REMOVE",e),this.storage.removeItem(e)}Hs(e){const t=e;if(t.storageArea===this.storage){if(Na(Fm,"EVENT",t.key,t.newValue),t.key===this.Xs)return void Ra("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==t.key)if(this.eo.test(t.key)){if(null==t.newValue){const e=this.Eo(t.key);return this.Ro(e,null)}{const e=this.Ao(t.key,t.newValue);if(e)return this.Ro(e.clientId,e)}}else if(this.no.test(t.key)){if(null!==t.newValue){const e=this.Vo(t.key,t.newValue);if(e)return this.mo(e)}}else if(this.ro.test(t.key)){if(null!==t.newValue){const e=this.fo(t.key,t.newValue);if(e)return this.po(e)}}else if(t.key===this.io){if(null!==t.newValue){const e=this._o(t.newValue);if(e)return this.ao(e)}}else if(t.key===this.Ys){const e=function(e){let t=Xc.ce;if(null!=e)try{const n=JSON.parse(e);La("number"==typeof n,30636,{yo:e}),t=n}catch(e){Ra(Fm,"Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Xc.ce&&this.sequenceNumberHandler(e)}else if(t.key===this.so){const e=this.wo(t.newValue);await Promise.all(e.map(e=>this.syncEngine.bo(e)))}}else this.Zs.push(t)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,n){const r=new Vm(this.currentUser,e,t,n),i=Om(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}lo(e){const t=Om(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){const t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,n){const r=Mm(this.persistenceKey,e),i=new Um(e,t,n);this.setItem(r,i.Ws())}Io(e){const t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){const t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){const n=this.Eo(e);return jm.$s(n,t)}Vo(e,t){const n=this.no.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Vm.$s(new Sa(i),r,t)}fo(e,t){const n=this.ro.exec(e),r=Number(n[1]);return Um.$s(r,t)}_o(e){return qm.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);Na(Fm,"Ignoring mutation for non-active user ".concat(e.user.uid))}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){const n=t?this.Js.insert(e,t):this.Js.remove(e),r=this.uo(this.Js),i=this.uo(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.Co(s,o).then(()=>{this.Js=n})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=Cd();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class Gm{constructor(){this.vo=new Bm,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Bm,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Km{Mo(e){}shutdown(){}}const Hm="ConnectivityMonitor";class Wm{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){Na(Hm,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){Na(Hm,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Qm=null;function Jm(){return null===Qm?Qm=268435456+Math.round(2147483648*Math.random()):Qm++,"0x"+Qm.toString(16)}const Ym="RestConnection",Xm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class $m{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo="projects/".concat(n,"/databases/").concat(r),this.$o=this.databaseId.database===Vl?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Wo(e,t,n,r,i){const s=Jm(),o=this.Qo(e,t.toUriEncodedString());Na(Ym,"Sending RPC '".concat(e,"' ").concat(s,":"),o,n);const a={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(a,r,i);const{host:c}=new URL(o),u=b(c);return this.zo(e,o,a,n,u).then(t=>(Na(Ym,"Received RPC '".concat(e,"' ").concat(s,": "),t),t),t=>{throw Da(Ym,"RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",o,"request:",n),t})}jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}Go(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ca,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Qo(e,t){const n=Xm[e];let r="".concat(this.qo,"/v1/").concat(t,":").concat(n);return this.databaseInfo.apiKey&&(r="".concat(r,"?key=").concat(encodeURIComponent(this.databaseInfo.apiKey))),r}terminate(){}}class Zm{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const ey="WebChannelConnection",ty=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};class ny extends $m{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!ny.c_){const e=Ia();ty(e,_a.STAT_EVENT,e=>{e.stat===wa.PROXY?Na(ey,"STAT_EVENT: detected buffering proxy"):e.stat===wa.NOPROXY&&Na(ey,"STAT_EVENT: detected no buffering proxy")}),ny.c_=!0}}zo(e,t,n,r,i){const s=Jm();return new Promise((i,o)=>{const a=new ga;a.setWithCredentials(!0),a.listenOnce(ya.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case va.NO_ERROR:const n=a.getResponseJson();Na(ey,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(n)),i(n);break;case va.TIMEOUT:Na(ey,"RPC '".concat(e,"' ").concat(s," timed out")),o(new Va(Fa.DEADLINE_EXCEEDED,"Request time out"));break;case va.HTTP_ERROR:const r=a.getStatus();if(Na(ey,"RPC '".concat(e,"' ").concat(s," failed with status:"),r,"response text:",a.getResponseText()),r>0){var t;let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const n=null===(t=e)||void 0===t?void 0:t.error;if(n&&n.status&&n.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Fa).indexOf(t)>=0?t:Fa.UNKNOWN}(n.status);o(new Va(e,n.message))}else o(new Va(Fa.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Va(Fa.UNAVAILABLE,"Connection failed."));break;default:xa(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{Na(ey,"RPC '".concat(e,"' ").concat(s," completed."))}});const c=JSON.stringify(r);Na(ey,"RPC '".concat(e,"' ").concat(s," sending request:"),r),a.send(t,"POST",c,n,15)})}T_(e,t,n){const r=Jm(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(o.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const c=i.join("");Na(ey,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(c),o);const u=s.createWebChannel(c,o);this.I_(u);let l=!1,h=!1;const d=new Zm({Ho:t=>{h?Na(ey,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(l||(Na(ey,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),u.open(),l=!0),Na(ey,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),u.send(t))},Jo:()=>u.close()});return ty(u,ma.EventType.OPEN,()=>{h||(Na(ey,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),d.i_())}),ty(u,ma.EventType.CLOSE,()=>{h||(h=!0,Na(ey,"RPC '".concat(e,"' stream ").concat(r," transport closed")),d.o_(),this.E_(u))}),ty(u,ma.EventType.ERROR,t=>{h||(h=!0,Da(ey,"RPC '".concat(e,"' stream ").concat(r," transport errored. Name:"),t.name,"Message:",t.message),d.o_(new Va(Fa.UNAVAILABLE,"The operation could not be completed")))}),ty(u,ma.EventType.MESSAGE,t=>{if(!h){var n;const i=t.data[0];La(!!i,16349);const s=i,o=(null===s||void 0===s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Na(ey,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);const t=o.status;let n=function(e){const t=lf[e];if(void 0!==t)return ff(t)}(t),i=o.message;"NOT_FOUND"===t&&i.includes("database")&&i.includes("does not exist")&&i.includes(this.databaseId.database)&&Da("Database '".concat(this.databaseId.database,"' not found. Please check your project configuration.")),void 0===n&&(n=Fa.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),h=!0,d.o_(new Va(n,i)),u.close()}else Na(ey,"RPC '".concat(e,"' stream ").concat(r," received:"),i),d.__(i)}}),ny.u_(),setTimeout(()=>{d.s_()},0),d}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return ba()}}function ry(e){return new ny(e)}function iy(){return"undefined"!=typeof window?window:null}function sy(){return"undefined"!=typeof document?document:null}function oy(e){return new xf(e,!0)}ny.c_=!1;class ay{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&Na("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.d_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const cy="PersistentStream";class uy{constructor(e,t,n,r,i,s,o,a){this.Ci=e,this.b_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ay(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===Fa.RESOURCE_EXHAUSTED?(Ra(t.toString()),Ra("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Fa.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.D_===t&&this.G_(n,r)},t=>{e(()=>{const e=new Va(Fa.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Na(cy,"close with error: ".concat(e)),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(Na(cy,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ly extends uy{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:xa(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(La(void 0===t||"string"==typeof t,58123),Sl.fromBase64String(t||"")):(La(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Sl.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Fa.UNKNOWN:ff(e.code);return new Va(t,e.message||"")}(o);n=new Sf(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=zf(e,r.document.name),s=Vf(r.document.updateTime),o=r.document.createTime?Vf(r.document.createTime):bc.min(),a=new gh({mapValue:{fields:r.document.fields}}),c=yh.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Tf(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=zf(e,r.document),s=r.readTime?Vf(r.readTime):bc.min(),o=yh.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Tf([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=zf(e,r.document),s=r.removedTargetIds||[];n=new Tf([],s,i,null)}else{if(!("filter"in t))return xa(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new uf(r,i),o=e.targetId;n=new Ef(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return bc.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?bc.min():t.readTime?Vf(t.readTime):bc.min()}(e);return this.listener.J_(t,n)}Z_(e){const t={};t.database=Hf(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Hh(r)?{documents:$f(e,r)}:{query:Zf(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Mf(e,t.resumeToken);const r=Of(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(bc.min())>0){n.readTime=Lf(e,t.snapshotVersion.toTimestamp());const r=Of(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xa(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.K_(t)}X_(e){const t={};t.database=Hf(this.serializer),t.removeTarget=e,this.K_(t)}}class hy extends uy{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return La(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,La(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){La(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(La(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Vf(e.updateTime):Vf(t);return n.isEqual(bc.min())&&(n=Vf(t)),new zd(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Vf(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Hf(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Yf(this.serializer,e))};this.K_(t)}}class dy{}class fy extends dy{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new Va(Fa.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,o]=i;return this.connection.Wo(e,jf(t,n),r,s,o)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Fa.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Va(Fa.UNKNOWN,e.toString())})}jo(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[o,a]=s;return this.connection.jo(e,jf(t,n),r,o,a,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Fa.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Va(Fa.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function py(e,t,n,r){return new fy(e,t,n,r)}class gy{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(Ra(t),this.aa=!1):Na("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const my="RemoteStore";class yy{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{n.enqueueAndForget(async()=>{Cy(this)&&(Na(my,"Restarting streams for network reachability change."),await async function(e){const t=Ma(e);t.Ea.add(4),await wy(t),t.Va.set("Unknown"),t.Ea.delete(4),await vy(t)}(this))})}),this.Va=new gy(n,r)}}async function vy(e){if(Cy(e))for(const t of e.Ra)await t(!0)}async function wy(e){for(const t of e.Ra)await t(!1)}function _y(e,t){const n=Ma(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),Sy(n)?Ey(n):Ky(n).O_()&&by(n,t))}function Iy(e,t){const n=Ma(e),r=Ky(n);n.Ia.delete(t),r.O_()&&Ty(n,t),0===n.Ia.size&&(r.O_()?r.L_():Cy(n)&&n.Va.set("Unknown"))}function by(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(bc.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ky(e).Z_(t)}function Ty(e,t){e.da.$e(t),Ky(e).X_(t)}function Ey(e){e.da=new Af({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Ky(e).start(),e.Va.ua()}function Sy(e){return Cy(e)&&!Ky(e).x_()&&e.Ia.size>0}function Cy(e){return 0===Ma(e).Ea.size}function Ay(e){e.da=void 0}async function ky(e){e.Va.set("Online")}async function Ny(e){e.Ia.forEach((t,n)=>{by(e,t)})}async function Ry(e,t){Ay(e),Sy(e)?(e.Va.ha(t),Ey(e)):e.Va.set("Unknown")}async function Dy(e,t,n){if(e.Va.set("Online"),t instanceof Sf&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.da.removeTarget(r))}(e,t)}catch(n){Na(my,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Py(e,n)}else if(t instanceof Tf?e.da.Xe(t):t instanceof Ef?e.da.st(t):e.da.tt(t),!n.isEqual(bc.min()))try{const t=await Im(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.da.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(Sl.EMPTY_BYTE_STRING,r.snapshotVersion)),Ty(e,t);const i=new hp(r.target,t,n,r.sequenceNumber);by(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Na(my,"Failed to raise snapshot:",t),await Py(e,t)}}async function Py(e,t,n){if(!zc(t))throw t;e.Ea.add(1),await wy(e),e.Va.set("Offline"),n||(n=()=>Im(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Na(my,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await vy(e)})}function xy(e,t){return t().catch(n=>Py(e,n,t))}async function Oy(e){const t=Ma(e),n=Hy(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:$c;for(;Ly(t);)try{const e=await Tm(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,My(t,e)}catch(e){await Py(t,e)}Fy(t)&&Vy(t)}function Ly(e){return Cy(e)&&e.Ta.length<10}function My(e,t){e.Ta.push(t);const n=Hy(e);n.O_()&&n.Y_&&n.ea(t.mutations)}function Fy(e){return Cy(e)&&!Hy(e).x_()&&e.Ta.length>0}function Vy(e){Hy(e).start()}async function Uy(e){Hy(e).ra()}async function jy(e){const t=Hy(e);for(const n of e.Ta)t.ea(n.mutations)}async function qy(e,t,n){const r=e.Ta.shift(),i=af.from(r,t,n);await xy(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await Oy(e)}async function By(e,t){t&&Hy(e).Y_&&await async function(e,t){if(function(e){return df(e)&&e!==Fa.ABORTED}(t.code)){const n=e.Ta.shift();Hy(e).B_(),await xy(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Oy(e)}}(e,t),Fy(e)&&Vy(e)}async function zy(e,t){const n=Ma(e);n.asyncQueue.verifyOperationInProgress(),Na(my,"RemoteStore received new credentials");const r=Cy(n);n.Ea.add(3),await wy(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await vy(n)}async function Gy(e,t){const n=Ma(e);t?(n.Ea.delete(2),await vy(n)):t||(n.Ea.add(2),await wy(n),n.Va.set("Unknown"))}function Ky(e){return e.ma||(e.ma=function(e,t,n){const r=Ma(e);return r.sa(),new ly(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:ky.bind(null,e),Yo:Ny.bind(null,e),t_:Ry.bind(null,e),J_:Dy.bind(null,e)}),e.Ra.push(async t=>{t?(e.ma.B_(),Sy(e)?Ey(e):e.Va.set("Unknown")):(await e.ma.stop(),Ay(e))})),e.ma}function Hy(e){return e.fa||(e.fa=function(e,t,n){const r=Ma(e);return r.sa(),new hy(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),Yo:Uy.bind(null,e),t_:By.bind(null,e),ta:jy.bind(null,e),na:qy.bind(null,e)}),e.Ra.push(async t=>{t?(e.fa.B_(),await Oy(e)):(await e.fa.stop(),e.Ta.length>0&&(Na(my,"Stopping write stream with ".concat(e.Ta.length," pending writes")),e.Ta=[]))})),e.fa}class Wy{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ua,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Wy(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Va(Fa.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qy(e,t){if(Ra("AsyncQueue","".concat(t,": ").concat(e)),zc(e))return new Va(Fa.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Jy{static emptySet(e){return new Jy(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||cc.comparator(t.key,n.key):(e,t)=>cc.comparator(e.key,t.key),this.keyedMap=yd(),this.sortedSet=new yl(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Jy))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Jy;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Yy{constructor(){this.ga=new yl(cc.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):xa(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Xy{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Xy(e,t,Jy.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&od(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class $y{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class Zy{constructor(){this.queries=ev(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=Ma(e),r=n.queries;n.queries=ev(),r.forEach((e,n)=>{for(const r of n.ba)r.onError(t)})}(this,new Va(Fa.ABORTED,"Firestore shutting down"))}}function ev(){return new fd(e=>ad(e),od)}async function tv(e,t){const n=Ma(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.Sa()&&t.Da()&&(r=2):(s=new $y,r=t.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Qy(e,"Initialization of query '".concat(cd(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,s),s.ba.push(t),t.va(n.onlineState),s.wa&&t.Fa(s.wa)&&sv(n)}async function nv(e,t){const n=Ma(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.ba.indexOf(t);e>=0&&(s.ba.splice(e,1),0===s.ba.length?i=t.Da()?0:1:!s.Sa()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function rv(e,t){const n=Ma(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.ba)e.Fa(i)&&(r=!0);t.wa=i}}r&&sv(n)}function iv(e,t,n){const r=Ma(e),i=r.queries.get(t);if(i)for(const s of i.ba)s.onError(n);r.queries.delete(t)}function sv(e){e.Ca.forEach(e=>{e.next()})}var ov,av;(av=ov||(ov={})).Ma="default",av.Cache="cache";class cv{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Xy(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.Ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Xy.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ov.Cache}}class uv{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class lv{constructor(e){this.serializer=e}Ks(e){return zf(this.serializer,e)}qs(e){return e.metadata.exists?Jf(this.serializer,e.document,!1):yh.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return Vf(e)}}class hv{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=dv(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;const n=sc.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,l({},this.progress)):null}za(e){const t=new Map,n=new lv(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Ks(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Ed()).add(e);t.set(n,r)}}return t}async ja(e){const t=await async function(e,t,n,r){const i=Ma(e);let s=Ed(),o=gd();for(const u of n){const e=t.Ks(u.metadata.name);u.document&&(s=s.add(e));const n=t.qs(u);n.setReadTime(t.Us(u.metadata.readTime)),o=o.insert(e,n)}const a=i.xs.newChangeBuffer({trackRemovals:!0}),c=await Em(i,function(e){return nd($h(sc.fromString("__bundle__/docs/".concat(e))))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>bm(e,a,o).next(t=>(a.apply(e),t)).next(t=>i.li.removeMatchingKeysForTargetId(e,c.targetId).next(()=>i.li.addMatchingKeys(e,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.Bs,t.Ls)).next(()=>t.Bs)))}(e,new lv(this.serializer),this.Qa,this.$a.id),n=this.za(this.documents);for(const r of this.Wa)await Rm(e,r,n.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function dv(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class fv{constructor(e){this.key=e}}class pv{constructor(e){this.key=e}}class gv{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Ed(),this.mutatedKeys=Ed(),this.eu=hd(e),this.tu=new Jy(this.eu)}get nu(){return this.Za}ru(e,t){const n=t?t.iu:new Yy,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),l=ud(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.su(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.eu(l,a)>0||c&&this.eu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Ss:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xa(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=null!==r&&void 0!==r&&r;const o=t&&!r?this._u():[],a=0===this.Ya.size&&this.current&&!r?1:0,c=a!==this.Xa;return this.Xa=a,0!==s.length||c?{snapshot:new Xy(this.query,e.tu,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Yy,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Ed(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});const t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new pv(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new fv(n))}),t}cu(e){this.Za=e.ks,this.Ya=Ed();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Xy.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}const mv="SyncEngine";class yv{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class vv{constructor(e){this.key=e,this.hu=!1}}class wv{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new fd(e=>ad(e),od),this.Iu=new Map,this.Eu=new Set,this.Ru=new yl(cc.comparator),this.Au=new Map,this.Vu=new Wg,this.du={},this.mu=new Map,this.fu=wg.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function _v(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Jv(e);let i;const s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await bv(r,t,n,!0),i}async function Iv(e,t){const n=Jv(e);await bv(n,t,!0,!1)}async function bv(e,t,n,r){const i=await Em(e.localStore,nd(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await Tv(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&_y(e.remoteStore,i),a}async function Tv(e,t,n,r,i){e.pu=(t,n,r)=>async function(e,t,n,r){let i=t.view.ru(n);i.Ss&&(i=await Cm(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ru(n,i)}));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Lv(e,t.targetId,a.au),a.snapshot}(e,t,n,r);const s=await Cm(e.localStore,t,!0),o=new gv(t,s.ks),a=o.ru(s.documents),c=bf.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Lv(e,n,u.au);const l=new yv(t,n,o);return e.Tu.set(t,l),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function Ev(e,t,n){const r=Ma(e),i=r.Tu.get(t),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(e=>!od(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Sm(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Iy(r.remoteStore,i.targetId),xv(r,i.targetId)}).catch(Lc)):(xv(r,i.targetId),await Sm(r.localStore,i.targetId,!0))}async function Sv(e,t){const n=Ma(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Iy(n.remoteStore,r.targetId))}async function Cv(e,t){const n=Ma(e);try{const e=await function(e,t){const n=Ma(e),r=t.snapshotVersion;let i=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.li.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.li.addMatchingKeys(e,s.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Sl.EMPTY_BYTE_STRING,bc.min()).withLastLimboFreeSnapshotVersion(bc.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,u,s)&&o.push(n.li.updateTargetData(e,u))});let a=gd(),c=Ed();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(bm(e,s,t.documentUpdates).next(e=>{a=e.Bs,c=e.Ls})),!r.isEqual(bc.min())){const t=n.li.getLastRemoteSnapshotVersion(e).next(t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return Mc.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.vs=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(La(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?La(r.hu,14607):e.removedDocuments.size>0&&(La(r.hu,42227),r.hu=!1))}),await Vv(n,e,t)}catch(e){await Lc(e)}}function Av(e,t,n){const r=Ma(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const i=r.view.va(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=Ma(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.ba)i.va(t)&&(r=!0)}),r&&sv(n)}(r.eventManager,t),e.length&&r.Pu.J_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function kv(e,t,n){const r=Ma(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Au.get(t),s=i&&i.key;if(s){let e=new yl(cc.comparator);e=e.insert(s,yh.newNoDocument(s,bc.min()));const n=Ed().add(s),i=new If(bc.min(),new Map,new yl(Ya),e,n);await Cv(r,i),r.Ru=r.Ru.remove(s),r.Au.delete(t),Fv(r)}else await Sm(r.localStore,t,!1).then(()=>xv(r,t,n)).catch(Lc)}async function Nv(e,t){const n=Ma(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Ma(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.xs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Mc.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);La(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ed();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);Pv(n,r,null),Dv(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Vv(n,e)}catch(e){await Lc(e)}}async function Rv(e,t,n){const r=Ma(e);try{const e=await function(e,t){const n=Ma(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(La(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);Pv(r,t,n),Dv(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Vv(r,e)}catch(n){await Lc(n)}}function Dv(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Pv(e,t,n){const r=Ma(e);let i=r.du[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.du[r.currentUser.toKey()]=i}}function xv(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||Ov(e,t)})}function Ov(e,t){e.Eu.delete(t.path.canonicalString());const n=e.Ru.get(t);null!==n&&(Iy(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),Fv(e))}function Lv(e,t,n){for(const r of n)r instanceof fv?(e.Vu.addReference(r.key,t),Mv(e,r)):r instanceof pv?(Na(mv,"Document no longer in limbo: "+r.key),e.Vu.removeReference(r.key,t),e.Vu.containsKey(r.key)||Ov(e,r.key)):xa(19791,{wu:r})}function Mv(e,t){const n=t.key,r=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(r)||(Na(mv,"New document in limbo: "+n),e.Eu.add(r),Fv(e))}function Fv(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new cc(sc.fromString(t)),r=e.fu.next();e.Au.set(r,new vv(n)),e.Ru=e.Ru.insert(n,r),_y(e.remoteStore,new hp(nd($h(n.path)),r,"TargetPurposeLimboResolution",Xc.ce))}}async function Vv(e,t,n){const r=Ma(e),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((e,a)=>{o.push(r.pu(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){var t;const i=e?!e.fromCache:null===n||void 0===n||null===(t=n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=pm.Es(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.Pu.J_(i),await async function(e,t){const n=Ma(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Mc.forEach(t,t=>Mc.forEach(t.Ts,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Mc.forEach(t.Is,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!zc(e))throw e;Na(ym,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.vs.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.vs=n.vs.insert(e,i)}}}(r.localStore,s))}async function Uv(e,t){const n=Ma(e);if(!n.currentUser.isEqual(t)){Na(mv,"User change. New user:",t.toKey());const e=await _m(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new Va(Fa.CANCELLED,t))})}),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Vv(n,e.Ns)}}function jv(e,t){const n=Ma(e),r=n.Au.get(t);if(r&&r.hu)return Ed().add(r.key);{let e=Ed();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}async function qv(e,t){const n=Ma(e),r=await Cm(n.localStore,t.query,!0),i=t.view.cu(r);return n.isPrimaryClient&&Lv(n,t.targetId,i.au),i}async function Bv(e,t){const n=Ma(e);return km(n.localStore,t).then(e=>Vv(n,e))}async function zv(e,t,n,r){const i=Ma(e),s=await function(e,t){const n=Ma(e),r=Ma(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.Xn(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):Mc.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await Oy(i.remoteStore):"acknowledged"===n||"rejected"===n?(Pv(i,t,r||null),Dv(i,t),function(e,t){Ma(Ma(e).mutationQueue).nr(t)}(i.localStore,t)):xa(6720,"Unknown batchState",{bu:n}),await Vv(i,s)):Na(mv,"Cannot apply mutation batch with id: "+t)}async function Gv(e,t,n){const r=Ma(e),i=[],s=[];for(const o of t){let e;const t=r.Iu.get(o);if(t&&0!==t.length){e=await Em(r.localStore,nd(t[0]));for(const e of t){const t=r.Tu.get(e),n=await qv(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await Am(r.localStore,o);e=await Em(r.localStore,t),await Tv(r,Kv(t),o,!1,e.resumeToken)}i.push(e)}return r.Pu.J_(s),i}function Kv(e){return Xh(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Hv(e){return function(e){return Ma(Ma(e).persistence).hs()}(Ma(e).localStore)}async function Wv(e,t,n,r){const i=Ma(e);if(i.gu)return void Na(mv,"Ignoring unexpected query state notification.");const s=i.Iu.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await km(i.localStore,ld(s[0])),r=If.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Sl.EMPTY_BYTE_STRING);await Vv(i,e,r);break}case"rejected":await Sm(i.localStore,t,!0),xv(i,t,r);break;default:xa(64155,n)}}async function Qv(e,t,n){const r=Jv(e);if(r.gu){for(const e of t){if(r.Iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){Na(mv,"Adding an already active target "+e);continue}const t=await Am(r.localStore,e),n=await Em(r.localStore,t);await Tv(r,Kv(t),n.targetId,!1,n.resumeToken),_y(r.remoteStore,n)}for(const e of n)r.Iu.has(e)&&await Sm(r.localStore,e,!1).then(()=>{Iy(r.remoteStore,e),xv(r,e)}).catch(Lc)}}function Jv(e){const t=Ma(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Cv.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=jv.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=kv.bind(null,t),t.Pu.J_=rv.bind(null,t.eventManager),t.Pu.yu=iv.bind(null,t.eventManager),t}function Yv(e){const t=Ma(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Nv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Rv.bind(null,t),t}class Xv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=oy(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return wm(this.persistence,new mm,e.initialUser,this.serializer)}Cu(e){return new Zg(tm.Vi,this.serializer)}Du(e){return new Gm}async terminate(){var e,t;null!==(e=this.gcScheduler)&&void 0!==e&&e.stop(),null!==(t=this.indexBackfillerScheduler)&&void 0!==t&&t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xv.provider={build:()=>new Xv};class $v extends Xv{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){La(this.persistence.referenceDelegate instanceof nm,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new kg(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?hg.withCacheSize(this.cacheSizeBytes):hg.DEFAULT;return new Zg(e=>nm.Vi(e,t),this.serializer)}}class Zv extends Xv{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Yv(this.xu.syncEngine),await Oy(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return wm(this.persistence,new mm,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new kg(n,e.asyncQueue,t)}Mu(e,t){const n=new Yc(t,this.persistence);return new Jc(e.asyncQueue,n)}Cu(e){const t=fm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?hg.withCacheSize(this.cacheSizeBytes):hg.DEFAULT;return new lm(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,iy(),sy(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Gm}}class ew extends Zv{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof zm&&(this.sharedClientState.syncEngine={So:zv.bind(null,t),Do:Wv.bind(null,t),Co:Qv.bind(null,t),hs:Hv.bind(null,t),bo:Bv.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await async function(e,t){const n=Ma(e);if(Jv(n),Yv(n),!0===t&&!0!==n.gu){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Gv(n,e.toArray());n.gu=!0,await Gy(n.remoteStore,!0);for(const r of t)_y(n.remoteStore,r)}else if(!1===t&&!1!==n.gu){const e=[];let t=Promise.resolve();n.Iu.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(xv(n,i),Sm(n.localStore,i,!0))),Iy(n.remoteStore,i)}),await t,await Gv(n,e),function(e){const t=Ma(e);t.Au.forEach((e,n)=>{Iy(t.remoteStore,n)}),t.Vu.zr(),t.Au=new Map,t.Ru=new yl(cc.comparator)}(n),n.gu=!1,await Gy(n.remoteStore,!1)}}(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){const t=iy();if(!zm.v(t))throw new Va(Fa.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=fm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new zm(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class tw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Av(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Uv.bind(null,this.syncEngine),await Gy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Zy}createDatastore(e){const t=oy(e.databaseInfo.databaseId),n=ry(e.databaseInfo);return py(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new yy(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>Av(this.syncEngine,e,0),Wm.v()?new Wm:new Km)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new wv(e,t,n,r,i,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Ma(e);Na(my,"RemoteStore shutting down."),t.Ea.add(5),await wy(t),t.Aa.shutdown(),t.Va.set("Unknown")}(this.remoteStore),null!==(e=this.datastore)&&void 0!==e&&e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}function nw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}tw.provider={build:()=>new tw};class rw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ra("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class iw{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Ua,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null===e||void 0===e?void 0:e.qa))))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.Ku();if(null===e)return null;const t=this.Lu.decode(e),n=Number(t);isNaN(n)&&this.qu("length string (".concat(t,") is not valid number"));const r=await this.Uu(n);return new uv(JSON.parse(r),e.length+n)}$u(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Ku(){for(;this.$u()<0&&!await this.Wu(););if(0===this.buffer.length)return null;const e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),new Error("Invalid bundle format: ".concat(e))}async Wu(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class sw{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Va(Fa.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=Ma(e),r={documents:t.map(e=>Bf(n.serializer,e))},i=await n.jo("BatchGetDocuments",n.serializer.databaseId,sc.emptyPath(),r,t.length),s=new Map;i.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){La(!!t.found,43571),t.found.name,t.found.updateTime;const n=zf(e,t.found.name),r=Vf(t.found.updateTime),i=t.found.createTime?Vf(t.found.createTime):bc.min(),s=new gh({mapValue:{fields:t.found.fields}});return yh.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){La(!!t.missing,3894),La(!!t.readTime,22933);const n=zf(e,t.missing),r=Vf(t.readTime);return yh.newNoDocument(n,r)}(e,t):xa(7234,{result:t})}(n.serializer,e);s.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{const t=s.get(e.toString());La(!!t,55234,{key:e}),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new rf(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=cc.fromPath(t);this.mutations.push(new sf(n,this.precondition(n)))}),await async function(e,t){const n=Ma(e),r={writes:t.map(e=>Yf(n.serializer,e))};await n.Wo("Commit",n.serializer.databaseId,sc.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw xa(50498,{Gu:e.constructor.name});t=bc.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Va(Fa.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(bc.min())?Gd.exists(!1):Gd.updateTime(t):Gd.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(bc.min()))throw new Va(Fa.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Gd.updateTime(t)}return Gd.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ow{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.zu=n.maxAttempts,this.M_=new ay(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{const e=new sw(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{const t=this.updateFunction(e);return!Zc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===(null===e||void 0===e?void 0:e.name)){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!df(t)}return!1}}const aw="FirestoreClient";class cw{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=Sa.UNAUTHENTICATED,this.clientId=Ja.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{Na(aw,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Na(aw,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ua;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Qy(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function uw(e,t){e.asyncQueue.verifyOperationInProgress(),Na(aw,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await _m(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lw(e,t){e.asyncQueue.verifyOperationInProgress();const n=await hw(e);Na(aw,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>zy(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>zy(t.remoteStore,n)),e._onlineComponents=t}async function hw(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Na(aw,"Using user provided OfflineComponentProvider");try{await uw(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===Fa.FAILED_PRECONDITION||e.code===Fa.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Da("Error using user provided cache. Falling back to memory cache: "+n),await uw(e,new Xv)}}else Na(aw,"Using default OfflineComponentProvider"),await uw(e,new $v(void 0));return e._offlineComponents}async function dw(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Na(aw,"Using user provided OnlineComponentProvider"),await lw(e,e._uninitializedComponentsProvider._online)):(Na(aw,"Using default OnlineComponentProvider"),await lw(e,new tw))),e._onlineComponents}function fw(e){return hw(e).then(e=>e.persistence)}function pw(e){return hw(e).then(e=>e.localStore)}function gw(e){return dw(e).then(e=>e.remoteStore)}function mw(e){return dw(e).then(e=>e.syncEngine)}function yw(e){return dw(e).then(e=>e.datastore)}async function vw(e){const t=await dw(e),n=t.eventManager;return n.onListen=_v.bind(null,t.syncEngine),n.onUnlisten=Ev.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Iv.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Sv.bind(null,t.syncEngine),n}function ww(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Ua;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new rw({next:a=>{s.Nu(),t.enqueueAndForget(()=>nv(e,o));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new Va(Fa.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new Va(Fa.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new cv($h(n.path),s,{includeMetadataChanges:!0,Ka:!0});return tv(e,o)}(await vw(e),e.asyncQueue,t,n,r)),r.promise}function _w(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Ua;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new rw({next:n=>{s.Nu(),t.enqueueAndForget(()=>nv(e,o)),n.fromCache&&"server"===r.source?i.reject(new Va(Fa.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new cv(n,s,{includeMetadataChanges:!0,Ka:!0});return tv(e,o)}(await vw(e),e.asyncQueue,t,n,r)),r.promise}function Iw(e,t){const n=new Ua;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=Yv(e);try{const e=await function(e,t){const n=Ma(e),r=Ic.now(),i=t.reduce((e,t)=>e.add(t.key),Ed());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=gd(),c=Ed();return n.xs.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=Yd(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Zd(e.key,t,mh(t.value.mapValue),Gd.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:vd(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.du[e.currentUser.toKey()];r||(r=new yl(Ya)),r=r.insert(t,n),e.du[e.currentUser.toKey()]=r}(r,e.batchId,n),await Vv(r,e.changes),await Oy(r.remoteStore)}catch(e){const t=Qy(e,"Failed to persist write");n.reject(t)}}(await mw(e),t,n)),n.promise}function bw(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?gf().encode(e):e,function(e,t){return new iw(e,t)}(function(e,t){if(e instanceof Uint8Array)return nw(e,t);if(e instanceof ArrayBuffer)return nw(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,oy(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=Ma(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Ma(e),r=Vf(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(dv(r));const i=new hv(r,t.serializer);let s=await t.Su();for(;s;){const e=await i.Ga(s);e&&n._updateProgress(e),s=await t.Su()}const o=await i.ja(e.localStore);return await Vv(e,o.Ja,void 0),await function(e,t){const n=Ma(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Pi.saveBundleMetadata(e,t))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Ha)}catch(e){return Da(mv,"Loading bundle failed with ".concat(e)),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await mw(e),i,r)})}function Tw(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Ew="ComponentProvider",Sw=new Map;function Cw(e,t,n,r,i){return new Fl(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Tw(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}const Aw="firestore.googleapis.com",kw=!0;class Nw{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Va(Fa.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Aw,this.ssl=kw}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:kw;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=lg;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<Sg)throw new Va(Fa.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lc("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tw(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Va(Fa.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new Va(Fa.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new Va(Fa.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rw{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Va(Fa.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Va(Fa.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nw(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new qa;switch(e.type){case"firstParty":return new Ka(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Va(Fa.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sw.get(e);t&&(Na(Ew,"Removing Datastore"),Sw.delete(e),t.terminate())}(this),Promise.resolve()}}function Dw(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=gc(e,Rw);const i=b(t),s=e._getSettings(),o=l(l({},s),{},{emulatorOptions:e._getEmulatorOptions()}),a="".concat(t,":").concat(n);i&&(T("https://".concat(a)),C("Firestore",!0)),s.host!==Aw&&s.host!==a&&Da("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=l(l({},s),{},{host:a,ssl:i,emulatorOptions:r});if(!j(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Sa.MOCK_USER;else{var u;t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=l({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[p(JSON.stringify({alg:"none",type:"JWT"})),p(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(u=e._app)||void 0===u?void 0:u.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Va(Fa.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Sa(i)}e._authCredentials=new Ba(new ja(t,n))}}class Pw{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pw(this.firestore,e,this._query)}}class xw{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ow(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xw(this.firestore,e,this._key)}toJSON(){return{type:xw._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(vc(t,xw._jsonSchema))return new xw(e,n||null,new cc(sc.fromString(t.referencePath)))}}xw._jsonSchemaVersion="firestore/documentReference/1.0",xw._jsonSchema={type:yc("string",xw._jsonSchemaVersion),referencePath:yc("string")};class Ow extends Pw{constructor(e,t,n){super(e,t,$h(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xw(this.firestore,null,new cc(e))}withConverter(e){return new Ow(this.firestore,e,this._path)}}function Lw(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=Q(e),uc("collection","path",t),e instanceof Rw){const n=sc.fromString(t,...r);return dc(n),new Ow(e,null,n)}{if(!(e instanceof xw||e instanceof Ow))throw new Va(Fa.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(sc.fromString(t,...r));return dc(n),new Ow(e.firestore,null,n)}}function Mw(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=Q(e),1===arguments.length&&(t=Ja.newId()),uc("doc","path",t),e instanceof Rw){const n=sc.fromString(t,...r);return hc(n),new xw(e,null,new cc(n))}{if(!(e instanceof xw||e instanceof Ow))throw new Va(Fa.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(sc.fromString(t,...r));return hc(n),new xw(e.firestore,e instanceof Ow?e.converter:null,new cc(n))}}function Fw(e,t){return e=Q(e),t=Q(t),(e instanceof xw||e instanceof Ow)&&(t instanceof xw||t instanceof Ow)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Vw(e,t){return e=Q(e),t=Q(t),e instanceof Pw&&t instanceof Pw&&e.firestore===t.firestore&&od(e._query,t._query)&&e.converter===t.converter}const Uw="AsyncQueue";class jw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ay(this,"async_queue_retry"),this._c=()=>{const e=sy();e&&Na(Uw,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=sy();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=sy();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Ua;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!zc(e))throw e;Na(Uw,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,Ra("INTERNAL UNHANDLED ERROR: ",qw(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Wy.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&xa(47125,{Pc:qw(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function qw(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Bw{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ua,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class zw extends Rw{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new jw,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new jw(e),this._firestoreClient=void 0,await e}}}function Gw(e){if(e._terminated)throw new Va(Fa.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Kw(e),e._firestoreClient}function Kw(e){var t,n,r,i;const s=e._freezeSettings(),o=Cw(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,null===(n=e._app)||void 0===n?void 0:n.options.apiKey,s);e._componentsProvider||null!==(r=s.localCache)&&void 0!==r&&r._offlineComponentProvider&&null!==(i=s.localCache)&&void 0!==i&&i._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new cw(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){const t=null===e||void 0===e?void 0:e._online.build();return{_offline:null===e||void 0===e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function Hw(e,t,n){if((e=gc(e,zw))._firestoreClient||e._terminated)throw new Va(Fa.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new Va(Fa.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},Kw(e)}function Ww(e){return function(e){const t=new Ua;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=Ma(e);Cy(n.remoteStore)||Na(mv,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Ma(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(e===$c)return void t.resolve();const r=n.mu.get(e)||[];r.push(t),n.mu.set(e,r)}catch(e){const n=Qy(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await mw(e),t)),t.promise}(Gw(e=gc(e,zw)))}function Qw(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await fw(e),n=await gw(e);return t.setNetworkEnabled(!0),function(e){const t=Ma(e);return t.Ea.delete(0),vy(t)}(n)})}(Gw(e=gc(e,zw)))}function Jw(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await fw(e),n=await gw(e);return t.setNetworkEnabled(!1),async function(e){const t=Ma(e);t.Ea.add(0),await wy(t),t.Va.set("Offline")}(n)})}(Gw(e=gc(e,zw)))}function Yw(e,t){return function(e,t){return e.asyncQueue.enqueue(async()=>function(e,t){const n=Ma(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.Pi.getNamedQuery(e,t))}(await pw(e),t))}(Gw(e=gc(e,zw)),t).then(t=>t?new Pw(e,null,t.query):null)}class Xw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xw(Sl.fromBase64String(e))}catch(e){throw new Va(Fa.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Xw(Sl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Xw._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(vc(e,Xw._jsonSchema))return Xw.fromBase64String(e.bytes)}}Xw._jsonSchemaVersion="firestore/bytes/1.0",Xw._jsonSchema={type:yc("string",Xw._jsonSchemaVersion),bytes:yc("string")};class $w{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new Va(Fa.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ac(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Zw{constructor(e){this._methodName=e}}class e_{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Va(Fa.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Va(Fa.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ya(this._lat,e._lat)||Ya(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:e_._jsonSchemaVersion}}static fromJSON(e){if(vc(e,e_._jsonSchema))return new e_(e.latitude,e.longitude)}}e_._jsonSchemaVersion="firestore/geoPoint/1.0",e_._jsonSchema={type:yc("string",e_._jsonSchemaVersion),latitude:yc("number"),longitude:yc("number")};class t_{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:t_._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(vc(e,t_._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new t_(e.vectorValues);throw new Va(Fa.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}t_._jsonSchemaVersion="firestore/vectorValue/1.0",t_._jsonSchema={type:yc("string",t_._jsonSchemaVersion),vectorValues:yc("object")};const n_=/^__.*__$/;class r_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Zd(e,this.data,this.fieldMask,t,this.fieldTransforms):new $d(e,this.data,t,this.fieldTransforms)}}class i_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Zd(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function s_(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xa(40011,{dataSource:e})}}class o_{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new o_(l(l({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return C_(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(s_(this.dataSource)&&n_.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class a_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||oy(e)}createContext(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new o_({dataSource:e,methodName:t,targetDoc:n,path:ac.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function c_(e){const t=e._freezeSettings(),n=oy(e._databaseId);return new a_(e._databaseId,!!t.ignoreUndefinedProperties,n)}function u_(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);b_("Data must be an object, but it was:",o,r);const a=__(r,o);let c,u;if(s.merge)c=new Tl(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=T_(t,r,n);if(!o.contains(i))throw new Va(Fa.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));A_(e,i)||e.push(i)}c=new Tl(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new r_(new gh(a),c,u)}class l_ extends Zw{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError("".concat(this._methodName,"() can only appear at the top level of your update data")):e.createError("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof l_}}function h_(e,t,n){return new o_({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class d_ extends Zw{_toFieldTransform(e){return new Bd(e.path,new Od)}isEqual(e){return e instanceof d_}}class f_ extends Zw{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){const t=h_(this,e,!0),n=this.Ac.map(e=>w_(e,t)),r=new Ld(n);return new Bd(e.path,r)}isEqual(e){return e instanceof f_&&j(this.Ac,e.Ac)}}class p_ extends Zw{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){const t=h_(this,e,!0),n=this.Ac.map(e=>w_(e,t)),r=new Fd(n);return new Bd(e.path,r)}isEqual(e){return e instanceof p_&&j(this.Ac,e.Ac)}}class g_ extends Zw{constructor(e,t){super(e),this.Vc=t}_toFieldTransform(e){const t=new Ud(e.serializer,Nd(e.serializer,this.Vc));return new Bd(e.path,t)}isEqual(e){return e instanceof g_&&this.Vc===e.Vc}}function m_(e,t,n,r){const i=e.createContext(1,t,n);b_("Data must be an object, but it was:",i,r);const s=[],o=gh.empty();gl(r,(e,r)=>{const a=S_(t,e,n);r=Q(r);const c=i.childContextForFieldPath(a);if(r instanceof l_)s.push(a);else{const e=w_(r,c);null!=e&&(s.push(a),o.set(a,e))}});const a=new Tl(s);return new i_(o,a,i.fieldTransforms)}function y_(e,t,n,r,i,s){const o=e.createContext(1,t,n),a=[T_(t,r,n)],c=[i];if(s.length%2!=0)throw new Va(Fa.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let d=0;d<s.length;d+=2)a.push(T_(t,s[d])),c.push(s[d+1]);const u=[],l=gh.empty();for(let d=a.length-1;d>=0;--d)if(!A_(u,a[d])){const e=a[d];let t=c[d];t=Q(t);const n=o.childContextForFieldPath(e);if(t instanceof l_)u.push(e);else{const r=w_(t,n);null!=r&&(u.push(e),l.set(e,r))}}const h=new Tl(u);return new i_(l,h,o.fieldTransforms)}function v_(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return w_(n,e.createContext(r?4:3,t))}function w_(e,t){if(I_(e=Q(e)))return b_("Unsupported field value:",t,e),__(e,t);if(e instanceof Zw)return function(e,t){if(!s_(t.dataSource))throw t.createError("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.createError("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=w_(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Q(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Nd(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Ic.fromDate(e);return{timestampValue:Lf(t.serializer,n)}}if(e instanceof Ic){const n=new Ic(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Lf(t.serializer,n)}}if(e instanceof e_)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Xw)return{bytesValue:Mf(t.serializer,e._byteString)};if(e instanceof xw){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Uf(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof t_)return function(e,t){const n=e instanceof t_?e.toArray():e,r={fields:{[jl]:{stringValue:zl},[Gl]:{arrayValue:{values:n.map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return Ad(t.serializer,e)})}}}};return{mapValue:r}}(e,t);if(lp(e))return e._toProto(t.serializer);throw t.createError("Unsupported field value: ".concat(pc(e)))}(e,t)}function __(e,t){const n={};return ml(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):gl(e,(e,r)=>{const i=w_(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function I_(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Ic||e instanceof e_||e instanceof Xw||e instanceof xw||e instanceof Zw||e instanceof t_||lp(e))}function b_(e,t,n){if(!I_(n)||!fc(n)){const r=pc(n);throw"an object"===r?t.createError(e+" a custom object"):t.createError(e+" "+r)}}function T_(e,t,n){if((t=Q(t))instanceof $w)return t._internalPath;if("string"==typeof t)return S_(e,t);throw C_("Field path arguments must be of type string or ",e,!1,void 0,n)}const E_=new RegExp("[~\\*/\\[\\]]");function S_(e,t,n){if(t.search(E_)>=0)throw C_("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new $w(...t.split("."))._internalPath}catch(r){throw C_("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function C_(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a="Function ".concat(t,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(i)),c+=")"),new Va(Fa.INVALID_ARGUMENT,a+e+c)}function A_(e,t){return e.some(e=>e.isEqual(t))}class k_{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Hl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return kl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Nl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw xa(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return gl(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t;const n=null===(t=e.fields)||void 0===t||null===(t=t[Gl].arrayValue)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.map(e=>kl(e.doubleValue));return new t_(n)}convertGeoPoint(e){return new e_(kl(e.latitude),kl(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ll(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ml(e));default:return null}}convertTimestamp(e){const t=Al(e);return new Ic(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=sc.fromString(e);La(up(n),9688,{name:e});const r=new Ul(n.get(1),n.get(3)),i=new cc(n.popFirst(5));return r.isEqual(t)||Ra("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}class N_ extends k_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xw(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new xw(this.firestore,null,t)}}const R_="@firebase/firestore",D_="4.11.0";function P_(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class x_{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new xw(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new O_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e,t;return null!==(e=null===(t=this._document)||void 0===t?void 0:t.data.clone().value.mapValue.fields)&&void 0!==e?e:void 0}get(e){if(this._document){const t=this._document.data.field(T_("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class O_ extends x_{data(){return super.data()}}function L_(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Va(Fa.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class M_{}class F_ extends M_{}function V_(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];t instanceof M_&&n.push(t),n=n.concat(i),function(e){const t=e.filter(e=>e instanceof j_).length,n=e.filter(e=>e instanceof U_).length;if(t>1||t>0&&n>0)throw new Va(Fa.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const o of n)e=o._apply(e);return e}class U_ extends F_{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new U_(e,t,n)}_apply(e){const t=this._parse(e);return Q_(e._query,t),new Pw(e.firestore,e.converter,id(e._query,t))}_parse(e){const t=c_(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Va(Fa.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){W_(o,s);const t=[];for(const n of o)t.push(H_(r,e,n));a={arrayValue:{values:t}}}else a=H_(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||W_(o,s),a=v_(n,t,o,"in"===s||"not-in"===s);return Eh.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class j_ extends M_{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new j_(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Sh.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)Q_(n,i),n=id(n,i)}(e._query,t),new Pw(e.firestore,e.converter,id(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class q_ extends F_{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new q_(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ih(t,n)}(e._query,this._field,this._direction);return new Pw(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Yh(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class B_ extends F_{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new B_(e,t,n)}_apply(e){return new Pw(e.firestore,e.converter,sd(e._query,this._limit,this._limitType))}}class z_ extends F_{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new z_(e,t,n)}_apply(e){const t=K_(e,this.type,this._docOrFields,this._inclusive);return new Pw(e.firestore,e.converter,function(e,t){return new Yh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class G_ extends F_{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new G_(e,t,n)}_apply(e){const t=K_(e,this.type,this._docOrFields,this._inclusive);return new Pw(e.firestore,e.converter,function(e,t){return new Yh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function K_(e,t,n,r){if(n[0]=Q(n[0]),n[0]instanceof x_)return function(e,t,n,r,i){if(!r)throw new Va(Fa.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));const s=[];for(const o of td(e))if(o.field.isKeyField())s.push(th(t,r.key));else{const e=r.data.field(o.field);if(Ol(e))throw new Va(Fa.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(e,"' (used as the orderBy) does not exist."))}s.push(e)}return new vh(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=c_(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Va(Fa.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof s));if(!ed(e)&&-1!==s.indexOf("/"))throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(s,"' contains a slash."));const n=e.path.child(sc.fromString(s));if(!cc.isDocumentKey(n))throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(n,"' is not because it contains an odd number of segments."));const i=new cc(n);a.push(th(t,i))}else{const e=v_(n,r,s);a.push(e)}}return new vh(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function H_(e,t,n){if("string"==typeof(n=Q(n))){if(""===n)throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ed(t)&&-1!==n.indexOf("/"))throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(sc.fromString(n));if(!cc.isDocumentKey(r))throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return th(e,new cc(r))}if(n instanceof xw)return th(e,n._key);throw new Va(Fa.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(pc(n),"."))}function W_(e,t){if(!Array.isArray(e)||0===e.length)throw new Va(Fa.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function Q_(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Va(Fa.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Va(Fa.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}function J_(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Y_ extends k_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xw(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new xw(this.firestore,null,t)}}class X_{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class $_ extends x_{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Z_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(T_("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Va(Fa.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=$_._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}$_._jsonSchemaVersion="firestore/documentSnapshot/1.0",$_._jsonSchema={type:yc("string",$_._jsonSchemaVersion),bundleSource:yc("string","DocumentSnapshot"),bundleName:yc("string"),bundle:yc("string")};class Z_ extends $_{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class eI{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new X_(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Z_(this._firestore,this._userDataWriter,n.key,n,new X_(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Va(Fa.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Z_(e._firestore,e._userDataWriter,n.doc.key,n.doc,new X_(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Z_(e._firestore,e._userDataWriter,t.doc.key,t.doc,new X_(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:tI(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Va(Fa.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=eI._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ja.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function tI(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xa(61501,{type:e})}}function nI(e,t){return e instanceof $_&&t instanceof $_?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof eI&&t instanceof eI&&e._firestore===t._firestore&&Vw(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}eI._jsonSchemaVersion="firestore/querySnapshot/1.0",eI._jsonSchema={type:yc("string",eI._jsonSchemaVersion),bundleSource:yc("string","QuerySnapshot"),bundleName:yc("string"),bundle:yc("string")};const rI={maxAttempts:5};class iI{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=c_(e)}set(e,t,n){this._verifyNotCommitted();const r=sI(e,this._firestore),i=J_(r.converter,t,n),s=u_(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Gd.none())),this}update(e,t,n){this._verifyNotCommitted();const r=sI(e,this._firestore);let i;for(var s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return i="string"==typeof(t=Q(t))||t instanceof $w?y_(this._dataReader,"WriteBatch.update",r._key,t,n,o):m_(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(i.toMutation(r._key,Gd.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=sI(e,this._firestore);return this._mutations=this._mutations.concat(new rf(t._key,Gd.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Va(Fa.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function sI(e,t){if((e=Q(e)).firestore!==t)throw new Va(Fa.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class oI{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=c_(e)}get(e){const t=sI(e,this._firestore),n=new Y_(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return xa(24041);const r=e[0];if(r.isFoundDocument())return new x_(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new x_(this._firestore,n,t._key,null,t.converter);throw xa(18433,{doc:r})})}set(e,t,n){const r=sI(e,this._firestore),i=J_(r.converter,t,n),s=u_(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n){const r=sI(e,this._firestore);let i;for(var s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return i="string"==typeof(t=Q(t))||t instanceof $w?y_(this._dataReader,"Transaction.update",r._key,t,n,o):m_(this._dataReader,"Transaction.update",r._key,t),this._transaction.update(r._key,i),this}delete(e){const t=sI(e,this._firestore);return this._transaction.delete(t._key),this}}class aI extends oI{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=sI(e,this._firestore),n=new N_(this._firestore);return super.get(e).then(e=>new $_(this._firestore,n,t._key,e._document,new X_(!1,!1),t.converter))}}function cI(e,t,n){e=gc(e,zw);const r=l(l({},rI),n);!function(e){if(e.maxAttempts<1)throw new Va(Fa.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r);return function(e,t,n){const r=new Ua;return e.asyncQueue.enqueueAndForget(async()=>{const i=await yw(e);new ow(e.asyncQueue,i,n,t,r).ju()}),r.promise}(Gw(e),n=>t(new aI(e,n)),r)}function uI(e){e=gc(e,xw);const t=gc(e.firestore,zw),n=Gw(t),r=new N_(t);return function(e,t){const n=new Ua;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(e,t){const n=Ma(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Va(Fa.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Qy(e,"Failed to get document '".concat(t," from cache"));n.reject(r)}}(await pw(e),t,n)),n.promise}(n,e._key).then(n=>new $_(t,r,e._key,n,new X_(null!==n&&n.hasLocalMutations,!0),e.converter))}function lI(e){e=gc(e,Pw);const t=gc(e.firestore,zw),n=Gw(t),r=new N_(t);return function(e,t){const n=new Ua;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await Cm(e,t,!0),i=new gv(t,r.ks),s=i.ru(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Qy(e,"Failed to execute query '".concat(t," against cache"));n.reject(r)}}(await pw(e),t,n)),n.promise}(n,e._query).then(n=>new eI(t,r,e,n))}function hI(e,t,n){e=gc(e,xw);const r=gc(e.firestore,zw),i=J_(e.converter,t,n);return gI(r,[u_(c_(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Gd.none())])}function dI(e,t,n){e=gc(e,xw);const r=gc(e.firestore,zw),i=c_(r);let s;for(var o=arguments.length,a=new Array(o>3?o-3:0),c=3;c<o;c++)a[c-3]=arguments[c];return s="string"==typeof(t=Q(t))||t instanceof $w?y_(i,"updateDoc",e._key,t,n,a):m_(i,"updateDoc",e._key,t),gI(r,[s.toMutation(e._key,Gd.exists(!0))])}function fI(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=Q(e);let i={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof n[s]||P_(n[s])||(i=n[s++]);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(P_(n[s])){var a,c,u;const e=n[s];n[s]=null===(a=e.next)||void 0===a?void 0:a.bind(e),n[s+1]=null===(c=e.error)||void 0===c?void 0:c.bind(e),n[s+2]=null===(u=e.complete)||void 0===u?void 0:u.bind(e)}let l,h,d;if(e instanceof xw)h=gc(e.firestore,zw),d=$h(e._key.path),l={next:t=>{n[s]&&n[s](mI(h,e,t))},error:n[s+1],complete:n[s+2]};else{const t=gc(e,Pw);h=gc(t.firestore,zw),d=t._query;const r=new N_(h);l={next:e=>{n[s]&&n[s](new eI(h,r,t,e))},error:n[s+1],complete:n[s+2]},L_(e._query)}return function(e,t,n,r){const i=new rw(r),s=new cv(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>tv(await vw(e),s)),()=>{i.Nu(),e.asyncQueue.enqueueAndForget(async()=>nv(await vw(e),s))}}(Gw(h),d,o,l)}function pI(e,t){return function(e,t){const n=new rw(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){Ma(e).Ca.add(t),t.next()}(await vw(e),n)),()=>{n.Nu(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){Ma(e).Ca.delete(t)}(await vw(e),n))}}(Gw(e=gc(e,zw)),P_(t)?t:{next:t})}function gI(e,t){return Iw(Gw(e),t)}function mI(e,t,n){const r=n.docs.get(t._key),i=new N_(e);return new $_(e,i,t._key,r,new X_(n.hasPendingWrites,n.fromCache),t.converter)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Ca=mt,st(new J("firestore",(e,n)=>{let{instanceIdentifier:r,options:i}=n;const s=e.getProvider("app").getImmediate(),o=new zw(new za(e.getProvider("auth-internal")),new Wa(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Va(Fa.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ul(e.options.projectId,t)}(s,r),s);return i=l({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),bt(R_,D_,e),bt(R_,D_,"esm2020")}();function yI(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Va("invalid-argument","Invalid options passed to function ".concat(e,"(): You cannot ")+'specify both "merge" and "mergeFields".');return t}function vI(){if("undefined"===typeof Uint8Array)throw new Va("unimplemented","Uint8Arrays are not available in this environment.")}function wI(){if("undefined"==typeof atob)throw new Va("unimplemented","Blobs are unavailable in Firestore in this environment.")}class _I{constructor(e){this._delegate=e}static fromBase64String(e){return wI(),new _I(Xw.fromBase64String(e))}static fromUint8Array(e){return vI(),new _I(Xw.fromUint8Array(e))}toBase64(){return wI(),this._delegate.toBase64()}toUint8Array(){return vI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function II(e){return function(e,t){if("object"!==typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"===typeof n[r])return!0;return!1}(e,["next","error","complete"])}class bI{enableIndexedDbPersistence(e,t){return function(e,t){Da("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return Hw(e,tw.provider,{build:e=>new Zv(e,n.cacheSizeBytes,null===t||void 0===t?void 0:t.forceOwnership)}),Promise.resolve()}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return async function(e){Da("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();Hw(e,tw.provider,{build:e=>new ew(e,t.cacheSizeBytes)})}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Va(Fa.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Ua;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!Uc.v())return Promise.resolve();const t=e+um;await Uc.delete(t)}(fm(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class TI{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ul||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Da("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=l(l({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Dw(this._delegate,e,t,n)}enableNetwork(){return Qw(this._delegate)}disableNetwork(){return Jw(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,lc("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ww(this._delegate)}onSnapshotsInSync(e){return pI(this._delegate,e)}get app(){if(!this._appCompat)throw new Va("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new FI(this,Lw(this._delegate,e))}catch(t){throw NI(t,"collection()","Firestore.collection()")}}doc(e){try{return new kI(this,Mw(this._delegate,e))}catch(t){throw NI(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new OI(this,function(e,t){if(e=gc(e,Rw),uc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Va(Fa.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new Pw(e,null,function(e){return new Yh(sc.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw NI(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return cI(this._delegate,t=>e(new SI(this,t)))}batch(){return Gw(this._delegate),new CI(new iI(this._delegate,e=>gI(this._delegate,e)))}loadBundle(e){return function(e,t){const n=Gw(e=gc(e,zw)),r=new Bw;return bw(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return Yw(this._delegate,e).then(e=>e?new OI(this,e):null)}}class EI extends k_{constructor(e){super(),this.firestore=e}convertBytes(e){return new _I(new Xw(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return kI.forKey(t,this.firestore,null)}}class SI{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new EI(e)}get(e){const t=VI(e);return this._delegate.get(t).then(e=>new PI(this._firestore,new $_(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){const r=VI(e);return n?(yI("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];const o=VI(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...i),this}delete(e){const t=VI(e);return this._delegate.delete(t),this}}class CI{constructor(e){this._delegate=e}set(e,t,n){const r=VI(e);return n?(yI("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];const o=VI(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...i),this}delete(e){const t=VI(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class AI{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Z_(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new xI(this._firestore,n),null!==t&&void 0!==t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=AI.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new AI(e,new EI(e),t),r.set(t,i)),i}}AI.INSTANCES=new WeakMap;class kI{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new EI(e)}static forPath(e,t,n){if(e.length%2!==0)throw new Va("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+"".concat(e.canonicalString()," has ").concat(e.length));return new kI(t,new xw(t._delegate,n,new cc(e)))}static forKey(e,t,n){return new kI(t,new xw(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new FI(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new FI(this.firestore,Lw(this._delegate,e))}catch(t){throw NI(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Q(e))instanceof xw&&Fw(this._delegate,e)}set(e,t){t=yI("DocumentReference.set",t);try{return t?hI(this._delegate,e,t):hI(this._delegate,e)}catch(n){throw NI(n,"setDoc()","DocumentReference.set()")}}update(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{return 1===arguments.length?dI(this._delegate,e):dI(this._delegate,e,t,...r)}catch(s){throw NI(s,"updateDoc()","DocumentReference.update()")}}delete(){return gI(gc((e=this._delegate).firestore,zw),[new rf(e._key,Gd.none())]);var e}onSnapshot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=RI(t),i=DI(t,e=>new PI(this.firestore,new $_(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return fI(this._delegate,r,i)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?uI(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=gc(e,xw);const t=gc(e.firestore,zw);return ww(Gw(t),e._key,{source:"server"}).then(n=>mI(t,e,n))}(this._delegate):function(e){e=gc(e,xw);const t=gc(e.firestore,zw);return ww(Gw(t),e._key).then(n=>mI(t,e,n))}(this._delegate),t.then(e=>new PI(this.firestore,new $_(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new kI(this.firestore,e?this._delegate.withConverter(AI.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function NI(e,t,n){return e.message=e.message.replace(t,n),e}function RI(e){for(const t of e)if("object"===typeof t&&!II(t))return t;return{}}function DI(e,t){var n,r;let i;return i=II(e[0])?e[0]:II(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class PI{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new kI(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return nI(this._delegate,e._delegate)}}class xI extends PI{data(e){const t=this._delegate.data(e);return this._delegate._converter||(n="Document in a QueryDocumentSnapshot should exist",void 0!==t||xa(57014,n)),t;var n}}class OI{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new EI(e)}where(e,t,n){try{return new OI(this.firestore,V_(this._delegate,function(e,t,n){const r=t,i=T_("where",e);return U_._create(i,r,n)}(e,t,n)))}catch(r){throw NI(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new OI(this.firestore,V_(this._delegate,function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=T_("orderBy",e);return q_._create(n,t)}(e,t)))}catch(n){throw NI(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new OI(this.firestore,V_(this._delegate,(mc("limit",t=e),B_._create("limit",t,"F"))))}catch(n){throw NI(n,"limit()","Query.limit()")}var t}limitToLast(e){try{return new OI(this.firestore,V_(this._delegate,(mc("limitToLast",t=e),B_._create("limitToLast",t,"L"))))}catch(n){throw NI(n,"limitToLast()","Query.limitToLast()")}var t}startAt(){try{return new OI(this.firestore,V_(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z_._create("startAt",t,!0)}(...arguments)))}catch(e){throw NI(e,"startAt()","Query.startAt()")}}startAfter(){try{return new OI(this.firestore,V_(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z_._create("startAfter",t,!1)}(...arguments)))}catch(e){throw NI(e,"startAfter()","Query.startAfter()")}}endBefore(){try{return new OI(this.firestore,V_(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return G_._create("endBefore",t,!1)}(...arguments)))}catch(e){throw NI(e,"endBefore()","Query.endBefore()")}}endAt(){try{return new OI(this.firestore,V_(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return G_._create("endAt",t,!0)}(...arguments)))}catch(e){throw NI(e,"endAt()","Query.endAt()")}}isEqual(e){return Vw(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?lI(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=gc(e,Pw);const t=gc(e.firestore,zw),n=Gw(t),r=new N_(t);return _w(n,e._query,{source:"server"}).then(n=>new eI(t,r,e,n))}(this._delegate):function(e){e=gc(e,Pw);const t=gc(e.firestore,zw),n=Gw(t),r=new N_(t);return L_(e._query),_w(n,e._query).then(n=>new eI(t,r,e,n))}(this._delegate),t.then(e=>new MI(this.firestore,new eI(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=RI(t),i=DI(t,e=>new MI(this.firestore,new eI(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return fI(this._delegate,r,i)}withConverter(e){return new OI(this.firestore,e?this._delegate.withConverter(AI.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class LI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new xI(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class MI{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new OI(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new xI(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new LI(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new xI(this._firestore,n))})}isEqual(e){return nI(this._delegate,e._delegate)}}class FI extends OI{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new kI(this.firestore,e):null}doc(e){try{return new kI(this.firestore,void 0===e?Mw(this._delegate):Mw(this._delegate,e))}catch(t){throw NI(t,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=gc(e.firestore,zw),r=Mw(e),i=J_(e.converter,t);return gI(n,[u_(c_(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Gd.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new kI(this.firestore,e))}isEqual(e){return Fw(this._delegate,e._delegate)}withConverter(e){return new FI(this.firestore,e?this._delegate.withConverter(AI.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function VI(e){return gc(e,xw)}class UI{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._delegate=new $w(...t)}static documentId(){return new UI(ac.keyField().canonicalString())}isEqual(e){return(e=Q(e))instanceof $w&&this._delegate._internalPath.isEqual(e._internalPath)}}class jI{static serverTimestamp(){const e=new d_("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new jI(e)}static delete(){const e=new l_("deleteField");return e._methodName="FieldValue.delete",new jI(e)}static arrayUnion(){const e=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new f_("arrayUnion",t)}(...arguments);return e._methodName="FieldValue.arrayUnion",new jI(e)}static arrayRemove(){const e=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new p_("arrayRemove",t)}(...arguments);return e._methodName="FieldValue.arrayRemove",new jI(e)}static increment(e){const t=new g_("increment",e);return t._methodName="FieldValue.increment",new jI(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}}const qI={Firestore:TI,GeoPoint:e_,Timestamp:Ic,Blob:_I,Transaction:SI,WriteBatch:CI,DocumentReference:kI,DocumentSnapshot:PI,Query:OI,QueryDocumentSnapshot:xI,QuerySnapshot:MI,CollectionReference:FI,FieldPath:UI,FieldValue:jI,setLogLevel:function(e){var t;t=e,Aa.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new J("firestore-compat",e=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)},"PUBLIC").setServiceProps(l({},qI)))}(e,(e,t)=>new TI(e,t,new bI)),e.registerVersion("@firebase/firestore-compat","0.4.5")}(Ut);const BI={apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_STORAGE_BUCKET",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"};Ut.apps.length||Ut.initializeApp(BI);const zI=Ut.auth(),GI=Ut.firestore();var KI=n(579);const HI=function(){const[e,t]=(0,i.useState)(""),[n,r]=(0,i.useState)("");return(0,KI.jsxs)("div",{children:[(0,KI.jsx)("h2",{children:"Login"}),(0,KI.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{await zI.signInWithEmailAndPassword(e,n),console.log("Login successful!")}catch(r){console.error("Login error:",r.message)}},children:[(0,KI.jsx)("input",{type:"email",placeholder:"Email",value:e,onChange:e=>t(e.target.value)}),(0,KI.jsx)("input",{type:"password",placeholder:"Password",value:n,onChange:e=>r(e.target.value)}),(0,KI.jsx)("button",{type:"submit",children:"Login"})]})]})};const WI=function(){const[e,t]=(0,i.useState)(""),[n,r]=(0,i.useState)("");return(0,KI.jsxs)("div",{children:[(0,KI.jsx)("h2",{children:"Register"}),(0,KI.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{await zI.createUserWithEmailAndPassword(e,n),console.log("Registration successful!")}catch(r){console.error("Registration error:",r.message)}},children:[(0,KI.jsx)("input",{type:"email",placeholder:"Email",value:e,onChange:e=>t(e.target.value)}),(0,KI.jsx)("input",{type:"password",placeholder:"Password",value:n,onChange:e=>r(e.target.value)}),(0,KI.jsx)("button",{type:"submit",children:"Register"})]})]})};const QI=function(){const[e,t]=(0,i.useState)([]);return(0,i.useEffect)(()=>{!async function(){try{const e=(await GI.collection("documents").get()).docs.map(e=>e.data());t(e)}catch(e){console.error("Error fetching documents:",e.message)}}()},[]),(0,KI.jsxs)("div",{children:[(0,KI.jsx)("h2",{children:"Documents"}),(0,KI.jsx)("ul",{children:e.map((e,t)=>(0,KI.jsx)("li",{children:(0,KI.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.url})},t))})]})};const JI=function(){const[e,t]=(0,i.useState)(""),[n,r]=(0,i.useState)(""),[s,o]=(0,i.useState)("");return(0,KI.jsxs)("div",{children:[(0,KI.jsx)("h2",{children:"Admin Panel"}),(0,KI.jsxs)("form",{onSubmit:async()=>{try{await GI.collection("categories").add({name:e}),console.log("Category created successfully!")}catch(t){console.error("Error creating category:",t.message)}},children:[(0,KI.jsx)("input",{type:"text",placeholder:"Category Name",value:e,onChange:e=>t(e.target.value)}),(0,KI.jsx)("button",{type:"submit",children:"Create Category"})]}),(0,KI.jsxs)("form",{onSubmit:async()=>{try{await GI.collection("subcategories").add({name:n,categoryId:"YOUR_CATEGORY_ID"}),console.log("Subcategory created successfully!")}catch(e){console.error("Error creating subcategory:",e.message)}},children:[(0,KI.jsx)("input",{type:"text",placeholder:"Subcategory Name",value:n,onChange:e=>r(e.target.value)}),(0,KI.jsx)("button",{type:"submit",children:"Create Subcategory"})]}),(0,KI.jsxs)("form",{onSubmit:async()=>{try{await GI.collection("documents").add({url:s,categoryId:"YOUR_CATEGORY_ID",subcategoryId:"YOUR_SUBCATEGORY_ID"}),console.log("Document uploaded successfully!")}catch(e){console.error("Error uploading document:",e.message)}},children:[(0,KI.jsx)("input",{type:"text",placeholder:"Document URL",value:s,onChange:e=>o(e.target.value)}),(0,KI.jsx)("button",{type:"submit",children:"Upload Document"})]})]})};const YI=function(){const[e,t]=(0,i.useState)(null);return(0,i.useEffect)(()=>{const e=zI.onAuthStateChanged(e=>{t(e||null)});return()=>e()},[]),(0,KI.jsx)("div",{className:"App",children:e?(0,KI.jsxs)("div",{children:[(0,KI.jsxs)("h1",{children:["Welcome, ",e.email]}),(0,KI.jsx)("button",{onClick:async()=>{try{await zI.signOut(),console.log("User signed out successfully!")}catch(e){console.error("Error signing out:",e.message)}},children:"Logout"}),(0,KI.jsx)(QI,{}),"admin@example.com"===e.email&&(0,KI.jsx)(JI,{})]}):(0,KI.jsxs)("div",{children:[(0,KI.jsx)(HI,{}),(0,KI.jsx)(WI,{})]})})};s.render((0,KI.jsx)(i.StrictMode,{children:(0,KI.jsx)(YI,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})})();
//# sourceMappingURL=main.85ce604e.js.map